
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Nonlinear algebra &#8212; pycse - Python Computations in Science and Engineering</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "jkitchin/dsmles");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-4H7VFJKEZY"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4H7VFJKEZY');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4H7VFJKEZY');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'blog/nonlinear-algebra';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Statistics" href="statistics.html" />
    <link rel="prev" title="Linear algebra" href="linear-algebra.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/pycse.png" class="logo__image only-light" alt="pycse - Python Computations in Science and Engineering - Home"/>
    <script>document.write(`<img src="../_static/pycse.png" class="logo__image only-dark" alt="pycse - Python Computations in Science and Engineering - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to pycse - Python Computations in Science and Engineering
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">The pycse book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../book/intro.html">The pycse book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/00-intro.html">Introduction to Python and Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/01-jupyter.html">More about using Jupyter notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/02-integration-1.html">Integration in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/03-fode-1.html">First-order differential equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/04-fode-2.html">Systems of first-order differential equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/05-nth-odes.html">N<sup>th</sup> order differential equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/07-nla-1.html">Nonlinear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/08-nla-2.html">Polynomials in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/09-bvp.html">Boundary value problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/10-min-max.html">Introduction to optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/11-regression.html">Nonlinear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/12-nonlinear-regression-2.html">Uncertainty quantification in nonlinear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/13-constrained-optimization.html">Constrained optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/15-intro-linear-algebra.html">Introduction to linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/16-linear-algebra.html">Applications of linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/17-linear-algebra-2.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/18-linear-regression.html">Linear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/20-autograd-applications.html">Introduction to automatic differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/21-machine-learning.html">Introduction to machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/22-ml-2.html">Topics in machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/23-gp.html">Gaussian Process Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/conclusions.html">Concluding remarks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The pycse blog</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">The PYCSE blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-python.html">Basic python usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="math.html">Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="linear-algebra.html">Linear algebra</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Nonlinear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="statistics.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-analysis.html">Data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolation.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="differential-equations.html">Differential equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="programming.html">Programming</a></li>
<li class="toctree-l1"><a class="reference internal" href="worked-examples.html">Worked examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">pycse documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../docs/about.html">About pycse</a></li>

<li class="toctree-l1"><a class="reference internal" href="../docs/running-pycse.html">Running pycse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/pycse.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/beginner.html">pycse - Beginner mode</a></li>





<li class="toctree-l1"><a class="reference internal" href="../docs/utils.html">pycse.utils</a></li>



<li class="toctree-l1"><a class="reference internal" href="../docs/execution-statistics.html">Build statistics</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://lab.amdatascience.com/hub/user-redirect/git-pull?repo=https%3A//github.com/jkitchin/pycse&urlpath=lab/tree/pycse/pycse-jb/pycse___python_computations_in_science_and_engineering/blog/nonlinear-algebra.ipynb&branch=master" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/jkitchin/pycse/blob/master/pycse-jb/pycse___python_computations_in_science_and_engineering/blog/nonlinear-algebra.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jkitchin/pycse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jkitchin/pycse/edit/master/pycse-jb/pycse___python_computations_in_science_and_engineering/blog/nonlinear-algebra.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jkitchin/pycse/issues/new?title=Issue%20on%20page%20%2Fblog/nonlinear-algebra.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/blog/nonlinear-algebra.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Nonlinear algebra</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#know-your-tolerance">Know your tolerance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-integral-equations-with-fsolve">Solving integral equations with fsolve</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-notes">Summary notes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method-of-continuity-for-nonlinear-equation-solving">Method of continuity for nonlinear equation solving</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method-of-continuity-for-solving-nonlinear-equations-part-ii">Method of continuity for solving nonlinear equations - Part II</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-roots">Counting roots</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-roots-for-this-polynomial">Use roots for this polynomial</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-1">Method 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-2">Method 2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-nth-root-of-a-periodic-function">Finding the nth root of a periodic function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coupled-nonlinear-equations">Coupled nonlinear equations</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="nonlinear-algebra">
<h1>Nonlinear algebra<a class="headerlink" href="#nonlinear-algebra" title="Link to this heading">#</a></h1>
<p>Nonlinear algebra problems are typically solved using an iterative process that terminates when the solution is found within a specified tolerance. This process is hidden from the user. The canonical standard form to solve is <span class="math notranslate nohighlight">\(f(X) = 0\)</span>.</p>
<section id="know-your-tolerance">
<h2>Know your tolerance<a class="headerlink" href="#know-your-tolerance" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/09/02/know-your-tolerance/">Matlab post</a></p>
<p><span class="math notranslate nohighlight">\(V = \frac{\nu (C_{Ao} - C_A)}{k C_A^2}\)</span></p>
<p>With the information given below, solve for the exit concentration. This should be simple.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Cao = 2*u.mol/u.L;
V = 10*u.L;
nu = 0.5*u.L/u.s;
k = 0.23 * u.L/u.mol/u.s;
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="c1"># unit definitions</span>
<span class="n">m</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">m</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">1000.0</span>
<span class="n">mol</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">s</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># provide data</span>
<span class="n">Cao</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">mol</span> <span class="o">/</span> <span class="n">L</span>
<span class="n">V</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="n">L</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="n">s</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">0.23</span> <span class="o">*</span> <span class="n">L</span> <span class="o">/</span> <span class="n">mol</span> <span class="o">/</span> <span class="n">s</span>

<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">Ca</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">V</span> <span class="o">-</span> <span class="n">nu</span> <span class="o">*</span> <span class="p">(</span><span class="n">Cao</span> <span class="o">-</span> <span class="n">Ca</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">Ca</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Let us plot the function to estimate the solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">mol</span> <span class="o">/</span> <span class="n">L</span>

<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">func</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;C (mol/m^3)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/9d92840554e3213960b6bd071d94e94127d5ce64dea3337aedb4437ac6f175ec.png" src="../_images/9d92840554e3213960b6bd071d94e94127d5ce64dea3337aedb4437ac6f175ec.png" />
</div>
</div>
<p>Now let us solve the equation. It looks like an answer is near C=500.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>

<span class="n">cguess</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">c</span><span class="p">,</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">cguess</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">mol</span> <span class="o">/</span> <span class="n">L</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>559.5837456060607
-1.734723475976807e-18
-1.734723475976807e-21
</pre></div>
</div>
</div>
</div>
<p>Interesting. In Matlab, the default tolerance was not sufficient to get a good solution. Here it is.</p>
</section>
<section id="solving-integral-equations-with-fsolve">
<h2>Solving integral equations with fsolve<a class="headerlink" href="#solving-integral-equations-with-fsolve" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/08/30/solving-integral-equations/">Original post in Matlab</a></p>
<p>Occasionally we have integral equations we need to solve in engineering problems, for example, the volume of plug flow reactor can be defined by this equation: <span class="math notranslate nohighlight">\(V = \int_{Fa(V=0)}^{Fa} \frac{1}{r_a} dFa\)</span> where <span class="math notranslate nohighlight">\(r_a\)</span> is the rate law. Suppose we know the reactor volume is 100 L, the inlet molar flow of A is 1 mol/L, the volumetric flow is 10 L/min, and <span class="math notranslate nohighlight">\(r_a = -k Ca\)</span>, with <span class="math notranslate nohighlight">\(k=0.23\)</span> 1/min. What is the exit molar flow rate? We need to solve the following equation:</p>
<div class="math notranslate nohighlight">
\[100 = \int_{Fa(V=0)}^{Fa} \frac{1}{-k Fa/\nu} dFa\]</div>
<p>We start by creating a function handle that describes the integrand. We can use this function in the quad command to evaluate the integral.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">quad</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>

<span class="n">k</span> <span class="o">=</span> <span class="mf">0.23</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="n">Fao</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">integrand</span><span class="p">(</span><span class="n">Fa</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">Fa</span> <span class="o">/</span> <span class="n">nu</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">Fa</span><span class="p">):</span>
    <span class="n">integral</span><span class="p">,</span><span class="n">err</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="n">Fao</span><span class="p">,</span> <span class="n">Fa</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">100.0</span> <span class="o">-</span> <span class="n">integral</span>

<span class="n">vfunc</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">func</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We will need an initial guess, so we make a plot of our function to get an idea.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">vfunc</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Molar flow rate&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/d33ff67b4922deb083fd86668a36cf430c00dbff32e91ad24921f8e51302e54e.png" src="../_images/d33ff67b4922deb083fd86668a36cf430c00dbff32e91ad24921f8e51302e54e.png" />
</div>
</div>
<p>Now we can see a zero is near Fa = 0.1, so we proceed to solve the equation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Fa_guess</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">Fa_exit</span><span class="p">,</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">vfunc</span><span class="p">,</span> <span class="n">Fa_guess</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The exit concentration is </span><span class="si">{0:1.2f}</span><span class="s1"> mol/L&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Fa_exit</span> <span class="o">/</span> <span class="n">nu</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The exit concentration is 0.01 mol/L
</pre></div>
</div>
</div>
</div>
<section id="summary-notes">
<h3>Summary notes<a class="headerlink" href="#summary-notes" title="Link to this heading">#</a></h3>
<p>This example seemed a little easier in Matlab, where the quad function seemed to get automatically vectorized. Here we had to do it by hand.</p>
</section>
</section>
<section id="method-of-continuity-for-nonlinear-equation-solving">
<h2>Method of continuity for nonlinear equation solving<a class="headerlink" href="#method-of-continuity-for-nonlinear-equation-solving" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/11/01/method-of-continuity-for-nonlinear-equation-solving/">Matlab post</a></p>
<p>Adapted from Perry’s Chemical Engineers Handbook, 6th edition 2-63.</p>
<p>We seek the solution to the following nonlinear equations:</p>
<p><span class="math notranslate nohighlight">\(2 + x + y - x^2 + 8 x y + y^3 = 0\)</span></p>
<p><span class="math notranslate nohighlight">\(1 + 2x - 3y + x^2 + xy - y e^x = 0\)</span></p>
<p>In principle this is easy, we simply need some initial guesses and a nonlinear solver. The challenge here is what would you guess? There could be many solutions. The equations are implicit, so it is not easy to graph them, but let us give it a shot, starting on the x range -5 to 5. The idea is set a value for x, and then solve for y in each equation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">3</span><span class="p">;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">3</span><span class="o">*</span><span class="n">y</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span> <span class="o">-</span> <span class="n">y</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

<span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
<span class="k">def</span><span class="w"> </span><span class="nf">fy</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tmp</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">y1</span><span class="p">,</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y1</span>

<span class="nd">@np</span><span class="o">.</span><span class="n">vectorize</span>
<span class="k">def</span><span class="w"> </span><span class="nf">gy</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="n">x0</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">tmp</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">y1</span><span class="p">,</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">y1</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fy</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">x</span><span class="p">,</span> <span class="n">gy</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;fy&#39;</span><span class="p">,</span> <span class="s1">&#39;gy&#39;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2313/4022852329.py:19: RuntimeWarning: The iteration is not making good progress, as measured by the 
 improvement from the last ten iterations.
  y1, = fsolve(tmp, x0)
/tmp/ipykernel_2313/4022852329.py:19: RuntimeWarning: The iteration is not making good progress, as measured by the 
 improvement from the last five Jacobian evaluations.
  y1, = fsolve(tmp, x0)
</pre></div>
</div>
<img alt="../_images/c4064c0d3bd573c56bd372d105e7ea22e4b477859c90da09c981cc675c1ab329.png" src="../_images/c4064c0d3bd573c56bd372d105e7ea22e4b477859c90da09c981cc675c1ab329.png" />
</div>
</div>
<p>You can see there is a solution near x = -1, y = 0, because both functions equal zero there. We can even use that guess with fsolve. It is disappointly easy! But, keep in mind that in 3 or more dimensions, you cannot perform this visualization, and another method could be required.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">X</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span> <span class="n">g</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)]</span>

<span class="nb">print</span><span class="p">(</span><span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-1.00000000e+00  1.30532203e-15]
</pre></div>
</div>
</div>
</div>
<p>We explore a method that bypasses this problem today. The principle is to introduce a new variable, <span class="math notranslate nohighlight">\(\lambda\)</span>, which will vary from 0 to 1. at <span class="math notranslate nohighlight">\(\lambda=0\)</span> we will have a simpler equation, preferably a linear one, which can be easily solved, or which can be analytically solved. At <span class="math notranslate nohighlight">\(\lambda=1\)</span>, we have the original equations. Then, we create a system of differential equations that start at the easy solution, and integrate from <span class="math notranslate nohighlight">\(\lambda=0\)</span> to <span class="math notranslate nohighlight">\(\lambda=1\)</span>, to recover the final solution.</p>
<p>We rewrite the equations as:</p>
<p><span class="math notranslate nohighlight">\(f(x,y) = (2 + x + y) + \lambda(- x^2 + 8 x y + y^3) = 0\)</span></p>
<p><span class="math notranslate nohighlight">\(g(x,y) = (1 + 2x - 3y) + \lambda(x^2 + xy - y e^x) = 0\)</span></p>
<p>Now, at <span class="math notranslate nohighlight">\(\lambda=0\)</span> we have the simple linear equations:</p>
<p><span class="math notranslate nohighlight">\(x + y = -2\)</span></p>
<p><span class="math notranslate nohighlight">\(2x - 3y = -1\)</span></p>
<p>These equations are trivial to solve:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">([[</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.</span><span class="p">,</span> <span class="o">-</span><span class="mf">3.</span><span class="p">]],[</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">x0</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-1.4 -0.6]
</pre></div>
</div>
</div>
</div>
<p>We form the system of ODEs by differentiating the new equations with respect to <span class="math notranslate nohighlight">\(\lambda\)</span>. Why do we do that? The solution, (x,y) will be a function of <span class="math notranslate nohighlight">\(\lambda\)</span>. From calculus, you can show that:</p>
<p><span class="math notranslate nohighlight">\(\frac{\partial f}{\partial x}\frac{\partial x}{\partial \lambda}+\frac{\partial f}{\partial y}\frac{\partial y}{\partial \lambda}=-\frac{\partial f}{\partial \lambda}\)</span></p>
<p><span class="math notranslate nohighlight">\(\frac{\partial g}{\partial x}\frac{\partial x}{\partial \lambda}+\frac{\partial g}{\partial y}\frac{\partial y}{\partial \lambda}=-\frac{\partial g}{\partial \lambda}\)</span></p>
<p>Now, solve this for <span class="math notranslate nohighlight">\(\frac{\partial x}{\partial \lambda}\)</span> and <span class="math notranslate nohighlight">\(\frac{\partial y}{\partial \lambda}\)</span>. You can use Cramer’s rule to solve for these to yield:</p>
<p>\begin{eqnarray} <br />
\frac{\partial x}{\partial \lambda} &amp;=&amp; \frac{\partial f/\partial y \partial g/\partial \lambda - \partial f/\partial \lambda \partial g/\partial y}{\partial f/\partial x \partial g/\partial y - \partial f/\partial y \partial g/\partial x } \
\frac{\partial y}{\partial \lambda} &amp;=&amp; \frac{\partial f/\partial \lambda \partial g/\partial x - \partial f/\partial x \partial g/\partial \lambda}{\partial f/\partial x \partial g/\partial y - \partial f/\partial y \partial g/\partial x } \end{eqnarray}</p>
<p>For this set of equations:</p>
<p>\begin{eqnarray} <br />
\partial f/\partial x &amp;=&amp; 1 - 2\lambda x + 8\lambda y \
\partial f/\partial y &amp;=&amp; 1 + 8 \lambda x + 3 \lambda y^2 \
\partial g/\partial x &amp;=&amp; 2 + 2 \lambda x + \lambda y - \lambda y e^x\
\partial g/\partial y &amp;=&amp; -3 + \lambda x - \lambda e^x
\end{eqnarray}</p>
<p>Now, we simply set up those two differential equations on <span class="math notranslate nohighlight">\(\frac{\partial x}{\partial \lambda}\)</span> and <span class="math notranslate nohighlight">\(\frac{\partial y}{\partial \lambda}\)</span>, with the initial conditions at <span class="math notranslate nohighlight">\(\lambda = 0\)</span> which is the solution of the simpler linear equations, and integrate to <span class="math notranslate nohighlight">\(\lambda = 1\)</span>, which is the final solution of the original equations!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">ode</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">LAMBDA</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">X</span>
    <span class="n">pfpx</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">-</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">y</span>
    <span class="n">pfpy</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">+</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">y</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">pfpLAMBDA</span> <span class="o">=</span> <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">y</span><span class="o">**</span><span class="mi">3</span><span class="p">;</span>
    <span class="n">pgpx</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">+</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">pgpy</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.</span> <span class="o">+</span> <span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="n">LAMBDA</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">pgpLAMBDA</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">y</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="n">dxdLAMBDA</span> <span class="o">=</span> <span class="p">(</span><span class="n">pfpy</span> <span class="o">*</span> <span class="n">pgpLAMBDA</span> <span class="o">-</span> <span class="n">pfpLAMBDA</span> <span class="o">*</span> <span class="n">pgpy</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pfpx</span> <span class="o">*</span> <span class="n">pgpy</span> <span class="o">-</span> <span class="n">pfpy</span> <span class="o">*</span> <span class="n">pgpx</span><span class="p">)</span>
    <span class="n">dydLAMBDA</span> <span class="o">=</span> <span class="p">(</span><span class="n">pfpLAMBDA</span> <span class="o">*</span> <span class="n">pgpx</span> <span class="o">-</span> <span class="n">pfpx</span> <span class="o">*</span> <span class="n">pgpLAMBDA</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">pfpx</span> <span class="o">*</span> <span class="n">pgpy</span> <span class="o">-</span> <span class="n">pfpy</span> <span class="o">*</span> <span class="n">pgpx</span><span class="p">)</span>
    <span class="n">dXdLAMBDA</span> <span class="o">=</span> <span class="p">[</span><span class="n">dxdLAMBDA</span><span class="p">,</span> <span class="n">dydLAMBDA</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dXdLAMBDA</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>

<span class="n">lambda_span</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">ode</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">lambda_span</span><span class="p">)</span>

<span class="n">xsol</span><span class="p">,</span> <span class="n">ysol</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The solution is at x=</span><span class="si">{0:1.3f}</span><span class="s1">, y=</span><span class="si">{1:1.3f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">xsol</span><span class="p">,</span> <span class="n">ysol</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">xsol</span><span class="p">,</span> <span class="n">ysol</span><span class="p">),</span> <span class="n">g</span><span class="p">(</span><span class="n">xsol</span><span class="p">,</span> <span class="n">ysol</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The solution is at x=-1.000, y=0.000
-1.2774659880833895e-06 -1.1587381910702497e-06
</pre></div>
</div>
</div>
</div>
<p>You can see the solution is somewhat approximate; the true solution is x = -1, y = 0. The approximation could be improved by lowering the tolerance on the ODE solver. The functions evaluate to a small number, close to zero. You have to apply some judgment to determine if that is sufficiently accurate. For instance if the units on that answer are kilometers, but you need an answer accurate to a millimeter, this may not be accurate enough.</p>
<p>This is a fair amount of work to get a solution! The idea is to solve a simple problem, and then gradually turn on the hard part by the lambda parameter. What happens if there are multiple solutions? The answer you finally get will depend on your <span class="math notranslate nohighlight">\(\lambda=0\)</span>  starting point, so it is possible to miss solutions this way. For problems with lots of variables, this would be a good approach if you can identify the easy problem.</p>
</section>
<section id="method-of-continuity-for-solving-nonlinear-equations-part-ii">
<h2>Method of continuity for solving nonlinear equations - Part II<a class="headerlink" href="#method-of-continuity-for-solving-nonlinear-equations-part-ii" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/11/02/method-of-continuity-for-solving-nonlinear-equations-part-ii-2/">Matlab post</a></p>
<p>Yesterday in Post 1324 we looked at a way to solve nonlinear equations that takes away some of the burden of initial guess generation. The idea was to reformulate the equations with a new variable <span class="math notranslate nohighlight">\(\lambda\)</span>, so that at <span class="math notranslate nohighlight">\(\lambda=0\)</span> we have a simpler problem we know how to solve, and at <span class="math notranslate nohighlight">\(\lambda=1\)</span> we have the original set of equations. Then, we derive a set of ODEs on how the solution changes with <span class="math notranslate nohighlight">\(\lambda\)</span>, and solve them.</p>
<p>Today we look at a simpler example and explain a little more about what is going on. Consider the equation: <span class="math notranslate nohighlight">\(f(x) = x^2 - 5x + 6 = 0\)</span>, which has two roots, <span class="math notranslate nohighlight">\(x=2\)</span> and <span class="math notranslate nohighlight">\(x=3\)</span>. We will use the method of continuity to solve this equation to illustrate a few ideas. First, we introduce a new variable <span class="math notranslate nohighlight">\(\lambda\)</span> as: <span class="math notranslate nohighlight">\(f(x; \lambda) = 0\)</span>. For example, we could write <span class="math notranslate nohighlight">\(f(x;\lambda) = \lambda x^2 - 5x + 6 = 0\)</span>. Now, when <span class="math notranslate nohighlight">\(\lambda=0\)</span>, we hve the simpler equation <span class="math notranslate nohighlight">\(- 5x + 6 = 0\)</span>, with the solution <span class="math notranslate nohighlight">\(x=6/5\)</span>. The question now is, how does <span class="math notranslate nohighlight">\(x\)</span> change as <span class="math notranslate nohighlight">\(\lambda\)</span> changes? We get that from the total derivative of how <span class="math notranslate nohighlight">\(f(x,\lambda)\)</span> changes with <span class="math notranslate nohighlight">\(\lambda\)</span>. The total derivative is:</p>
<div class="math notranslate nohighlight">
\[\frac{df}{d\lambda} = \frac{\partial f}{\partial \lambda} + \frac{\partial f}{\partial x}\frac{\partial x}{\partial \lambda}=0\]</div>
<p>We can calculate two of those quantities: <span class="math notranslate nohighlight">\(\frac{\partial f}{\partial \lambda}\)</span> and <span class="math notranslate nohighlight">\(\frac{\partial f}{\partial x}\)</span> analytically from our equation and solve for <span class="math notranslate nohighlight">\(\frac{\partial x}{\partial \lambda}\)</span> as</p>
<div class="math notranslate nohighlight">
\[ \frac{\partial x}{\partial \lambda} = -\frac{\partial f}{\partial \lambda}/\frac{\partial f}{\partial x}\]</div>
<p>That defines an ordinary differential equation that we can solve by integrating from <span class="math notranslate nohighlight">\(\lambda=0\)</span> where we know the solution to <span class="math notranslate nohighlight">\(\lambda=1\)</span> which is the solution to the real problem. For this problem: <span class="math notranslate nohighlight">\(\frac{\partial f}{\partial \lambda}=x^2\)</span> and <span class="math notranslate nohighlight">\(\frac{\partial f}{\partial x}=-5 + 2\lambda x\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">dxdL</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">):</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="o">-</span><span class="mf">5.0</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">Lambda</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span>

<span class="n">x0</span> <span class="o">=</span> <span class="mf">6.0</span><span class="o">/</span><span class="mf">5.0</span>
<span class="n">Lspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">dxdL</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">Lspan</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Lspan</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\lambda$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5e6d23f592fd827ffc8511e365f0fef16c0f40aafd0c67828be875a752e21f5b.png" src="../_images/5e6d23f592fd827ffc8511e365f0fef16c0f40aafd0c67828be875a752e21f5b.png" />
</div>
</div>
<p>We found one solution at x=2. What about the other solution? To get that we have to introduce <span class="math notranslate nohighlight">\(\lambda\)</span> into the equations in another way. We could try: <span class="math notranslate nohighlight">\(f(x;\lambda) = x^2 + \lambda(-5x + 6)\)</span>, but this leads to an ODE that is singular at the initial starting point. Another approach is <span class="math notranslate nohighlight">\(f(x;\lambda) = x^2 + 6 + \lambda(-5x)\)</span>, but now the solution at <span class="math notranslate nohighlight">\(\lambda=0\)</span> is imaginary, and we do not have a way to integrate that! What we can do instead is add and subtract a number like this: <span class="math notranslate nohighlight">\(f(x;\lambda) = x^2 - 4 + \lambda(-5x + 6 + 4)\)</span>. Now at <span class="math notranslate nohighlight">\(\lambda=0\)</span>, we have a simple equation with roots at <span class="math notranslate nohighlight">\(\pm 2\)</span>, and we already know that <span class="math notranslate nohighlight">\(x=2\)</span> is a solution. So, we create our ODE on <span class="math notranslate nohighlight">\(dx/d\lambda\)</span> with initial condition <span class="math notranslate nohighlight">\(x(0) = -2\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="k">def</span><span class="w"> </span><span class="nf">dxdL</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">Lambda</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">Lambda</span><span class="p">)</span>

<span class="n">x0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="n">Lspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">dxdL</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">Lspan</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Lspan</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;$\lambda$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/bce8b5ffd0b408769195ac2beadc0a5f7c4cfdb06ba4d2c258cecf7812b31588.png" src="../_images/bce8b5ffd0b408769195ac2beadc0a5f7c4cfdb06ba4d2c258cecf7812b31588.png" />
</div>
</div>
<p>Now we have the other solution. Note if you choose the other root, <span class="math notranslate nohighlight">\(x=2\)</span>, you find that 2 is a root, and learn nothing new. You could choose other values to add, e.g., if you chose to add and subtract 16, then you would find that one starting point leads to one root, and the other starting point leads to the other root. This method does not solve all problems associated with nonlinear root solving, namely, how many roots are there, and which one is “best” or physically reasonable? But it does give a way to solve an equation where you have no idea what an initial guess should be. You can see, however, that just like you can get different answers from different initial guesses, here you can get different answers by setting up the equations differently.</p>
</section>
<section id="counting-roots">
<h2>Counting roots<a class="headerlink" href="#counting-roots" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/09/10/counting-roots/">Matlab post</a></p>
<p>The goal here is to determine how many roots there are in a nonlinear function we are interested in solving. For this example, we use a cubic polynomial because we know there are three roots.</p>
<div class="math notranslate nohighlight">
\[f(x) = x^3 + 6x^2 - 4x -24\]</div>
<section id="use-roots-for-this-polynomial">
<h3>Use roots for this polynomial<a class="headerlink" href="#use-roots-for-this-polynomial" title="Link to this heading">#</a></h3>
<p>This ony works for a polynomial, it does not work for any other nonlinear function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">24</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-6.  2. -2.]
</pre></div>
</div>
</div>
</div>
<p>Let us plot the function to see where the roots are.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">24</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a98cb17e3d6a8c07978c632d433b0ea8ace73930c77a56869af7e5ef093e31c1.png" src="../_images/a98cb17e3d6a8c07978c632d433b0ea8ace73930c77a56869af7e5ef093e31c1.png" />
</div>
</div>
<p>Now we consider several approaches to counting the number of roots in this interval. Visually it is pretty easy, you just look for where the function crosses zero. Computationally, it is tricker.</p>
</section>
<section id="method-1">
<h3>Method 1<a class="headerlink" href="#method-1" title="Link to this heading">#</a></h3>
<p>Count the number of times the sign changes in the interval. What we have to do is multiply neighboring elements together, and look for negative values. That indicates a sign change. For example the product of two positive or negative numbers is a positive number. You only get a negative number from the product of a positive and negative number, which means the sign changed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">+</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mi">24</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3
</pre></div>
</div>
</div>
</div>
<p>This method gives us the number of roots, but not where the roots are.</p>
</section>
<section id="method-2">
<h3>Method 2<a class="headerlink" href="#method-2" title="Link to this heading">#</a></h3>
<p>Using events in an ODE solver python can identify events in the solution to an ODE, for example, when a function has a certain value, e.g. f(x) = 0. We can take advantage of this to find the roots and number of roots in this case. We take the derivative of our function, and integrate it from an initial starting point, and define an event function that counts zeros.</p>
<div class="math notranslate nohighlight">
\[f'(x) = 3x^2 + 12x - 4\]</div>
<p>with f(-8) = -120</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">solve_ivp</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fprime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">12.0</span><span class="o">*</span><span class="n">x</span> <span class="o">-</span> <span class="mf">4.0</span>

<span class="k">def</span><span class="w"> </span><span class="nf">event</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">f</span> <span class="c1"># we want f = 0</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">xspan</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
<span class="n">f0</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">120</span><span class="p">,)</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">fprime</span><span class="p">,</span> <span class="n">xspan</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">event</span><span class="p">,</span> <span class="n">max_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">sol</span><span class="o">.</span><span class="n">t_events</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># these are the found roots</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-6., -2.,  2.])
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="finding-the-nth-root-of-a-periodic-function">
<h2>Finding the nth root of a periodic function<a class="headerlink" href="#finding-the-nth-root-of-a-periodic-function" title="Link to this heading">#</a></h2>
<p>There is a heat transfer problem where one needs to find the n^th root of the following equation: <span class="math notranslate nohighlight">\(x J_1(x) - Bi J_0(x)=0\)</span> where <span class="math notranslate nohighlight">\(J_0\)</span> and <span class="math notranslate nohighlight">\(J_1\)</span> are the Bessel functions of zero and first order, and <span class="math notranslate nohighlight">\(Bi\)</span> is the Biot number. We examine an approach to finding these roots.</p>
<p>First,  we plot the function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">jn</span><span class="p">,</span> <span class="n">jn_zeros</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">Bi</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">jn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">Bi</span> <span class="o">*</span> <span class="n">jn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">X</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f44d772267afbc9d75a6810e0575f6abf846824afc60df80ac25e2fdff245457.png" src="../_images/f44d772267afbc9d75a6810e0575f6abf846824afc60df80ac25e2fdff245457.png" />
</div>
</div>
<p>You can see there are many roots to this equation, and we want to be sure we get the n<sup>th</sup> root. This function is pretty well behaved, so if you make a good guess about the solution you will get an answer, but if you make a bad guess, you may get the wrong root. We examine next a way to do it without guessing the solution. What we want is the solution to <span class="math notranslate nohighlight">\(f(x) = 0\)</span>, but we want all the solutions in a given interval. We derive a new equation, <span class="math notranslate nohighlight">\(f'(x) = 0\)</span>, with initial condition <span class="math notranslate nohighlight">\(f(0) = f0\)</span>, and integrate the ODE with an event function that identifies all zeros of <span class="math notranslate nohighlight">\(f\)</span> for us. The derivative of our function is <span class="math notranslate nohighlight">\(df/dx = d/dx(x J_1(x)) - Bi J'_0(x)\)</span>. It is known (<a class="reference external" href="http://www.markrobrien.com/besselfunct.pdf">http://www.markrobrien.com/besselfunct.pdf</a>) that <span class="math notranslate nohighlight">\(d/dx(x J_1(x)) = x J_0(x)\)</span>, and <span class="math notranslate nohighlight">\(J'_0(x) = -J_1(x)\)</span>. All we have to do now is set up the problem and run it.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">pycse</span><span class="w"> </span><span class="kn">import</span> <span class="o">*</span>  <span class="c1"># contains the ode integrator with events</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">jn</span><span class="p">,</span> <span class="n">jn_zeros</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">Bi</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;function we want roots for&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">jn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">Bi</span> <span class="o">*</span> <span class="n">jn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fprime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;df/dx&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">jn</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">Bi</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">jn</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="k">def</span><span class="w"> </span><span class="nf">e1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
    <span class="s2">&quot;event function to find zeros of f&quot;</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">f</span>
    <span class="k">return</span> <span class="n">value</span>

<span class="n">f0</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="mi">0</span><span class="p">),)</span>
<span class="n">xspan</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">solve_ivp</span><span class="p">(</span><span class="n">fprime</span><span class="p">,</span> <span class="n">xspan</span><span class="p">,</span> <span class="n">f0</span><span class="p">,</span> <span class="n">events</span><span class="o">=</span><span class="n">e1</span><span class="p">,</span> <span class="n">max_step</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">sol</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="s1">&#39;.-&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Numerical solution&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t</span><span class="p">),</span> <span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Analytical function&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sol</span><span class="o">.</span><span class="n">t_events</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">sol</span><span class="o">.</span><span class="n">y_events</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;roots&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f1c453b2c1dba605670b14f242694b57af3162d44fa96d6208bd23f515f64acd.png" src="../_images/f1c453b2c1dba605670b14f242694b57af3162d44fa96d6208bd23f515f64acd.png" />
</div>
</div>
<p>You can work this out once, and then you have all the roots in the interval and you can select the one you want.</p>
</section>
<section id="coupled-nonlinear-equations">
<h2>Coupled nonlinear equations<a class="headerlink" href="#coupled-nonlinear-equations" title="Link to this heading">#</a></h2>
<p>Suppose we seek the solution to this set of equations:</p>
<p>\begin{align}
y &amp;=&amp; x^2 \
y &amp;=&amp; 8 - x^2
\end{align}</p>
<p>To solve this we need to setup a function that is equal to zero at the solution. We have two equations, so our function must return two values. There are two variables, so the argument to our function will be an array of values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>

<span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">X</span>            <span class="c1"># unpack the array in the argument</span>
    <span class="n">z1</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>       <span class="c1"># first equation</span>
    <span class="n">z2</span> <span class="o">=</span> <span class="n">y</span> <span class="o">-</span> <span class="mi">8</span> <span class="o">+</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>   <span class="c1"># second equation</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="p">]</span>     <span class="c1"># list of zeros</span>

<span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>           <span class="c1"># initial guesses</span>
<span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">]</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>

<span class="c1"># of course there may be more than one solution</span>
<span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>           <span class="c1"># initial guesses</span>
<span class="n">guess</span> <span class="o">=</span> <span class="p">[</span><span class="n">x0</span><span class="p">,</span> <span class="n">y0</span><span class="p">]</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="n">guess</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sol</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[2. 4.]
[-2.  4.]
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./blog"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="linear-algebra.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Linear algebra</p>
      </div>
    </a>
    <a class="right-next"
       href="statistics.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Statistics</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#know-your-tolerance">Know your tolerance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-integral-equations-with-fsolve">Solving integral equations with fsolve</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-notes">Summary notes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method-of-continuity-for-nonlinear-equation-solving">Method of continuity for nonlinear equation solving</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#method-of-continuity-for-solving-nonlinear-equations-part-ii">Method of continuity for solving nonlinear equations - Part II</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#counting-roots">Counting roots</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#use-roots-for-this-polynomial">Use roots for this polynomial</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-1">Method 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#method-2">Method 2</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-the-nth-root-of-a-periodic-function">Finding the nth root of a periodic function</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#coupled-nonlinear-equations">Coupled nonlinear equations</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By John Kitchin
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <!-- RAG Chat Widget - Self-contained version for Jupyter Book -->
<style>
/* RAG Widget Styles */
:root {
    --widget-primary-color: #1f77b4;
    --widget-primary-hover: #1565a8;
    --widget-bg-color: #ffffff;
    --widget-text-color: #262730;
    --widget-border-color: #e0e0e0;
    --widget-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    --widget-shadow-lg: 0 12px 32px rgba(0, 0, 0, 0.2);
    --widget-border-radius: 16px;
    --widget-button-size: 60px;
    --widget-z-index: 9999;
}

.rag-widget {
    position: fixed;
    z-index: var(--widget-z-index);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
    bottom: 20px;
    right: 20px;
}

.widget-button {
    width: var(--widget-button-size);
    height: var(--widget-button-size);
    border-radius: 50%;
    background-color: var(--widget-primary-color);
    border: none;
    box-shadow: var(--widget-shadow);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.widget-button:hover {
    background-color: var(--widget-primary-hover);
    box-shadow: var(--widget-shadow-lg);
    transform: scale(1.05);
}

.widget-button:active {
    transform: scale(0.95);
}

.widget-icon,
.widget-close-icon {
    width: 28px;
    height: 28px;
    color: white;
    transition: all 0.3s ease;
    position: absolute;
}

.widget-close-icon {
    opacity: 0;
    transform: rotate(90deg) scale(0);
}

.widget-button.active .widget-icon {
    opacity: 0;
    transform: rotate(-90deg) scale(0);
}

.widget-button.active .widget-close-icon {
    opacity: 1;
    transform: rotate(0deg) scale(1);
}

.widget-container {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: min(50vw, calc(100vw - 40px));
    height: min(600px, calc(100vh - 120px));
    max-width: calc(100vw - 40px);
    max-height: calc(100vh - 120px);
    background-color: var(--widget-bg-color);
    border-radius: var(--widget-border-radius);
    box-shadow: var(--widget-shadow-lg);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    opacity: 0;
    transform: scale(0.9) translateY(10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

.widget-container.visible {
    opacity: 1;
    transform: scale(1) translateY(0);
    pointer-events: all;
}

.widget-container.hidden {
    display: none;
}

.widget-header {
    background-color: var(--widget-primary-color);
    color: white;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
}

.widget-header-content {
    flex: 1;
}

.widget-title {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    line-height: 1.2;
}

.widget-subtitle {
    margin: 4px 0 0 0;
    font-size: 13px;
    opacity: 0.9;
    line-height: 1.2;
}

.widget-minimize-btn {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: background-color 0.2s ease;
}

.widget-minimize-btn:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.widget-minimize-btn svg {
    width: 20px;
    height: 20px;
}

.widget-iframe-container {
    flex: 1;
    position: relative;
    overflow: hidden;
    background-color: #f5f5f5;
}

#widget-iframe {
    width: 100%;
    height: 100%;
    border: none;
}

.widget-footer {
    padding: 12px 20px;
    background-color: var(--widget-bg-color);
    border-top: 1px solid var(--widget-border-color);
    text-align: center;
    flex-shrink: 0;
}

.widget-powered-by {
    font-size: 12px;
    color: #666;
}

.widget-powered-by a {
    color: var(--widget-primary-color);
    text-decoration: none;
    font-weight: 500;
}

.widget-powered-by a:hover {
    text-decoration: underline;
}

@media (max-width: 768px) {
    .widget-container {
        width: 100%;
        height: 100%;
        max-width: 100%;
        max-height: 100%;
        bottom: 0;
        right: 0;
        left: 0;
        top: 0;
        border-radius: 0;
    }

    .widget-button {
        width: 56px;
        height: 56px;
    }

    .widget-icon,
    .widget-close-icon {
        width: 24px;
        height: 24px;
    }
}

@media (max-width: 480px) {
    .rag-widget {
        bottom: 16px;
        right: 16px;
    }
}

.widget-iframe-container::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid var(--widget-primary-color);
    border-radius: 50%;
    animation: widget-spin 1s linear infinite;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.widget-iframe-container.loading::before {
    opacity: 1;
}

@keyframes widget-spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

@media (prefers-color-scheme: dark) {
    :root {
        --widget-bg-color: #1e1e1e;
        --widget-text-color: #ffffff;
        --widget-border-color: #333333;
    }

    .widget-iframe-container {
        background-color: #252525;
    }
}

.widget-button:focus,
.widget-minimize-btn:focus {
    outline: 2px solid var(--widget-primary-color);
    outline-offset: 2px;
}

@media print {
    .rag-widget {
        display: none !important;
    }
}
</style>

<div id="rag-widget" class="rag-widget">
    <!-- Floating Button -->
    <button id="widget-button" class="widget-button" aria-label="Open chat">
        <svg class="widget-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
            <path d="M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>
        </svg>
        <svg class="widget-close-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
    </button>

    <!-- Chat Container -->
    <div id="widget-container" class="widget-container hidden">
        <!-- Header -->
        <div class="widget-header">
            <div class="widget-header-content">
                <h3 class="widget-title">Secret A(i)gent</h3>
                <p class="widget-subtitle">Ask me anything</p>
            </div>
            <button id="widget-minimize" class="widget-minimize-btn" aria-label="Minimize chat">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13H5v-2h14v2z"/>
                </svg>
            </button>
        </div>

        <!-- Chat iframe -->
        <div class="widget-iframe-container">
            <iframe
                id="widget-iframe"
                src=""
                frameborder="0"
                allow="clipboard-write"
                title="RAG Chat Assistant">
            </iframe>
        </div>

        <!-- Footer -->
        <div class="widget-footer">
            <span class="widget-powered-by">
                Powered by <a href="https://github.com/jkitchin/streamlit-rag-widget" target="_blank">a Secret A(i)gent</a>
            </span>
        </div>
    </div>
</div>

<script>
/**
 * RAG Widget Configuration and Script
 */
(function() {
    'use strict';

    // Configuration
    const config = {
        streamlitUrl: 'https://kitchin-services.cheme.cmu.edu',
        position: 'bottom-right',
        width: '50vw',
        height: '600px',
        primaryColor: '#1f77b4',
        title: 'Secret A(i)gent',
        subtitle: 'Ask me anything',
        showPoweredBy: true,
        autoOpen: false,
        openDelay: 0,
        zIndex: 9999,
    };

    // Widget state
    let isOpen = false;

    // Get DOM elements
    const widget = document.getElementById('rag-widget');
    const button = document.getElementById('widget-button');
    const container = document.getElementById('widget-container');
    const iframe = document.getElementById('widget-iframe');
    const minimizeBtn = document.getElementById('widget-minimize');
    const iframeContainer = document.querySelector('.widget-iframe-container');

    if (!widget || !button || !container || !iframe) {
        console.error('RAG Widget: Required elements not found');
        return;
    }

    /**
     * Initialize widget
     */
    function init() {
        // Set iframe URL
        iframe.src = config.streamlitUrl;

        // Set custom colors
        if (config.primaryColor) {
            document.documentElement.style.setProperty('--widget-primary-color', config.primaryColor);
        }

        // Set title and subtitle
        const title = document.querySelector('.widget-title');
        const subtitle = document.querySelector('.widget-subtitle');
        if (title && config.title) {
            title.textContent = config.title;
        }
        if (subtitle && config.subtitle) {
            subtitle.textContent = config.subtitle;
        }

        // Hide powered by if configured
        if (!config.showPoweredBy) {
            const footer = document.querySelector('.widget-footer');
            if (footer) {
                footer.style.display = 'none';
            }
        }

        // Add event listeners
        button.addEventListener('click', toggleWidget);
        minimizeBtn.addEventListener('click', closeWidget);

        // Handle keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && isOpen) {
                closeWidget();
            }
        });

        // Auto-open if configured
        if (config.autoOpen) {
            setTimeout(openWidget, config.openDelay);
        }

        console.log('RAG Widget initialized');
    }

    /**
     * Toggle widget open/closed
     */
    function toggleWidget() {
        if (isOpen) {
            closeWidget();
        } else {
            openWidget();
        }
    }

    /**
     * Open widget
     */
    function openWidget() {
        isOpen = true;
        button.classList.add('active');
        container.classList.remove('hidden');

        setTimeout(function() {
            container.classList.add('visible');
        }, 10);

        setTimeout(function() {
            iframe.focus();
        }, 300);
    }

    /**
     * Close widget
     */
    function closeWidget() {
        isOpen = false;
        button.classList.remove('active');
        container.classList.remove('visible');

        setTimeout(function() {
            container.classList.add('hidden');
        }, 300);
    }

    /**
     * Public API
     */
    window.RAGWidget = {
        open: openWidget,
        close: closeWidget,
        toggle: toggleWidget,
        isOpen: function() { return isOpen; }
    };

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

})();
</script>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>
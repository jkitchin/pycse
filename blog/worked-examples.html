
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Worked examples &#8212; pycse - Python Computations in Science and Engineering</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=03e43079" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script kind="utterances">

    var commentsRunWhenDOMLoaded = cb => {
    if (document.readyState != 'loading') {
        cb()
    } else if (document.addEventListener) {
        document.addEventListener('DOMContentLoaded', cb)
    } else {
        document.attachEvent('onreadystatechange', function() {
        if (document.readyState == 'complete') cb()
        })
    }
}

var addUtterances = () => {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "https://utteranc.es/client.js";
    script.async = "async";

    script.setAttribute("repo", "jkitchin/dsmles");
    script.setAttribute("issue-term", "pathname");
    script.setAttribute("theme", "github-light");
    script.setAttribute("label", "💬 comment");
    script.setAttribute("crossorigin", "anonymous");

    sections = document.querySelectorAll("div.section");
    if (sections !== null) {
        section = sections[sections.length-1];
        section.appendChild(script);
    }
}
commentsRunWhenDOMLoaded(addUtterances);
</script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-4H7VFJKEZY"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4H7VFJKEZY');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-4H7VFJKEZY');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'blog/worked-examples';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="About pycse" href="../docs/about.html" />
    <link rel="prev" title="Programming" href="programming.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/pycse.png" class="logo__image only-light" alt="pycse - Python Computations in Science and Engineering - Home"/>
    <script>document.write(`<img src="../_static/pycse.png" class="logo__image only-dark" alt="pycse - Python Computations in Science and Engineering - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Welcome to pycse - Python Computations in Science and Engineering
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">The pycse book</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../book/intro.html">The pycse book</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/00-intro.html">Introduction to Python and Jupyter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/01-jupyter.html">More about using Jupyter notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/02-integration-1.html">Integration in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/03-fode-1.html">First-order differential equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/04-fode-2.html">Systems of first-order differential equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/05-nth-odes.html">N<sup>th</sup> order differential equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/07-nla-1.html">Nonlinear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/08-nla-2.html">Polynomials in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/09-bvp.html">Boundary value problems</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/10-min-max.html">Introduction to optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/11-regression.html">Nonlinear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/12-nonlinear-regression-2.html">Uncertainty quantification in nonlinear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/13-constrained-optimization.html">Constrained optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/15-intro-linear-algebra.html">Introduction to linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/16-linear-algebra.html">Applications of linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/17-linear-algebra-2.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/18-linear-regression.html">Linear regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/20-autograd-applications.html">Introduction to automatic differentiation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/21-machine-learning.html">Introduction to machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/22-ml-2.html">Topics in machine learning</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/23-gp.html">Gaussian Process Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../book/conclusions.html">Concluding remarks</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">The pycse blog</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="intro.html">The PYCSE blog</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic-python.html">Basic python usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="math.html">Math</a></li>
<li class="toctree-l1"><a class="reference internal" href="linear-algebra.html">Linear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="nonlinear-algebra.html">Nonlinear algebra</a></li>
<li class="toctree-l1"><a class="reference internal" href="statistics.html">Statistics</a></li>
<li class="toctree-l1"><a class="reference internal" href="data-analysis.html">Data analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="interpolation.html">Interpolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="optimization.html">Optimization</a></li>
<li class="toctree-l1"><a class="reference internal" href="differential-equations.html">Differential equations</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Plotting</a></li>
<li class="toctree-l1"><a class="reference internal" href="units.html">Units</a></li>
<li class="toctree-l1"><a class="reference internal" href="programming.html">Programming</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Worked examples</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">pycse documentation</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../docs/about.html">About pycse</a></li>

<li class="toctree-l1"><a class="reference internal" href="../docs/running-pycse.html">Running pycse</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/pycse.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/beginner.html">pycse - Beginner mode</a></li>





<li class="toctree-l1"><a class="reference internal" href="../docs/utils.html">pycse.utils</a></li>



<li class="toctree-l1"><a class="reference internal" href="../docs/execution-statistics.html">Build statistics</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://lab.amdatascience.com/hub/user-redirect/git-pull?repo=https%3A//github.com/jkitchin/pycse&urlpath=lab/tree/pycse/pycse-jb/pycse___python_computations_in_science_and_engineering/blog/worked-examples.ipynb&branch=master" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on JupyterHub"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="JupyterHub logo" src="../_static/images/logo_jupyterhub.svg">
  </span>
<span class="btn__text-container">JupyterHub</span>
</a>
</li>
      
      
      
      
      <li><a href="https://colab.research.google.com/github/jkitchin/pycse/blob/master/pycse-jb/pycse___python_computations_in_science_and_engineering/blog/worked-examples.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Colab"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Colab logo" src="../_static/images/logo_colab.png">
  </span>
<span class="btn__text-container">Colab</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jkitchin/pycse" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jkitchin/pycse/edit/master/pycse-jb/pycse___python_computations_in_science_and_engineering/blog/worked-examples.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jkitchin/pycse/issues/new?title=Issue%20on%20page%20%2Fblog/worked-examples.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/blog/worked-examples.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Worked examples</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#peak-finding-in-raman-spectroscopy">Peak finding in Raman spectroscopy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-notes">Summary notes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fitting-to-get-overlapping-peak-areas">Curve fitting to get overlapping peak areas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#notable-differences-from-matlab">Notable differences from Matlab</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-boiling-point-of-water">Estimating the boiling point of water</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gibbs-energy-minimization-and-the-nist-webbook">Gibbs energy minimization and the NIST webbook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-mole-fractions-and-partial-pressures">Compute mole fractions and partial pressures</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-equilibrium-constants">Computing equilibrium constants</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-equilibrium-composition-by-direct-minimization-of-gibbs-free-energy-on-mole-numbers">Finding equilibrium composition by direct minimization of Gibbs free energy on mole numbers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gibbs-energy-of-a-mixture">The Gibbs energy of a mixture</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-equality-constraints-for-atomic-mass-conservation">Linear equality constraints for atomic mass conservation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equilibrium-constant-based-on-mole-numbers">Equilibrium constant based on mole numbers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition">The Gibbs free energy of a reacting mixture and the equilibrium composition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#water-gas-shift-equilibria-via-the-nist-webbook">Water gas shift equilibria via the NIST Webbook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hydrogen">hydrogen</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h2o">H<sub>2</sub>O</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#co">CO</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#co2">CO<sub>2</sub></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-state-heat-of-reaction">Standard state heat of reaction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-standard-state-delta-h-and-delta-g">Non-standard state <span class="math notranslate nohighlight">\(\Delta H\)</span> and <span class="math notranslate nohighlight">\(\Delta G\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-how-the-delta-g-varies-with-temperature">Plot how the <span class="math notranslate nohighlight">\(\Delta G\)</span> varies with temperature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equilibrium-constant-calculation">Equilibrium constant calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equilibrium-yield-of-wgs">Equilibrium yield of WGS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-gas-phase-pressures-of-each-species">Compute gas phase pressures of each species</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-the-equilibrium-constants">Compare the equilibrium constants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constrained-minimization-to-find-equilibrium-compositions">Constrained minimization to find equilibrium compositions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-constrained-optimization-to-find-the-amount-of-each-phase-present">Using constrained optimization to find the amount of each phase present</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conservation-of-mass-in-chemical-reactions">Conservation of mass in chemical reactions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead">Numerically calculating an effectiveness factor for a porous catalyst bead</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-a-pipe-diameter">Computing a pipe diameter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-parameter-database-text-files-in-python">Reading parameter database text files in python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-a-bubble-point-pressure-of-a-mixture">Calculating a bubble point pressure of a mixture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equal-area-method-for-the-van-der-waals-equation">The equal area method for the van der Waals equation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-areas">Compute areas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dependent-concentration-in-a-first-order-reversible-reaction-in-a-batch-reactor">Time dependent concentration in a first order reversible reaction in a batch reactor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-equilibrium-conversion">Finding equilibrium conversion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrating-a-batch-reactor-design-equation">Integrating a batch reactor design equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-in-an-integral-equation">Uncertainty in an integral equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrating-the-batch-reactor-mole-balance">Integrating the batch reactor mole balance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plug-flow-reactor-with-a-pressure-drop">Plug flow reactor with a pressure drop</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-cstr-design-equations">Solving CSTR design equations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#meet-the-steam-tables">Meet the steam tables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-point-in-the-rankine-cycle-in-condenser">Starting point in the Rankine cycle in condenser.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#isentropic-compression-of-liquid-to-point-2">Isentropic compression of liquid to point 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#isobaric-heating-to-t3-in-boiler-where-we-make-steam">Isobaric heating to T3 in boiler where we make steam</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#isentropic-expansion-through-turbine-to-point-4">Isentropic expansion through turbine to point 4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-get-from-point-4-to-point-1">To get from point 4 to point 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficiency">Efficiency</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#entropy-temperature-chart">Entropy-temperature chart</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-region-is-a-point-in">What region is a point in</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="worked-examples">
<h1>Worked examples<a class="headerlink" href="#worked-examples" title="Link to this heading">#</a></h1>
<section id="peak-finding-in-raman-spectroscopy">
<h2>Peak finding in Raman spectroscopy<a class="headerlink" href="#peak-finding-in-raman-spectroscopy" title="Link to this heading">#</a></h2>
<p>Raman spectroscopy is a vibrational spectroscopy. The data typically comes as intensity vs. wavenumber, and it is discrete. Sometimes it is necessary to identify the precise location of a peak. In this post, we will use spline smoothing to construct an interpolating function of the data, and then use fminbnd to identify peak positions.</p>
<p>This example was originally worked out in Matlab at <a class="reference external" href="http://matlab.cheme.cmu.edu/2012/08/27/peak-finding-in-raman-spectroscopy/">http://matlab.cheme.cmu.edu/2012/08/27/peak-finding-in-raman-spectroscopy/</a></p>
<p>Let us take a look at the raw data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">w</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;../../data/raman.txt&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Raman shift (cm$^{-1}$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (counts)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">w</span><span class="p">,</span> <span class="n">i</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;../../data/raman.txt&quot;</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">unpack</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Raman shift (cm$^{-1}$)&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_npyio_impl.py:1397,</span> in <span class="ni">loadtxt</span><span class="nt">(fname, dtype, comments, delimiter, converters, skiprows, usecols, unpack, ndmin, encoding, max_rows, quotechar, like)</span>
<span class="g g-Whitespace">   </span><span class="mi">1394</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delimiter</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1395</span>     <span class="n">delimiter</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1397</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">_read</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1398</span>             <span class="n">converters</span><span class="o">=</span><span class="n">converters</span><span class="p">,</span> <span class="n">skiplines</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1399</span>             <span class="n">unpack</span><span class="o">=</span><span class="n">unpack</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="n">ndmin</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1400</span>             <span class="n">max_rows</span><span class="o">=</span><span class="n">max_rows</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="n">quotechar</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1402</span> <span class="k">return</span> <span class="n">arr</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_npyio_impl.py:1024,</span> in <span class="ni">_read</span><span class="nt">(fname, delimiter, comment, quote, imaginary_unit, usecols, skiplines, max_rows, converters, ndmin, unpack, dtype, encoding)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>     <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1024</span>     <span class="n">fh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">_datasource</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1025</span>     <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1026</span>         <span class="n">encoding</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="s1">&#39;encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;latin1&#39;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_datasource.py:192,</span> in <span class="ni">open</span><span class="nt">(path, mode, destpath, encoding, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span><span class="sd"> Open `path` with `mode` and return the file object.</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span><span class="sd"> </span>
<span class="sd">   (...)    188 </span>
<span class="g g-Whitespace">    </span><span class="mi">189</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">191</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">(</span><span class="n">destpath</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">192</span> <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_datasource.py:526,</span> in <span class="ni">DataSource.open</span><span class="nt">(self, path, mode, encoding, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">524</span>     <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;bz2&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">525</span>         <span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">526</span>     <span class="k">return</span> <span class="n">_file_openers</span><span class="p">[</span><span class="n">ext</span><span class="p">](</span><span class="n">found</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">527</span>                               <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">528</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">529</span>     <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../../data/raman.txt&#39;
</pre></div>
</div>
</div>
</div>
<p>The next thing to do is narrow our focus to the region we are interested in between 1340 cm<sup>-1</sup> and 1360 cm<sup>-1</sup>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">&gt;</span> <span class="mi">1340</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">1360</span><span class="p">)</span>
<span class="n">w1</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
<span class="n">i1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="s2">&quot;b. &quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Raman shift (cm$^{-1}$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (counts)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">ind</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span> <span class="o">&gt;</span> <span class="mi">1340</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">w</span> <span class="o">&lt;</span> <span class="mi">1360</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">w1</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">i1</span> <span class="o">=</span> <span class="n">i</span><span class="p">[</span><span class="n">ind</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;w&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Next we consider a scipy:UnivariateSpline. This function “smooths” the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnivariateSpline</span>

<span class="c1"># s is a &quot;smoothing&quot; factor</span>
<span class="n">sp</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="s2">&quot;b. &quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">sp</span><span class="p">(</span><span class="n">w1</span><span class="p">),</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Raman shift (cm$^{-1}$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (counts)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">UnivariateSpline</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="c1"># s is a &quot;smoothing&quot; factor</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">sp</span> <span class="o">=</span> <span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="s2">&quot;b. &quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">sp</span><span class="p">(</span><span class="n">w1</span><span class="p">),</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;w1&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>Note that the UnivariateSpline function returns a “callable” function! Our next goal is to find the places where there are peaks. This is defined by the first derivative of the data being equal to zero. It is easy to get the first derivative of a UnivariateSpline with a second argument as shown below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the first derivative evaluated at all the points</span>
<span class="n">d1s</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">derivative</span><span class="p">()</span>

<span class="n">d1</span> <span class="o">=</span> <span class="n">d1s</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>

<span class="c1"># we can get the roots directly here, which correspond to minima and</span>
<span class="c1"># maxima.</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Roots = </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sp</span><span class="o">.</span><span class="n">derivative</span><span class="p">()</span><span class="o">.</span><span class="n">roots</span><span class="p">()))</span>
<span class="n">minmax</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">derivative</span><span class="p">()</span><span class="o">.</span><span class="n">roots</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">d1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;first derivative&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Raman shift (cm$^{-1}$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;First derivative&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">minmax</span><span class="p">,</span> <span class="n">d1s</span><span class="p">(</span><span class="n">minmax</span><span class="p">),</span> <span class="s2">&quot;ro &quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;zeros&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">i1</span><span class="p">,</span> <span class="s2">&quot;b. &quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">w1</span><span class="p">,</span> <span class="n">sp</span><span class="p">(</span><span class="n">w1</span><span class="p">),</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Raman shift (cm$^{-1}$)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (counts)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">minmax</span><span class="p">,</span> <span class="n">sp</span><span class="p">(</span><span class="n">minmax</span><span class="p">),</span> <span class="s2">&quot;ro &quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># get the first derivative evaluated at all the points</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">d1s</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">derivative</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">d1</span> <span class="o">=</span> <span class="n">d1s</span><span class="p">(</span><span class="n">w1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="c1"># we can get the roots directly here, which correspond to minima and</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="c1"># maxima.</span>

<span class="ne">NameError</span>: name &#39;sp&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>In the end, we have illustrated how to construct a spline smoothing interpolation function and to find maxima in the function, including generating some initial guesses. There is more art to this than you might like, since you have to judge how much smoothing is enough or too much. With too much, you may smooth peaks out. With too little, noise may be mistaken for peaks.</p>
<section id="summary-notes">
<h3>Summary notes<a class="headerlink" href="#summary-notes" title="Link to this heading">#</a></h3>
<p>Using org-mode with  allows a large script to be broken up into mini sections. However, it only seems to work with the default python mode in Emacs, and it does not work with emacs-for-python or the latest python-mode. I also do not really like the output style, e.g. the output from the plotting commands.</p>
</section>
</section>
<section id="curve-fitting-to-get-overlapping-peak-areas">
<h2>Curve fitting to get overlapping peak areas<a class="headerlink" href="#curve-fitting-to-get-overlapping-peak-areas" title="Link to this heading">#</a></h2>
<p>Today we examine an approach to fitting curves to overlapping peaks to deconvolute them so we can estimate the area under each curve. We have a text file that contains data from a gas chromatograph with two peaks that overlap. We want the area under each peak to estimate the gas composition. You will see how to read the text file in, parse it to get the data for plotting and analysis, and then how to fit it.</p>
<p>A line like “# of Points	9969” tells us the number of points we have to read. The data starts after a line containing “R.Time	Intensity”. Here we read the number of points, and then get the data into arrays.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">datafile</span> <span class="o">=</span> <span class="s2">&quot;../../data/gc-data-21.txt&quot;</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
    <span class="k">if</span> <span class="s2">&quot;# of Points&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">npoints</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">elif</span> <span class="s2">&quot;R.Time</span><span class="se">\t</span><span class="s2">Intensity&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">break</span>

<span class="c1"># now get the data</span>
<span class="n">t</span><span class="p">,</span> <span class="n">intensity</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="n">npoints</span><span class="p">):</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
    <span class="n">t</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="n">intensity</span> <span class="o">+=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span>

<span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">intensity</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">intensity</span><span class="p">,</span> <span class="nb">float</span><span class="p">)</span>

<span class="c1"># now plot the data in the relevant time frame</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (arb. units)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">7</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">datafile</span> <span class="o">=</span> <span class="s2">&quot;../../data/gc-data-21.txt&quot;</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">datafile</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>     <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/IPython/core/interactiveshell.py:343,</span> in <span class="ni">_modified_open</span><span class="nt">(file, *args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">336</span> <span class="k">if</span> <span class="n">file</span> <span class="ow">in</span> <span class="p">{</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">}:</span>
<span class="g g-Whitespace">    </span><span class="mi">337</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">338</span>         <span class="sa">f</span><span class="s2">&quot;IPython won&#39;t let you open fd=</span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s2"> by default &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">339</span>         <span class="s2">&quot;as it is likely to crash IPython. If you know what you are doing, &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">340</span>         <span class="s2">&quot;you can use builtins&#39; open.&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">341</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">343</span> <span class="k">return</span> <span class="n">io_open</span><span class="p">(</span><span class="n">file</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../../data/gc-data-21.txt&#39;
</pre></div>
</div>
</div>
</div>
<p>You can see there is a non-zero baseline. We will normalize that by the average between 4 and 4.4 seconds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">intensity</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intensity</span><span class="p">[(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mf">4.4</span><span class="p">)])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (arb. units)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">intensity</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">intensity</span><span class="p">[(</span><span class="n">t</span> <span class="o">&gt;</span> <span class="mf">4.0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">t</span> <span class="o">&lt;</span> <span class="mf">4.4</span><span class="p">)])</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;intensity&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The peaks are asymmetric, decaying gaussian functions. We define a function for this</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.special</span><span class="w"> </span><span class="kn">import</span> <span class="n">erf</span>


<span class="k">def</span><span class="w"> </span><span class="nf">asym_peak</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pars</span><span class="p">):</span>
    <span class="s2">&quot;from Anal. Chem. 1994, 66, 1294-1301&quot;</span>
    <span class="n">a0</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># peak area</span>
    <span class="n">a1</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># elution time</span>
    <span class="n">a2</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># width of gaussian</span>
    <span class="n">a3</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># exponential damping term</span>
    <span class="n">f</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">a0</span>
        <span class="o">/</span> <span class="mi">2</span>
        <span class="o">/</span> <span class="n">a3</span>
        <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">a2</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="n">a3</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">a1</span> <span class="o">-</span> <span class="n">t</span><span class="p">)</span> <span class="o">/</span> <span class="n">a3</span><span class="p">)</span>
        <span class="o">*</span> <span class="p">(</span><span class="n">erf</span><span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">a2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">a3</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">f</span>
</pre></div>
</div>
</div>
</div>
<p>To get two peaks, we simply add two peaks together.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">two_peaks</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">pars</span><span class="p">):</span>
    <span class="s2">&quot;function of two overlapping peaks&quot;</span>
    <span class="n">a10</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># peak area</span>
    <span class="n">a11</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># elution time</span>
    <span class="n">a12</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># width of gaussian</span>
    <span class="n">a13</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>  <span class="c1"># exponential damping term</span>
    <span class="n">a20</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>  <span class="c1"># peak area</span>
    <span class="n">a21</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>  <span class="c1"># elution time</span>
    <span class="n">a22</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>  <span class="c1"># width of gaussian</span>
    <span class="n">a23</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>  <span class="c1"># exponential damping term</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">asym_peak</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">[</span><span class="n">a10</span><span class="p">,</span> <span class="n">a11</span><span class="p">,</span> <span class="n">a12</span><span class="p">,</span> <span class="n">a13</span><span class="p">])</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">asym_peak</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="p">[</span><span class="n">a20</span><span class="p">,</span> <span class="n">a21</span><span class="p">,</span> <span class="n">a22</span><span class="p">,</span> <span class="n">a23</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">p1</span> <span class="o">+</span> <span class="n">p2</span>
</pre></div>
</div>
</div>
</div>
<p>To show the function is close to reasonable, we plot the fitting function with an initial guess for each parameter. The fit is not good, but we have only guessed the parameters for now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">parguess</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1500</span><span class="p">,</span> <span class="mf">4.85</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">two_peaks</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">parguess</span><span class="p">),</span> <span class="s2">&quot;g-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (arb. units)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">parguess</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1500</span><span class="p">,</span> <span class="mf">4.85</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mi">5000</span><span class="p">,</span> <span class="mf">5.1</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">two_peaks</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">parguess</span><span class="p">),</span> <span class="s2">&quot;g-&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="ne">NameError</span>: name &#39;t&#39; is not defined
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<p>Next, we use nonlinear curve fitting from scipy.optimize.curve_fit</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>

<span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">two_peaks</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">parguess</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">popt</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">two_peaks</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">parguess</span><span class="p">),</span> <span class="s2">&quot;g-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">two_peaks</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">popt</span><span class="p">),</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;initial guess&quot;</span><span class="p">,</span> <span class="s2">&quot;final fit&quot;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">popt</span><span class="p">,</span> <span class="n">pcov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">two_peaks</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">,</span> <span class="n">parguess</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="nb">print</span><span class="p">(</span><span class="n">popt</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;t&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The fits are not perfect. The small peak is pretty good, but there is an unphysical tail on the larger peak, and a small mismatch at the peak. There is not much to do about that, it means the model peak we are using is not a good model for the peak. We will still integrate the areas though.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pars1</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="n">pars2</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>

<span class="n">peak1</span> <span class="o">=</span> <span class="n">asym_peak</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pars1</span><span class="p">)</span>
<span class="n">peak2</span> <span class="o">=</span> <span class="n">asym_peak</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pars2</span><span class="p">)</span>

<span class="n">area1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">peak1</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>
<span class="n">area2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">peak2</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Area 1 = </span><span class="si">{0:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area1</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Area 2 = </span><span class="si">{0:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Area 1 is </span><span class="si">{0:1.2%}</span><span class="s2"> of the whole area&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area1</span> <span class="o">/</span> <span class="p">(</span><span class="n">area1</span> <span class="o">+</span> <span class="n">area2</span><span class="p">)))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Area 2 is </span><span class="si">{0:1.2%}</span><span class="s2"> of the whole area&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">area2</span> <span class="o">/</span> <span class="p">(</span><span class="n">area1</span> <span class="o">+</span> <span class="n">area2</span><span class="p">)))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">intensity</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">peak1</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">peak2</span><span class="p">,</span> <span class="s2">&quot;g-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Intensity (arb. units)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;peak 1&quot;</span><span class="p">,</span> <span class="s2">&quot;peak 2&quot;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">11</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">pars1</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">pars2</span> <span class="o">=</span> <span class="n">popt</span><span class="p">[</span><span class="mi">4</span><span class="p">:</span><span class="mi">8</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">peak1</span> <span class="o">=</span> <span class="n">asym_peak</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">pars1</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;popt&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>This sample was air, and the first peak is oxygen, and the second peak is nitrogen. we come pretty close to the actual composition of air, although it is low on the oxygen content. To do better, one would have to use a calibration curve.</p>
<p>In the end, the overlap of the peaks is pretty small, but it is still difficult to reliably and reproducibly deconvolute them. By using an algorithm like we have demonstrated here, it is possible at least to make the deconvolution reproducible.</p>
<section id="notable-differences-from-matlab">
<h3>Notable differences from Matlab<a class="headerlink" href="#notable-differences-from-matlab" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>The order of arguments to np.trapz is reversed.</p></li>
<li><p>The order of arguments to the fitting function scipy.optimize.curve_fit is different than in Matlab.</p></li>
<li><p>The scipy.optimize.curve_fit function expects a fitting function that has all parameters as arguments, where Matlab expects a vector of parameters.</p></li>
</ol>
</section>
</section>
<section id="estimating-the-boiling-point-of-water">
<h2>Estimating the boiling point of water<a class="headerlink" href="#estimating-the-boiling-point-of-water" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2012/01/01/estimating-the-boiling-point-of-water/">Matlab post</a></p>
<p>I got distracted looking for Shomate parameters for ethane today, and came across this <a class="reference external" href="http://senese.wordpress.com/2010/01/26/notebook-3-2-predicting-boiling-points-from-liquidvapor-gibbs-free-energy-functions/">website</a> on predicting the boiling point of water using the Shomate equations. The basic idea is to find the temperature where the Gibbs energy of water as a vapor is equal to the Gibbs energy of the liquid.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>Liquid water (<a class="reference external" href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&amp;amp;Units=SI&amp;amp;Mask=2#Thermo-Condensed">http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&amp;Units=SI&amp;Mask=2#Thermo-Condensed</a>)</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># valid over 298-500</span>

<span class="n">Hf_liq</span> <span class="o">=</span> <span class="o">-</span><span class="mf">285.830</span>  <span class="c1"># kJ/mol</span>
<span class="n">S_liq</span> <span class="o">=</span> <span class="mf">0.06995</span>  <span class="c1"># kJ/mol/K</span>
<span class="n">shomateL</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">203.6060</span><span class="p">,</span> <span class="mf">1523.290</span><span class="p">,</span> <span class="o">-</span><span class="mf">3196.413</span><span class="p">,</span> <span class="mf">2474.455</span><span class="p">,</span> <span class="mf">3.855326</span><span class="p">,</span> <span class="o">-</span><span class="mf">256.5478</span><span class="p">,</span> <span class="o">-</span><span class="mf">488.7163</span><span class="p">,</span> <span class="o">-</span><span class="mf">285.8304</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Gas phase water (<a class="reference external" href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&amp;amp;Units=SI&amp;amp;Mask=1&amp;amp;Type=JANAFG&amp;amp;Table=on#JANAFG">http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&amp;Units=SI&amp;Mask=1&amp;Type=JANAFG&amp;Table=on#JANAFG</a>)</p>
<p>Interestingly, these parameters are listed as valid only above 500K. That means we have to extrapolate the values down to 298K. That is risky for polynomial models, as they can deviate substantially outside the region they were fitted to.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Hf_gas</span> <span class="o">=</span> <span class="o">-</span><span class="mf">241.826</span>  <span class="c1"># kJ/mol</span>
<span class="n">S_gas</span> <span class="o">=</span> <span class="mf">0.188835</span>  <span class="c1"># kJ/mol/K</span>

<span class="n">shomateG</span> <span class="o">=</span> <span class="p">[</span><span class="mf">30.09200</span><span class="p">,</span> <span class="mf">6.832514</span><span class="p">,</span> <span class="mf">6.793435</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.534480</span><span class="p">,</span> <span class="mf">0.082139</span><span class="p">,</span> <span class="o">-</span><span class="mf">250.8810</span><span class="p">,</span> <span class="mf">223.3967</span><span class="p">,</span> <span class="o">-</span><span class="mf">241.8264</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we wan to compute G for each phase as a function of T</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span> <span class="o">+</span> <span class="mf">273.15</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="mf">1000.0</span>

<span class="n">sTT</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="o">**</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">0</span><span class="p">]</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="o">/</span> <span class="mf">1000.0</span>
<span class="p">)</span>

<span class="n">hTT</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
    <span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="p">(</span><span class="n">t</span><span class="o">**</span><span class="mi">4</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">t</span><span class="p">,</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">0</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">T</span>

<span class="n">Gliq</span> <span class="o">=</span> <span class="n">Hf_liq</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">hTT</span><span class="p">,</span> <span class="n">shomateL</span><span class="p">)</span> <span class="o">-</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sTT</span><span class="p">,</span> <span class="n">shomateL</span><span class="p">))</span>
<span class="n">Ggas</span> <span class="o">=</span> <span class="n">Hf_gas</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">hTT</span><span class="p">,</span> <span class="n">shomateG</span><span class="p">)</span> <span class="o">-</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">sTT</span><span class="p">,</span> <span class="n">shomateG</span><span class="p">))</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>

<span class="n">f</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Gliq</span> <span class="o">-</span> <span class="n">Ggas</span><span class="p">)</span>
<span class="p">(</span><span class="n">bp</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">373</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The boiling point is </span><span class="si">{0}</span><span class="s2"> K&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bp</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The boiling point is 373.20608131187146 K
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">,</span> <span class="n">Gliq</span><span class="p">,</span> <span class="n">T</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">,</span> <span class="n">Ggas</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;liquid water&quot;</span><span class="p">,</span> <span class="s2">&quot;steam&quot;</span><span class="p">])</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature $^\circ$C&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta G$ (kJ/mol)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;The boiling point is approximately </span><span class="si">{0:1.2f}</span><span class="s2"> $^\circ$C&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bp</span> <span class="o">-</span> <span class="mf">273.15</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/ceca2fd1ac63690d1bd5132b51def5ba792ca4cef5be2a3ed82a4a5da72e1892.png" src="../_images/ceca2fd1ac63690d1bd5132b51def5ba792ca4cef5be2a3ed82a4a5da72e1892.png" />
</div>
</div>
<section id="summary">
<h3>Summary<a class="headerlink" href="#summary" title="Link to this heading">#</a></h3>
<p>The answer we get us 0.05 K too high, which is not bad considering we estimated it using parameters that were fitted to thermodynamic data and that had finite precision and extrapolated the steam properties below the region the parameters were stated to be valid for.</p>
</section>
</section>
<section id="gibbs-energy-minimization-and-the-nist-webbook">
<h2>Gibbs energy minimization and the NIST webbook<a class="headerlink" href="#gibbs-energy-minimization-and-the-nist-webbook" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/12/25/gibbs-energy-minimization-and-the-nist-webbook/">Matlab post</a>
In Post 1536 we used the NIST webbook to compute a temperature dependent Gibbs energy of reaction, and then used a reaction extent variable to compute the equilibrium concentrations of each species for the water gas shift reaction.</p>
<p>Today, we look at the direct minimization of the Gibbs free energy of the species, with no assumptions about stoichiometry of reactions. We only apply the constraint of conservation of atoms. We use the NIST Webbook to provide the data for the Gibbs energy of each species.</p>
<p>As a reminder we consider equilibrium between the species <span class="math notranslate nohighlight">\(CO\)</span>, <span class="math notranslate nohighlight">\(H_2O\)</span>, <span class="math notranslate nohighlight">\(CO_2\)</span> and <span class="math notranslate nohighlight">\(H_2\)</span>, at 1000K, and 10 atm total pressure with an initial equimolar molar flow rate of <span class="math notranslate nohighlight">\(CO\)</span> and <span class="math notranslate nohighlight">\(H_2O\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># K</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">8.314e-3</span>  <span class="c1"># kJ/mol/K</span>

<span class="n">P</span> <span class="o">=</span> <span class="mf">10.0</span>  <span class="c1"># atm, this is the total pressure in the reactor</span>
<span class="n">Po</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># atm, this is the standard state pressure</span>
</pre></div>
</div>
</div>
</div>
<p>We are going to store all the data and calculations in vectors, so we need to assign each position in the vector to a species. Here are the definitions we use in this work.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>1  CO
2  H2O
3  CO2
4  H2
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CO&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2&quot;</span><span class="p">,</span> <span class="s2">&quot;H2&quot;</span><span class="p">]</span>

<span class="c1"># Heats of formation at 298.15 K</span>

<span class="n">Hf298</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">-</span><span class="mf">110.53</span><span class="p">,</span>  <span class="c1"># CO</span>
    <span class="o">-</span><span class="mf">241.826</span><span class="p">,</span>  <span class="c1"># H2O</span>
    <span class="o">-</span><span class="mf">393.51</span><span class="p">,</span>  <span class="c1"># CO2</span>
    <span class="mf">0.0</span><span class="p">,</span>
<span class="p">]</span>  <span class="c1"># H2</span>

<span class="c1"># Shomate parameters for each species</span>
<span class="c1">#           A          B           C          D          E            F          G       H</span>
<span class="n">WB</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">25.56759</span><span class="p">,</span> <span class="mf">6.096130</span><span class="p">,</span> <span class="mf">4.054656</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.671301</span><span class="p">,</span> <span class="mf">0.131021</span><span class="p">,</span> <span class="o">-</span><span class="mf">118.0089</span><span class="p">,</span> <span class="mf">227.3665</span><span class="p">,</span> <span class="o">-</span><span class="mf">110.5271</span><span class="p">],</span>  <span class="c1"># CO</span>
    <span class="p">[</span><span class="mf">30.09200</span><span class="p">,</span> <span class="mf">6.832514</span><span class="p">,</span> <span class="mf">6.793435</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.534480</span><span class="p">,</span> <span class="mf">0.082139</span><span class="p">,</span> <span class="o">-</span><span class="mf">250.8810</span><span class="p">,</span> <span class="mf">223.3967</span><span class="p">,</span> <span class="o">-</span><span class="mf">241.8264</span><span class="p">],</span>  <span class="c1"># H2O</span>
    <span class="p">[</span><span class="mf">24.99735</span><span class="p">,</span> <span class="mf">55.18696</span><span class="p">,</span> <span class="o">-</span><span class="mf">33.69137</span><span class="p">,</span> <span class="mf">7.948387</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.136638</span><span class="p">,</span> <span class="o">-</span><span class="mf">403.6075</span><span class="p">,</span> <span class="mf">228.2431</span><span class="p">,</span> <span class="o">-</span><span class="mf">393.5224</span><span class="p">],</span>  <span class="c1"># CO2</span>
    <span class="p">[</span><span class="mf">33.066178</span><span class="p">,</span> <span class="o">-</span><span class="mf">11.363417</span><span class="p">,</span> <span class="mf">11.432816</span><span class="p">,</span> <span class="o">-</span><span class="mf">2.772874</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.158558</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.980797</span><span class="p">,</span> <span class="mf">172.707974</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">],</span>
<span class="p">]</span>  <span class="c1"># H2</span>

<span class="n">WB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">WB</span><span class="p">)</span>

<span class="c1"># Shomate equations</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">T_H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="n">t</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">t</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
<span class="n">T_S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

<span class="n">H</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">WB</span><span class="p">,</span> <span class="n">T_H</span><span class="p">)</span>  <span class="c1"># (H - H_298.15) kJ/mol</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">WB</span><span class="p">,</span> <span class="n">T_S</span> <span class="o">/</span> <span class="mf">1000.0</span><span class="p">)</span>  <span class="c1"># absolute entropy kJ/mol/K</span>

<span class="n">Gjo</span> <span class="o">=</span> <span class="n">Hf298</span> <span class="o">+</span> <span class="n">H</span> <span class="o">-</span> <span class="n">T</span> <span class="o">*</span> <span class="n">S</span>  <span class="c1"># Gibbs energy of each component at 1000 K</span>
</pre></div>
</div>
</div>
</div>
<p>Now, construct the Gibbs free energy function, accounting for the change in activity due to concentration changes (ideal mixing).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">nj</span><span class="p">):</span>
    <span class="n">nj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nj</span><span class="p">)</span>
    <span class="n">Enj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nj</span><span class="p">)</span>
    <span class="n">Gj</span> <span class="o">=</span> <span class="n">Gjo</span> <span class="o">/</span> <span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">T</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nj</span> <span class="o">/</span> <span class="n">Enj</span> <span class="o">*</span> <span class="n">P</span> <span class="o">/</span> <span class="n">Po</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nj</span><span class="p">,</span> <span class="n">Gj</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We impose the constraint that all atoms are conserved from the initial conditions to the equilibrium distribution of species. These constraints are in the form of <span class="math notranslate nohighlight">\(A_{eq} n = b_{eq}\)</span>, where <span class="math notranslate nohighlight">\(n\)</span> is the vector of mole numbers for each species.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Aeq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># C balance</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># O balance</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>  <span class="c1"># H balance</span>

<span class="c1"># equimolar feed of 1 mol H2O and 1 mol CO</span>
<span class="n">beq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="mi">1</span><span class="p">,</span>  <span class="c1"># mol C fed</span>
        <span class="mi">2</span><span class="p">,</span>  <span class="c1"># mol O fed</span>
        <span class="mi">2</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>  <span class="c1"># mol H fed</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ec1</span><span class="p">(</span><span class="n">nj</span><span class="p">):</span>
    <span class="s2">&quot;conservation of atoms constraint&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Aeq</span><span class="p">,</span> <span class="n">nj</span><span class="p">)</span> <span class="o">-</span> <span class="n">beq</span>
</pre></div>
</div>
</div>
</div>
<p>Now we are ready to solve the problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fmin_slsqp</span>

<span class="n">n0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>  <span class="c1"># initial guesses</span>
<span class="n">N</span> <span class="o">=</span> <span class="n">fmin_slsqp</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">f_eqcons</span><span class="o">=</span><span class="n">ec1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully    (Exit mode 0)
            Current function value: -91.2048323079689
            Iterations: 2
            Function evaluations: 11
            Gradient evaluations: 2
[0.45502309 0.45502309 0.54497691 0.54497691]
</pre></div>
</div>
</div>
</div>
<section id="compute-mole-fractions-and-partial-pressures">
<h3>Compute mole fractions and partial pressures<a class="headerlink" href="#compute-mole-fractions-and-partial-pressures" title="Link to this heading">#</a></h3>
<p>The pressures here are in good agreement with the pressures found by other methods. The minor disagreement (in the third or fourth decimal place) is likely due to convergence tolerances in the different algorithms used.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yj</span> <span class="o">=</span> <span class="n">N</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">Pj</span> <span class="o">=</span> <span class="n">yj</span> <span class="o">*</span> <span class="n">P</span>

<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">yj</span><span class="p">,</span> <span class="n">Pj</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:10s}</span><span class="s2">: </span><span class="si">{1:1.2f}</span><span class="s2"> </span><span class="si">{2:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">p</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>CO        : 0.23 2.28
H2O       : 0.23 2.28
CO2       : 0.27 2.72
H2        : 0.27 2.72
</pre></div>
</div>
</div>
</div>
</section>
<section id="computing-equilibrium-constants">
<h3>Computing equilibrium constants<a class="headerlink" href="#computing-equilibrium-constants" title="Link to this heading">#</a></h3>
<p>We can compute the equilibrium constant for the reaction <span class="math notranslate nohighlight">\(CO + H_2O \rightleftharpoons CO_2 + H_2\)</span>. Compared to the value of K = 1.44 we found at the end of Post 1536 , the agreement is excellent. Note, that to define an equilibrium constant it is necessary to specify a reaction, even though it is not necessary to even consider a reaction to obtain the equilibrium distribution of species!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nuj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>  <span class="c1"># stoichiometric coefficients of the reaction</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">yj</span><span class="o">**</span><span class="n">nuj</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.4344629441458467
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="finding-equilibrium-composition-by-direct-minimization-of-gibbs-free-energy-on-mole-numbers">
<h2>Finding equilibrium composition by direct minimization of Gibbs free energy on mole numbers<a class="headerlink" href="#finding-equilibrium-composition-by-direct-minimization-of-gibbs-free-energy-on-mole-numbers" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/12/25/finding-equilibrium-composition-by-direct-minimization-of-gibbs-free-energy-on-mole-numbers/">Matlab post</a>
Adapted from problem 4.5 in Cutlip and Shacham
Ethane and steam are fed to a steam cracker at a total pressure of 1 atm and at 1000K at a ratio of 4 mol H2O to 1 mol ethane. Estimate the equilibrium distribution of products (CH4, C2H4, C2H2, CO2, CO, O2, H2, H2O, and C2H6).</p>
<p>Solution method: We will construct a Gibbs energy function for the mixture, and obtain the equilibrium composition by minimization of the function subject to elemental mass balance constraints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">R</span> <span class="o">=</span> <span class="mf">0.00198588</span>  <span class="c1"># kcal/mol/K</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c1"># K</span>

<span class="n">species</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CH4&quot;</span><span class="p">,</span> <span class="s2">&quot;C2H4&quot;</span><span class="p">,</span> <span class="s2">&quot;C2H2&quot;</span><span class="p">,</span> <span class="s2">&quot;CO2&quot;</span><span class="p">,</span> <span class="s2">&quot;CO&quot;</span><span class="p">,</span> <span class="s2">&quot;O2&quot;</span><span class="p">,</span> <span class="s2">&quot;H2&quot;</span><span class="p">,</span> <span class="s2">&quot;H2O&quot;</span><span class="p">,</span> <span class="s2">&quot;C2H6&quot;</span><span class="p">]</span>

<span class="c1"># $G_^\circ for each species. These are the heats of formation for each</span>
<span class="c1"># species.</span>
<span class="n">Gjo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">4.61</span><span class="p">,</span> <span class="mf">28.249</span><span class="p">,</span> <span class="mf">40.604</span><span class="p">,</span> <span class="o">-</span><span class="mf">94.61</span><span class="p">,</span> <span class="o">-</span><span class="mf">47.942</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">46.03</span><span class="p">,</span> <span class="mf">26.13</span><span class="p">])</span>  <span class="c1"># kcal/mol</span>
</pre></div>
</div>
</div>
</div>
<section id="the-gibbs-energy-of-a-mixture">
<h3>The Gibbs energy of a mixture<a class="headerlink" href="#the-gibbs-energy-of-a-mixture" title="Link to this heading">#</a></h3>
<p>We start with <span class="math notranslate nohighlight">\(G=\sum\limits_j n_j \mu_j\)</span>. Recalling that we define <span class="math notranslate nohighlight">\(\mu_j = G_j^\circ + RT \ln a_j\)</span>, and in the ideal gas limit, <span class="math notranslate nohighlight">\(a_j = y_j P/P^\circ\)</span>, and that <span class="math notranslate nohighlight">\(y_j = \frac{n_j}{\sum n_j}\)</span>. Since in this problem, P = 1 atm, this leads to the function <span class="math notranslate nohighlight">\(\frac{G}{RT} = \sum\limits_{j=1}^n n_j\left(\frac{G_j^\circ}{RT} + \ln \frac{n_j}{\sum n_j}\right)\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">nj</span><span class="p">):</span>
    <span class="n">nj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">nj</span><span class="p">)</span>
    <span class="n">Enj</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nj</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nj</span> <span class="o">*</span> <span class="p">(</span><span class="n">Gjo</span> <span class="o">/</span> <span class="n">R</span> <span class="o">/</span> <span class="n">T</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">nj</span> <span class="o">/</span> <span class="n">Enj</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">G</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="linear-equality-constraints-for-atomic-mass-conservation">
<h3>Linear equality constraints for atomic mass conservation<a class="headerlink" href="#linear-equality-constraints-for-atomic-mass-conservation" title="Link to this heading">#</a></h3>
<p>The total number of each type of atom must be the same as what entered the reactor. These form equality constraints on the equilibrium composition. We express these constraints as: <span class="math notranslate nohighlight">\(A_{eq} n = b\)</span> where <span class="math notranslate nohighlight">\(n\)</span> is a vector of the moles of each species present in the mixture. CH4 C2H4 C2H2 CO2 CO O2 H2 H2O C2H6</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Aeq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># oxygen balance</span>
        <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">],</span>  <span class="c1"># hydrogen balance</span>
        <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span>
    <span class="p">]</span>
<span class="p">)</span>  <span class="c1"># carbon balance</span>

<span class="c1"># the incoming feed was 4 mol H2O and 1 mol ethane</span>
<span class="n">beq</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="mi">4</span><span class="p">,</span>  <span class="c1"># moles of oxygen atoms coming in</span>
        <span class="mi">14</span><span class="p">,</span>  <span class="c1"># moles of hydrogen atoms coming in</span>
        <span class="mi">2</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>  <span class="c1"># moles of carbon atoms coming in</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ec1</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s2">&quot;equality constraint&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Aeq</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">beq</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ic1</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;inequality constraint</span>
<span class="sd">    all n&gt;=0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">n</span>
</pre></div>
</div>
</div>
</div>
<p>Now we solve the problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initial guess suggested in the example</span>
<span class="n">n0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">0.993</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">5.992</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">]</span>

<span class="c1"># n0 = [0.066, 8.7e-08, 2.1e-14, 0.545, 1.39, 5.7e-14, 5.346, 1.521, 1.58e-7]</span>

<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fmin_slsqp</span>

<span class="nb">print</span><span class="p">(</span><span class="n">func</span><span class="p">(</span><span class="n">n0</span><span class="p">))</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">fmin_slsqp</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">f_eqcons</span><span class="o">=</span><span class="n">ec1</span><span class="p">,</span> <span class="n">f_ieqcons</span><span class="o">=</span><span class="n">ic1</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="mi">900</span><span class="p">,</span> <span class="n">acc</span><span class="o">=</span><span class="mf">1e-12</span><span class="p">)</span>

<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:10s}</span><span class="s2"> </span><span class="si">{1:1.4g}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">x</span><span class="p">))</span>

<span class="c1"># check that constraints were met</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Aeq</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="n">beq</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Aeq</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span> <span class="o">-</span> <span class="n">beq</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-12</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-103.62526515484863
Optimization terminated successfully    (Exit mode 0)
            Current function value: -104.40395152359777
            Iterations: 16
            Function evaluations: 195
            Gradient evaluations: 16
CH4        0.06644
C2H4       8.695e-08
C2H2       2.104e-13
CO2        0.545
CO         1.389
O2         5.7e-13
H2         5.346
H2O        1.521
C2H6       1.616e-07
[ 0.00000000e+00 -1.77635684e-15  0.00000000e+00]
True
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2451/2206472356.py:7: RuntimeWarning: invalid value encountered in log
  G = np.sum(nj * (Gjo / R / T + np.log(nj / Enj)))
</pre></div>
</div>
</div>
</div>
<p>I found it necessary to tighten the accuracy parameter to get pretty good matches to the solutions found in Matlab. It was also necessary to increase the number of iterations. Even still, not all of the numbers match well, especially the very small numbers. You can, however, see that the constraints were satisfied pretty well.</p>
<p>Interestingly there is a distribution of products! That is interesting because only steam and ethane enter the reactor, but a small fraction of methane is formed! The main product is hydrogen. The stoichiometry of steam reforming is ideally <span class="math notranslate nohighlight">\(C_2H_6 + 4H_2O \rightarrow 2CO_2 + 7 H2\)</span>. Even though nearly all the ethane is consumed, we do not get the full yield of hydrogen. It appears that another equilibrium, one between CO, CO2, H2O and H2, may be limiting that, since the rest of the hydrogen is largely in the water. It is also of great importance that we have not said anything about reactions, i.e. how these products were formed.</p>
<p>The water gas shift reaction is: <span class="math notranslate nohighlight">\(CO + H_2O \rightleftharpoons CO_2 + H_2\)</span>. We can compute the Gibbs free energy of the reaction from the heats of formation of each species. Assuming these are the formation energies at 1000K, this is the reaction free energy at 1000K.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">G_wgs</span> <span class="o">=</span> <span class="n">Gjo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="n">Gjo</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">-</span> <span class="n">Gjo</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">Gjo</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">G_wgs</span><span class="p">)</span>

<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">G_wgs</span> <span class="o">/</span> <span class="p">(</span><span class="n">R</span> <span class="o">*</span> <span class="n">T</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">K</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-0.6379999999999981
1.3788752810890879
</pre></div>
</div>
</div>
</div>
</section>
<section id="equilibrium-constant-based-on-mole-numbers">
<h3>Equilibrium constant based on mole numbers<a class="headerlink" href="#equilibrium-constant-based-on-mole-numbers" title="Link to this heading">#</a></h3>
<p>One normally uses activities to define the equilibrium constant. Since there are the same number of moles on each side of the reaction all factors that convert mole numbers to activity, concentration or pressure cancel, so we simply consider the ratio of mole numbers here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">((</span><span class="n">X</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="mi">6</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">X</span><span class="p">[</span><span class="mi">7</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.3788660188140438
</pre></div>
</div>
</div>
</div>
<p>This is very close to the equilibrium constant computed above.</p>
<p>Clearly, there is an equilibrium between these species that prevents the complete reaction of steam reforming.</p>
</section>
<section id="id1">
<h3>Summary<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>This is an appealing way to minimize the Gibbs energy of a mixture. No assumptions about reactions are necessary, and the constraints are easy to identify. The Gibbs energy function is especially easy to code.</p>
</section>
</section>
<section id="the-gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition">
<h2>The Gibbs free energy of a reacting mixture and the equilibrium composition<a class="headerlink" href="#the-gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/12/20/the-gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition/">Matlab post</a></p>
<p>In this post we derive the equations needed to find the equilibrium composition of a reacting mixture. We use the method of direct minimization of the Gibbs free energy of the reacting mixture.</p>
<p>The Gibbs free energy of a mixture is defined as <span class="math notranslate nohighlight">\(G = \sum\limits_j \mu_j n_j\)</span> where <span class="math notranslate nohighlight">\(\mu_j\)</span> is the chemical potential of species <span class="math notranslate nohighlight">\(j\)</span>, and it is temperature and pressure dependent, and <span class="math notranslate nohighlight">\(n_j\)</span> is the number of moles of species <span class="math notranslate nohighlight">\(j\)</span>.</p>
<p>We define the chemical potential as <span class="math notranslate nohighlight">\(\mu_j = G_j^\circ + RT\ln a_j\)</span>, where <span class="math notranslate nohighlight">\(G_j^\circ\)</span> is the Gibbs energy in a standard state, and <span class="math notranslate nohighlight">\(a_j\)</span> is the activity of species <span class="math notranslate nohighlight">\(j\)</span> if the pressure and temperature are not at standard state conditions.</p>
<p>If a reaction is occurring, then the number of moles of each species are related to each other through the reaction extent <span class="math notranslate nohighlight">\(\epsilon\)</span> and stoichiometric coefficients: <span class="math notranslate nohighlight">\(n_j = n_{j0} + \nu_j \epsilon\)</span>. Note that the reaction extent has units of moles.</p>
<p>Combining these three equations and expanding the terms leads to:</p>
<div class="math notranslate nohighlight">
\[G = \sum\limits_j n_{j0}G_j^\circ +\sum\limits_j \nu_j G_j^\circ \epsilon +RT\sum\limits_j(n_{j0} + \nu_j\epsilon)\ln a_j \]</div>
<p>The first term is simply the initial Gibbs free energy that is present before any reaction begins, and it is a constant. It is difficult to evaluate, so we will move it to the left side of the equation in the next step, because it does not matter what its value is since it is a constant. The second term is related to the Gibbs free energy of reaction: <span class="math notranslate nohighlight">\(\Delta_rG = \sum\limits_j \nu_j G_j^\circ\)</span>. With these observations we rewrite the equation as:</p>
<div class="math notranslate nohighlight">
\[G - \sum\limits_j n_{j0}G_j^\circ = \Delta_rG \epsilon +RT\sum\limits_j(n_{j0} + \nu_j\epsilon)\ln a_j \]</div>
<p>Now, we have an equation that allows us to compute the change in Gibbs free energy as a function of the reaction extent, initial number of moles of each species, and the activities of each species. This difference in Gibbs free energy has no natural scale, and depends on the size of the system, i.e. on <span class="math notranslate nohighlight">\(n_{j0}\)</span>. It is desirable to avoid this, so we now rescale the equation by the total initial moles present, <span class="math notranslate nohighlight">\(n_{T0}\)</span> and define a new variable <span class="math notranslate nohighlight">\(\epsilon' = \epsilon/n_{T0}\)</span>, which is dimensionless. This leads to:</p>
<div class="math notranslate nohighlight">
\[ \frac{G - \sum\limits_j n_{j0}G_j^\circ}{n_{T0}} = \Delta_rG \epsilon' + RT \sum\limits_j(y_{j0} + \nu_j\epsilon')\ln a_j \]</div>
<p>where <span class="math notranslate nohighlight">\(y_{j0}\)</span> is the initial mole fraction of species <span class="math notranslate nohighlight">\(j\)</span> present. The mole fractions are intensive properties that do not depend on the system size. Finally, we need to address <span class="math notranslate nohighlight">\(a_j\)</span>. For an ideal gas, we know that <span class="math notranslate nohighlight">\(A_j = \frac{y_j P}{P^\circ}\)</span>, where the numerator is the partial pressure of species <span class="math notranslate nohighlight">\(j\)</span> computed from the mole fraction of species <span class="math notranslate nohighlight">\(j\)</span> times the total pressure. To get the mole fraction we note:</p>
<div class="math notranslate nohighlight">
\[y_j = \frac{n_j}{n_T} = \frac{n_{j0} + \nu_j \epsilon}{n_{T0} + \epsilon \sum\limits_j \nu_j} = \frac{y_{j0} + \nu_j \epsilon'}{1 + \epsilon'\sum\limits_j \nu_j} \]</div>
<p>This finally leads us to an equation that we can evaluate as a function of reaction extent:</p>
<div class="math notranslate nohighlight">
\[ \frac{G - \sum\limits_j n_{j0}G_j^\circ}{n_{T0}} = \widetilde{\widetilde{G}} = \Delta_rG \epsilon' + RT\sum\limits_j(y_{j0} + \nu_j\epsilon') \ln\left(\frac{y_{j0}+\nu_j\epsilon'}{1+\epsilon'\sum\limits_j\nu_j} \frac{P}{P^\circ}\right) \]</div>
<p>we use a double tilde notation to distinguish this quantity from the quantity derived by Rawlings and Ekerdt which is further normalized by a factor of <span class="math notranslate nohighlight">\(RT\)</span>. This additional scaling makes the quantities dimensionless, and makes the quantity have a magnitude of order unity, but otherwise has no effect on the shape of the graph.</p>
<p>Finally, if we know the initial mole fractions, the initial total pressure, the Gibbs energy of reaction, and the stoichiometric coefficients, we can plot the scaled reacting mixture energy as a function of reaction extent. At equilibrium, this energy will be a minimum. We consider the example in Rawlings and Ekerdt where isobutane (I) reacts with 1-butene (B) to form 2,2,3-trimethylpentane (P). The reaction occurs at a total pressure of 2.5 atm at 400K, with equal molar amounts of I and B. The standard Gibbs free energy of reaction at 400K is -3.72 kcal/mol. Compute the equilibrium composition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">R</span> <span class="o">=</span> <span class="mf">8.314</span>
<span class="n">P</span> <span class="o">=</span> <span class="mi">250000</span>  <span class="c1"># Pa</span>
<span class="n">P0</span> <span class="o">=</span> <span class="mi">100000</span>  <span class="c1"># Pa, approximately 1 atm</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">400</span>  <span class="c1"># K</span>

<span class="n">Grxn</span> <span class="o">=</span> <span class="o">-</span><span class="mf">15564.0</span>  <span class="c1"># J/mol</span>
<span class="n">yi0</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">yb0</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">yp0</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># initial mole fractions</span>

<span class="n">yj0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">yi0</span><span class="p">,</span> <span class="n">yb0</span><span class="p">,</span> <span class="n">yp0</span><span class="p">])</span>
<span class="n">nu_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>  <span class="c1"># stoichiometric coefficients</span>


<span class="k">def</span><span class="w"> </span><span class="nf">Gwigglewiggle</span><span class="p">(</span><span class="n">extentp</span><span class="p">):</span>
    <span class="n">diffg</span> <span class="o">=</span> <span class="n">Grxn</span> <span class="o">*</span> <span class="n">extentp</span>
    <span class="n">sum_nu_j</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nu_j</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">yj0</span><span class="p">):</span>
        <span class="n">x1</span> <span class="o">=</span> <span class="n">yj0</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">nu_j</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">extentp</span>
        <span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">extentp</span> <span class="o">*</span> <span class="n">sum_nu_j</span><span class="p">)</span>
        <span class="n">diffg</span> <span class="o">+=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">T</span> <span class="o">*</span> <span class="n">x1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x2</span> <span class="o">*</span> <span class="n">P</span> <span class="o">/</span> <span class="n">P0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">diffg</span>
</pre></div>
</div>
</div>
</div>
<p>There are bounds on how large <span class="math notranslate nohighlight">\(\epsilon'\)</span> can be. Recall that <span class="math notranslate nohighlight">\(n_j = n_{j0} + \nu_j \epsilon\)</span>, and that <span class="math notranslate nohighlight">\(n_j \ge 0\)</span>. Thus, <span class="math notranslate nohighlight">\(\epsilon_{max} = -n_{j0}/\nu_j\)</span>, and the maximum value that <span class="math notranslate nohighlight">\(\epsilon'\)</span> can have is therefore <span class="math notranslate nohighlight">\(-y_{j0}/\nu_j\)</span> where <span class="math notranslate nohighlight">\(y_{j0}&gt;0\)</span>. When there are multiple species, you need the smallest <span class="math notranslate nohighlight">\(epsilon'_{max}\)</span> to avoid getting negative mole numbers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">epsilonp_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="o">-</span><span class="n">yj0</span><span class="p">[</span><span class="n">yj0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">nu_j</span><span class="p">[</span><span class="n">yj0</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">epsilonp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">1e-6</span><span class="p">,</span> <span class="n">epsilonp_max</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epsilonp</span><span class="p">,</span> <span class="n">Gwigglewiggle</span><span class="p">(</span><span class="n">epsilonp</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$\epsilon$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Gwigglewiggle&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2451/860182294.py:23: RuntimeWarning: divide by zero encountered in log
  diffg += R * T * x1 * np.log(x2 * P / P0)
/tmp/ipykernel_2451/860182294.py:23: RuntimeWarning: invalid value encountered in multiply
  diffg += R * T * x1 * np.log(x2 * P / P0)
</pre></div>
</div>
<img alt="../_images/bffcf5d49109eaf8d5cafe35c102243ccfa17fe434f7f70f9618ba981190d559.png" src="../_images/bffcf5d49109eaf8d5cafe35c102243ccfa17fe434f7f70f9618ba981190d559.png" />
</div>
</div>
<p>Now we simply minimize our Gwigglewiggle function. Based on the figure above, the miminum is near 0.45.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fminbound</span>

<span class="n">epsilonp_eq</span> <span class="o">=</span> <span class="n">fminbound</span><span class="p">(</span><span class="n">Gwigglewiggle</span><span class="p">,</span> <span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">epsilonp_eq</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">epsilonp</span><span class="p">,</span> <span class="n">Gwigglewiggle</span><span class="p">(</span><span class="n">epsilonp</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$\epsilon$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Gwigglewiggle&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">epsilonp_eq</span><span class="p">],</span> <span class="p">[</span><span class="n">Gwigglewiggle</span><span class="p">(</span><span class="n">epsilonp_eq</span><span class="p">)],</span> <span class="s2">&quot;ro&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.46959618248998036
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2451/860182294.py:23: RuntimeWarning: divide by zero encountered in log
  diffg += R * T * x1 * np.log(x2 * P / P0)
/tmp/ipykernel_2451/860182294.py:23: RuntimeWarning: invalid value encountered in multiply
  diffg += R * T * x1 * np.log(x2 * P / P0)
</pre></div>
</div>
<img alt="../_images/5babbfd9ede0993e6da35b01b439d4cb9b84f114f39118339dbd74d91d04a65f.png" src="../_images/5babbfd9ede0993e6da35b01b439d4cb9b84f114f39118339dbd74d91d04a65f.png" />
</div>
</div>
<p>To compute equilibrium mole fractions we do this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yi</span> <span class="o">=</span> <span class="p">(</span><span class="n">yi0</span> <span class="o">+</span> <span class="n">nu_j</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">epsilonp_eq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">epsilonp_eq</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nu_j</span><span class="p">))</span>
<span class="n">yb</span> <span class="o">=</span> <span class="p">(</span><span class="n">yb0</span> <span class="o">+</span> <span class="n">nu_j</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">epsilonp_eq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">epsilonp_eq</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nu_j</span><span class="p">))</span>
<span class="n">yp</span> <span class="o">=</span> <span class="p">(</span><span class="n">yp0</span> <span class="o">+</span> <span class="n">nu_j</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">epsilonp_eq</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">epsilonp_eq</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nu_j</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="n">yi</span><span class="p">,</span> <span class="n">yb</span><span class="p">,</span> <span class="n">yp</span><span class="p">)</span>

<span class="c1"># or this</span>
<span class="n">y_j</span> <span class="o">=</span> <span class="p">(</span><span class="n">yj0</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nu_j</span><span class="p">,</span> <span class="n">epsilonp_eq</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="n">epsilonp_eq</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nu_j</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_j</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.05732201863242677 0.05732201863242677 0.8853559627351465
[0.05732202 0.05732202 0.88535596]
</pre></div>
</div>
</div>
</div>
<p><span class="math notranslate nohighlight">\(K = \frac{a_P}{a_I a_B} = \frac{y_p P/P^\circ}{y_i P/P^\circ y_b P/P^\circ} = \frac{y_P}{y_i y_b}\frac{P^\circ}{P}\)</span>.</p>
<p>We can express the equilibrium constant like this :<span class="math notranslate nohighlight">\(K = \prod\limits_j a_j^{\nu_j}\)</span>, and compute it with a single line of code.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Grxn</span> <span class="o">/</span> <span class="n">R</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;K from delta G &quot;</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;K as ratio of mole fractions &quot;</span><span class="p">,</span> <span class="n">yp</span> <span class="o">/</span> <span class="p">(</span><span class="n">yi</span> <span class="o">*</span> <span class="n">yb</span><span class="p">)</span> <span class="o">*</span> <span class="n">P0</span> <span class="o">/</span> <span class="n">P</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;compact notation: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">((</span><span class="n">y_j</span> <span class="o">*</span> <span class="n">P</span> <span class="o">/</span> <span class="n">P0</span><span class="p">)</span> <span class="o">**</span> <span class="n">nu_j</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>K from delta G  107.77629474221368
K as ratio of mole fractions  107.77920006547463
compact notation:  107.77920006547463
</pre></div>
</div>
</div>
</div>
<p>These results are very close, and only disagree because of the default tolerance used in identifying the minimum of our function. You could tighten the tolerances by setting options to the fminbnd function.</p>
<section id="id2">
<h3>Summary<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>In this post we derived an equation for the Gibbs free energy of a reacting mixture and used it to find the equilibrium composition. In future posts we will examine some alternate forms of the equations that may be more useful in some circumstances.</p>
</section>
</section>
<section id="water-gas-shift-equilibria-via-the-nist-webbook">
<h2>Water gas shift equilibria via the NIST Webbook<a class="headerlink" href="#water-gas-shift-equilibria-via-the-nist-webbook" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/12/12/water-gas-shift-equilibria-via-the-nist-webbook/">Matlab post</a></p>
<p>The <a class="reference external" href="http://webbook.nist.gov/chemistry/">NIST webbook</a> provides parameterized models of the enthalpy, entropy and heat capacity of many molecules. In this example, we will examine how to use these to compute the equilibrium constant for the water gas shift reaction <span class="math notranslate nohighlight">\(CO + H_2O \rightleftharpoons CO_2 + H_2\)</span> in the temperature range of 500K to 1000K.</p>
<p>Parameters are provided for:</p>
<p>Cp = heat capacity (J/mol*K)
H = standard enthalpy (kJ/mol)
S = standard entropy (J/mol*K)</p>
<p>with models in the form: <span class="math notranslate nohighlight">\(Cp^\circ = A + B*t + C*t^2 + D*t^3 + E/t^2\)</span></p>
<p><span class="math notranslate nohighlight">\(H^\circ - H^\circ_{298.15}= A*t + B*t^2/2 + C*t^3/3 + D*t^4/4 - E/t + F - H\)</span></p>
<p><span class="math notranslate nohighlight">\(S^\circ = A*ln(t) + B*t + C*t^2/2 + D*t^3/3 - E/(2*t^2) + G\)</span></p>
<p>where <span class="math notranslate nohighlight">\(t=T/1000\)</span>, and <span class="math notranslate nohighlight">\(T\)</span> is the temperature in Kelvin. We can use this data to calculate equilibrium constants in the following manner. First, we have heats of formation at standard state for each compound; for elements, these are zero by definition, and for non-elements, they have values available from the NIST webbook. There are also values for the absolute entropy at standard state. Then, we have an expression for the change in enthalpy from standard state as defined above, as well as the absolute entropy. From these we can derive the reaction enthalpy, free energy and entropy at standard state, as well as at other temperatures.</p>
<p>We will examine the water gas shift enthalpy, free energy and equilibrium constant from 500K to 1000K, and finally compute the equilibrium composition of a gas feed containing 5 atm of CO and H_2 at 1000K.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>  <span class="c1"># degrees K</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">T</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
<section id="hydrogen">
<h3>hydrogen<a class="headerlink" href="#hydrogen" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C1333740&amp;amp;Units=SI&amp;amp;Mask=1#Thermo-Gas">http://webbook.nist.gov/cgi/cbook.cgi?ID=C1333740&amp;Units=SI&amp;Mask=1#Thermo-Gas</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># T = 298-1000K valid temperature range</span>
<span class="n">A</span> <span class="o">=</span> <span class="mf">33.066178</span>
<span class="n">B</span> <span class="o">=</span> <span class="o">-</span><span class="mf">11.363417</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">11.432816</span>
<span class="n">D</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.772874</span>
<span class="n">E</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.158558</span>
<span class="n">F</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9.980797</span>
<span class="n">G</span> <span class="o">=</span> <span class="mf">172.707974</span>
<span class="n">H</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="n">Hf_29815_H2</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># kJ/mol</span>
<span class="n">S_29815_H2</span> <span class="o">=</span> <span class="mf">130.68</span>  <span class="c1"># J/mol/K</span>

<span class="n">dH_H2</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">E</span> <span class="o">/</span> <span class="n">t</span> <span class="o">+</span> <span class="n">F</span> <span class="o">-</span> <span class="n">H</span>
<span class="n">S_H2</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">E</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">G</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="h2o">
<h3>H<sub>2</sub>O<a class="headerlink" href="#h2o" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&amp;amp;Units=SI&amp;amp;Mask=1#Thermo-Gas">http://webbook.nist.gov/cgi/cbook.cgi?ID=C7732185&amp;Units=SI&amp;Mask=1#Thermo-Gas</a></p>
<p>Note these parameters limit the temperature range we can examine, as these parameters are not valid below 500K. There is another set of parameters for lower temperatures, but we do not consider them here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 500-1700 K valid temperature range</span>
<span class="n">A</span> <span class="o">=</span> <span class="mf">30.09200</span>
<span class="n">B</span> <span class="o">=</span> <span class="mf">6.832514</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">6.793435</span>
<span class="n">D</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.534480</span>
<span class="n">E</span> <span class="o">=</span> <span class="mf">0.082139</span>
<span class="n">F</span> <span class="o">=</span> <span class="o">-</span><span class="mf">250.8810</span>
<span class="n">G</span> <span class="o">=</span> <span class="mf">223.3967</span>
<span class="n">H</span> <span class="o">=</span> <span class="o">-</span><span class="mf">241.8264</span>

<span class="n">Hf_29815_H2O</span> <span class="o">=</span> <span class="o">-</span><span class="mf">241.83</span>  <span class="c1"># this is Hf.</span>
<span class="n">S_29815_H2O</span> <span class="o">=</span> <span class="mf">188.84</span>

<span class="n">dH_H2O</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">E</span> <span class="o">/</span> <span class="n">t</span> <span class="o">+</span> <span class="n">F</span> <span class="o">-</span> <span class="n">H</span>
<span class="n">S_H2O</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">E</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">G</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="co">
<h3>CO<a class="headerlink" href="#co" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C630080&amp;amp;Units=SI&amp;amp;Mask=1#Thermo-Gas">http://webbook.nist.gov/cgi/cbook.cgi?ID=C630080&amp;Units=SI&amp;Mask=1#Thermo-Gas</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 298. - 1300K valid temperature range</span>
<span class="n">A</span> <span class="o">=</span> <span class="mf">25.56759</span>
<span class="n">B</span> <span class="o">=</span> <span class="mf">6.096130</span>
<span class="n">C</span> <span class="o">=</span> <span class="mf">4.054656</span>
<span class="n">D</span> <span class="o">=</span> <span class="o">-</span><span class="mf">2.671301</span>
<span class="n">E</span> <span class="o">=</span> <span class="mf">0.131021</span>
<span class="n">F</span> <span class="o">=</span> <span class="o">-</span><span class="mf">118.0089</span>
<span class="n">G</span> <span class="o">=</span> <span class="mf">227.3665</span>
<span class="n">H</span> <span class="o">=</span> <span class="o">-</span><span class="mf">110.5271</span>

<span class="n">Hf_29815_CO</span> <span class="o">=</span> <span class="o">-</span><span class="mf">110.53</span>  <span class="c1"># this is Hf kJ/mol.</span>
<span class="n">S_29815_CO</span> <span class="o">=</span> <span class="mf">197.66</span>

<span class="n">dH_CO</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">E</span> <span class="o">/</span> <span class="n">t</span> <span class="o">+</span> <span class="n">F</span> <span class="o">-</span> <span class="n">H</span>
<span class="n">S_CO</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">E</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">G</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="co2">
<h3>CO<sub>2</sub><a class="headerlink" href="#co2" title="Link to this heading">#</a></h3>
<p><a class="reference external" href="http://webbook.nist.gov/cgi/cbook.cgi?ID=C124389&amp;amp;Units=SI&amp;amp;Mask=1#Thermo-Gas">http://webbook.nist.gov/cgi/cbook.cgi?ID=C124389&amp;Units=SI&amp;Mask=1#Thermo-Gas</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 298. - 1200.K valid temperature range</span>
<span class="n">A</span> <span class="o">=</span> <span class="mf">24.99735</span>
<span class="n">B</span> <span class="o">=</span> <span class="mf">55.18696</span>
<span class="n">C</span> <span class="o">=</span> <span class="o">-</span><span class="mf">33.69137</span>
<span class="n">D</span> <span class="o">=</span> <span class="mf">7.948387</span>
<span class="n">E</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.136638</span>
<span class="n">F</span> <span class="o">=</span> <span class="o">-</span><span class="mf">403.6075</span>
<span class="n">G</span> <span class="o">=</span> <span class="mf">228.2431</span>
<span class="n">H</span> <span class="o">=</span> <span class="o">-</span><span class="mf">393.5224</span>

<span class="n">Hf_29815_CO2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">393.51</span>  <span class="c1"># this is Hf.</span>
<span class="n">S_29815_CO2</span> <span class="o">=</span> <span class="mf">213.79</span>

<span class="n">dH_CO2</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">4</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="n">E</span> <span class="o">/</span> <span class="n">t</span> <span class="o">+</span> <span class="n">F</span> <span class="o">-</span> <span class="n">H</span>
<span class="n">S_CO2</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="n">B</span> <span class="o">*</span> <span class="n">t</span> <span class="o">+</span> <span class="n">C</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">D</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">-</span> <span class="n">E</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">t</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">G</span><span class="p">;</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="standard-state-heat-of-reaction">
<h3>Standard state heat of reaction<a class="headerlink" href="#standard-state-heat-of-reaction" title="Link to this heading">#</a></h3>
<p>We compute the enthalpy and free energy of reaction at 298.15 K for the following reaction <span class="math notranslate nohighlight">\(CO + H2O \rightleftharpoons H2 + CO2\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Hrxn_29815</span> <span class="o">=</span> <span class="n">Hf_29815_CO2</span> <span class="o">+</span> <span class="n">Hf_29815_H2</span> <span class="o">-</span> <span class="n">Hf_29815_CO</span> <span class="o">-</span> <span class="n">Hf_29815_H2O</span>
<span class="n">Srxn_29815</span> <span class="o">=</span> <span class="n">S_29815_CO2</span> <span class="o">+</span> <span class="n">S_29815_H2</span> <span class="o">-</span> <span class="n">S_29815_CO</span> <span class="o">-</span> <span class="n">S_29815_H2O</span>
<span class="n">Grxn_29815</span> <span class="o">=</span> <span class="n">Hrxn_29815</span> <span class="o">-</span> <span class="mf">298.15</span> <span class="o">*</span> <span class="p">(</span><span class="n">Srxn_29815</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deltaH = </span><span class="si">{0:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Hrxn_29815</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;deltaG = </span><span class="si">{0:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Grxn_29815</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>deltaH = -41.15
deltaG = -28.62
</pre></div>
</div>
</div>
</div>
</section>
<section id="non-standard-state-delta-h-and-delta-g">
<h3>Non-standard state <span class="math notranslate nohighlight">\(\Delta H\)</span> and <span class="math notranslate nohighlight">\(\Delta G\)</span><a class="headerlink" href="#non-standard-state-delta-h-and-delta-g" title="Link to this heading">#</a></h3>
<p>We have to correct for temperature change away from standard state. We only correct the enthalpy for this temperature change. The correction looks like this:</p>
<div class="math notranslate nohighlight">
\[ \Delta H_{rxn}(T) = \Delta H_{rxn}(T_{ref}) + \sum_i \nu_i (H_i(T)-H_i(T_{ref}))\]</div>
<p>Where <span class="math notranslate nohighlight">\(\nu_i\)</span> are the stoichiometric coefficients of each species, with appropriate sign for reactants and products, and <span class="math notranslate nohighlight">\((H_i(T)-H_i(T_{ref})\)</span> is precisely what is calculated for each species with the equations</p>
<p>The entropy is on an absolute scale, so we directly calculate entropy at each temperature. Recall that H is in kJ/mol and S is in J/mol/K, so we divide S by 1000 to make the units match.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Hrxn</span> <span class="o">=</span> <span class="n">Hrxn_29815</span> <span class="o">+</span> <span class="n">dH_CO2</span> <span class="o">+</span> <span class="n">dH_H2</span> <span class="o">-</span> <span class="n">dH_CO</span> <span class="o">-</span> <span class="n">dH_H2O</span>
<span class="n">Grxn</span> <span class="o">=</span> <span class="n">Hrxn</span> <span class="o">-</span> <span class="n">T</span> <span class="o">*</span> <span class="p">(</span><span class="n">S_CO2</span> <span class="o">+</span> <span class="n">S_H2</span> <span class="o">-</span> <span class="n">S_CO</span> <span class="o">-</span> <span class="n">S_H2O</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-how-the-delta-g-varies-with-temperature">
<h3>Plot how the <span class="math notranslate nohighlight">\(\Delta G\)</span> varies with temperature<a class="headerlink" href="#plot-how-the-delta-g-varies-with-temperature" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Grxn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$\Delta G_</span><span class="si">{rxn}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">Hrxn</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;$\Delta H_</span><span class="si">{rxn}</span><span class="s2">$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;(kJ/mol)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/830f33703fe1272a4cbb1b323be3eb21dec084efac7ecb96ace0528908f79326.png" src="../_images/830f33703fe1272a4cbb1b323be3eb21dec084efac7ecb96ace0528908f79326.png" />
</div>
</div>
<p>Over this temperature range the reaction is exothermic, although near 1000K it is just barely exothermic. At higher temperatures we expect the reaction to become endothermic.</p>
</section>
<section id="equilibrium-constant-calculation">
<h3>Equilibrium constant calculation<a class="headerlink" href="#equilibrium-constant-calculation" title="Link to this heading">#</a></h3>
<p>Note the equilibrium constant starts out high, i.e. strongly favoring the formation of products, but drops very quicky with increasing temperature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">R</span> <span class="o">=</span> <span class="mf">8.314e-3</span>  <span class="c1"># kJ/mol/K</span>
<span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">Grxn</span> <span class="o">/</span> <span class="n">R</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="mi">500</span><span class="p">,</span> <span class="mi">1000</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Equilibrium constant&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a67064381342a472c525accfe0da274819d42380e4aa57549ab56241bf15b0af.png" src="../_images/a67064381342a472c525accfe0da274819d42380e4aa57549ab56241bf15b0af.png" />
</div>
</div>
</section>
<section id="equilibrium-yield-of-wgs">
<h3>Equilibrium yield of WGS<a class="headerlink" href="#equilibrium-yield-of-wgs" title="Link to this heading">#</a></h3>
<p>Now let us suppose we have a reactor with a feed of H_2O and CO at 10atm at 1000K. What is the equilibrium yield of H_2? Let <span class="math notranslate nohighlight">\(\epsilon\)</span> be the extent of reaction, so that <span class="math notranslate nohighlight">\(F_i = F_{i,0} + \nu_i \epsilon\)</span>. For reactants, <span class="math notranslate nohighlight">\(\nu_i\)</span> is negative, and for products, <span class="math notranslate nohighlight">\(\nu_i\)</span> is positive. We have to solve for the extent of reaction that satisfies the equilibrium condition.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.interpolate</span><span class="w"> </span><span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>

<span class="c1">#</span>
<span class="c1"># A = CO</span>
<span class="c1"># B = H2O</span>
<span class="c1"># C = H2</span>
<span class="c1"># D = CO2</span>

<span class="n">Pa0</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">Pb0</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">Pc0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">Pd0</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># pressure in atm</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">0.082</span>
<span class="n">Temperature</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="c1"># we can estimate the equilibrium like this. We could also calculate it</span>
<span class="c1"># using the equations above, but we would have to evaluate each term. Above</span>
<span class="c1"># we simply computed a vector of enthalpies, entropies, etc... Here we interpolate</span>
<span class="n">K_func</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">K</span><span class="p">)</span>
<span class="n">K_Temperature</span> <span class="o">=</span> <span class="n">K_func</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>


<span class="c1"># If we let X be fractional conversion then we have $C_A = C_{A0}(1-X)$,</span>
<span class="c1"># $C_B = C_{B0}-C_{A0}X$, $C_C = C_{C0}+C_{A0}X$, and $C_D =</span>
<span class="c1"># C_{D0}+C_{A0}X$. We also have $K(T) = (C_C C_D)/(C_A C_B)$, which finally</span>
<span class="c1"># reduces to $0 = K(T) - Xeq^2/(1-Xeq)^2$ under these conditions.</span>


<span class="k">def</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">K_Temperature</span> <span class="o">-</span> <span class="n">X</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">X</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>


<span class="n">x0</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="p">(</span><span class="n">Xeq</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">x0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The equilibrium conversion for these feed conditions is: </span><span class="si">{0:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Xeq</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The equilibrium conversion for these feed conditions is: 0.55
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-gas-phase-pressures-of-each-species">
<h3>Compute gas phase pressures of each species<a class="headerlink" href="#compute-gas-phase-pressures-of-each-species" title="Link to this heading">#</a></h3>
<p>Since there is no change in moles for this reaction, we can directly calculation the pressures from the equilibrium conversion and the initial pressure of gases. you can see there is a slightly higher pressure of H_2 and CO_2 than the reactants, consistent with the equilibrium constant of about 1.44 at 1000K. At a lower temperature there would be a much higher yield of the products. For example, at 550K the equilibrium constant is about 58, and the pressure of H_2 is 4.4 atm due to a much higher equilibrium conversion of 0.88.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P_CO</span> <span class="o">=</span> <span class="n">Pa0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Xeq</span><span class="p">)</span>
<span class="n">P_H2O</span> <span class="o">=</span> <span class="n">Pa0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Xeq</span><span class="p">)</span>
<span class="n">P_H2</span> <span class="o">=</span> <span class="n">Pa0</span> <span class="o">*</span> <span class="n">Xeq</span>
<span class="n">P_CO2</span> <span class="o">=</span> <span class="n">Pa0</span> <span class="o">*</span> <span class="n">Xeq</span>

<span class="nb">print</span><span class="p">(</span><span class="n">P_CO</span><span class="p">,</span> <span class="n">P_H2O</span><span class="p">,</span> <span class="n">P_H2</span><span class="p">,</span> <span class="n">P_CO2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.2747854427996614 2.2747854427996614 2.7252145572003386 2.7252145572003386
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-the-equilibrium-constants">
<h3>Compare the equilibrium constants<a class="headerlink" href="#compare-the-equilibrium-constants" title="Link to this heading">#</a></h3>
<p>We can compare the equilibrium constant from the Gibbs free energy and the one from the ratio of pressures. They should be the same!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">K_Temperature</span><span class="p">)</span>
<span class="nb">print</span><span class="p">((</span><span class="n">P_CO2</span> <span class="o">*</span> <span class="n">P_H2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">P_CO</span> <span class="o">*</span> <span class="n">P_H2O</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.4352267476228722
1.4352267476228684
</pre></div>
</div>
</div>
</div>
<p>They are the same.</p>
</section>
<section id="id3">
<h3>Summary<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>The NIST Webbook provides a plethora of data for computing thermodynamic properties. It is a little tedious to enter it all into Matlab, and a little tricky to use the data to estimate temperature dependent reaction energies. A limitation of the Webbook is that it does not tell you have the thermodynamic properties change with pressure. Luckily, those changes tend to be small.</p>
<p>I noticed a different behavior in interpolation between scipy.interpolate.interp1d and Matlab’s interp1. The scipy function returns an interpolating function, whereas the Matlab function directly interpolates new values, and returns the actual interpolated data.</p>
</section>
</section>
<section id="constrained-minimization-to-find-equilibrium-compositions">
<h2>Constrained minimization to find equilibrium compositions<a class="headerlink" href="#constrained-minimization-to-find-equilibrium-compositions" title="Link to this heading">#</a></h2>
<p>Adapated from Chemical Reactor analysis and design fundamentals, Rawlings and Ekerdt, appendix A.2.3.</p>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/08/12/constrained-minimization-to-find-equilibrium-compositions/">Matlab post</a></p>
<p>The equilibrium composition of a reaction is the one that minimizes the total Gibbs free energy. The Gibbs free energy of a reacting ideal gas mixture depends on the mole fractions of each species, which are determined by the initial mole fractions of each species, the extent of reactions that convert each species, and the equilibrium constants.</p>
<p>Reaction 1: <span class="math notranslate nohighlight">\(I + B \rightleftharpoons P1\)</span></p>
<p>Reaction 2: <span class="math notranslate nohighlight">\(I + B \rightleftharpoons P2\)</span></p>
<p>Here we define the Gibbs free energy of the mixture as a function of the reaction extents.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">def</span><span class="w"> </span><span class="nf">gibbs</span><span class="p">(</span><span class="n">E</span><span class="p">):</span>
    <span class="s2">&quot;function defining Gibbs free energy as a function of reaction extents&quot;</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># known equilibrium constants and initial amounts</span>
    <span class="n">K1</span> <span class="o">=</span> <span class="mi">108</span>
    <span class="n">K2</span> <span class="o">=</span> <span class="mi">284</span>
    <span class="n">P</span> <span class="o">=</span> <span class="mf">2.5</span>
    <span class="n">yI0</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">yB0</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">yP10</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">yP20</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># compute mole fractions</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">e1</span> <span class="o">-</span> <span class="n">e2</span>
    <span class="n">yI</span> <span class="o">=</span> <span class="p">(</span><span class="n">yI0</span> <span class="o">-</span> <span class="n">e1</span> <span class="o">-</span> <span class="n">e2</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="n">yB</span> <span class="o">=</span> <span class="p">(</span><span class="n">yB0</span> <span class="o">-</span> <span class="n">e1</span> <span class="o">-</span> <span class="n">e2</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="n">yP1</span> <span class="o">=</span> <span class="p">(</span><span class="n">yP10</span> <span class="o">+</span> <span class="n">e1</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="n">yP2</span> <span class="o">=</span> <span class="p">(</span><span class="n">yP20</span> <span class="o">+</span> <span class="n">e2</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="n">G</span> <span class="o">=</span> <span class="p">(</span>
        <span class="o">-</span><span class="p">(</span><span class="n">e1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span> <span class="o">+</span> <span class="n">e2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K2</span><span class="p">))</span>
        <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">yI</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">yI</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">yB</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">yB</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">yP1</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">yP1</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">yP2</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">yP2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span>
</pre></div>
</div>
</div>
</div>
<p>The equilibrium constants for these reactions are known, and we seek to find the equilibrium reaction extents so we can determine equilibrium compositions. The equilibrium reaction extents are those that minimize the Gibbs free energy.  We have the following constraints, written in standard less than or equal to form:</p>
<p><span class="math notranslate nohighlight">\(-\epsilon_1 \le 0\)</span></p>
<p><span class="math notranslate nohighlight">\(-\epsilon_2 \le 0\)</span></p>
<p><span class="math notranslate nohighlight">\(\epsilon_1 + \epsilon_2 \le 0.5\)</span></p>
<p>In Matlab we express this in matrix form as Ax=b where</p>
<p>\begin{equation}
A = \left[ \begin{array}{cc} -1 &amp; 0 \ 0 &amp; -1 \ 1 &amp; 1 \end{array} \right]
\end{equation}</p>
<p>and</p>
<p>\begin{equation}
b = \left[ \begin{array}{c} 0 \ 0 \ 0.5\end{array} \right]
\end{equation}</p>
<p>Unlike in Matlab, in python we construct the inequality constraints as functions that are greater than or equal to zero when the constraint is met.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">constraint1</span><span class="p">(</span><span class="n">E</span><span class="p">):</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">e1</span>


<span class="k">def</span><span class="w"> </span><span class="nf">constraint2</span><span class="p">(</span><span class="n">E</span><span class="p">):</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">e2</span>


<span class="k">def</span><span class="w"> </span><span class="nf">constraint3</span><span class="p">(</span><span class="n">E</span><span class="p">):</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">-</span> <span class="p">(</span><span class="n">e1</span> <span class="o">+</span> <span class="n">e2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now, we minimize.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fmin_slsqp</span>

<span class="n">X0</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">fmin_slsqp</span><span class="p">(</span>
    <span class="n">gibbs</span><span class="p">,</span>
    <span class="n">X0</span><span class="p">,</span>
    <span class="n">ieqcons</span><span class="o">=</span><span class="p">[</span><span class="n">constraint1</span><span class="p">,</span> <span class="n">constraint2</span><span class="p">,</span> <span class="n">constraint3</span><span class="p">],</span>
    <span class="n">bounds</span><span class="o">=</span><span class="p">((</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.499</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.499</span><span class="p">)),</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">gibbs</span><span class="p">(</span><span class="n">X</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Singular matrix E in LSQ subproblem    (Exit mode 5)
            Current function value: -2.5086302290194507
            Iterations: 3
            Function evaluations: 10
            Gradient evaluations: 3
[0.20149533 0.29850467]
-2.5086302290194507
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2451/785592754.py:25: RuntimeWarning: invalid value encountered in log
  + yI * d * np.log(yI)
/tmp/ipykernel_2451/785592754.py:26: RuntimeWarning: invalid value encountered in log
  + yB * d * np.log(yB)
</pre></div>
</div>
</div>
</div>
<p>One way we can verify our solution is to plot the gibbs function and see where the minimum is, and whether there is more than one minimum. We start by making grids over the range of 0 to 0.5. Note we actually start slightly above zero because at zero there are some numerical imaginary elements of the gibbs function or it is numerically not defined since there are logs of zero there. We also set all elements where the sum of the two extents is greater than 0.5 to near zero, since those regions violate the constraints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>


<span class="k">def</span><span class="w"> </span><span class="nf">gibbs</span><span class="p">(</span><span class="n">E</span><span class="p">):</span>
    <span class="s2">&quot;function defining Gibbs free energy as a function of reaction extents&quot;</span>
    <span class="n">e1</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">e2</span> <span class="o">=</span> <span class="n">E</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="c1"># known equilibrium constants and initial amounts</span>
    <span class="n">K1</span> <span class="o">=</span> <span class="mi">108</span>
    <span class="n">K2</span> <span class="o">=</span> <span class="mi">284</span>
    <span class="n">P</span> <span class="o">=</span> <span class="mf">2.5</span>
    <span class="n">yI0</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">yB0</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">yP10</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">yP20</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="c1"># compute mole fractions</span>
    <span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">e1</span> <span class="o">-</span> <span class="n">e2</span>
    <span class="n">yI</span> <span class="o">=</span> <span class="p">(</span><span class="n">yI0</span> <span class="o">-</span> <span class="n">e1</span> <span class="o">-</span> <span class="n">e2</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="n">yB</span> <span class="o">=</span> <span class="p">(</span><span class="n">yB0</span> <span class="o">-</span> <span class="n">e1</span> <span class="o">-</span> <span class="n">e2</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="n">yP1</span> <span class="o">=</span> <span class="p">(</span><span class="n">yP10</span> <span class="o">+</span> <span class="n">e1</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="n">yP2</span> <span class="o">=</span> <span class="p">(</span><span class="n">yP20</span> <span class="o">+</span> <span class="n">e2</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
    <span class="n">G</span> <span class="o">=</span> <span class="p">(</span>
        <span class="o">-</span><span class="p">(</span><span class="n">e1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K1</span><span class="p">)</span> <span class="o">+</span> <span class="n">e2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">K2</span><span class="p">))</span>
        <span class="o">+</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">yI</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">yI</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">yB</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">yB</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">yP1</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">yP1</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">yP2</span> <span class="o">*</span> <span class="n">d</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">yP2</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">G</span>


<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">E1</span><span class="p">,</span> <span class="n">E2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>

<span class="n">sumE</span> <span class="o">=</span> <span class="n">E1</span> <span class="o">+</span> <span class="n">E2</span>
<span class="n">E1</span><span class="p">[</span><span class="n">sumE</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.00001</span>
<span class="n">E2</span><span class="p">[</span><span class="n">sumE</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.00001</span>

<span class="c1"># now evaluate gibbs</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">E1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="n">m</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">E1</span><span class="o">.</span><span class="n">shape</span>

<span class="n">G</span> <span class="o">=</span> <span class="n">gibbs</span><span class="p">([</span><span class="n">E1</span><span class="p">,</span> <span class="n">E2</span><span class="p">])</span>

<span class="n">CS</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">E1</span><span class="p">,</span> <span class="n">E2</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">G</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">G</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">100</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$\epsilon_1$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\epsilon_2$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.13336503</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.35066486</span><span class="p">],</span> <span class="s2">&quot;ro&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c8fcc6c83f2ccf24c84165506c949be848634115e2df9e4d0ac2adaae43908c8.png" src="../_images/c8fcc6c83f2ccf24c84165506c949be848634115e2df9e4d0ac2adaae43908c8.png" />
</div>
</div>
<p>You can see we found the minimum. We can compute the mole fractions pretty easily.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">e1</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">e2</span> <span class="o">=</span> <span class="n">X</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">yI0</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">yB0</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">yP10</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">yP20</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># initial mole fractions</span>

<span class="n">d</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">e1</span> <span class="o">-</span> <span class="n">e2</span>
<span class="n">yI</span> <span class="o">=</span> <span class="p">(</span><span class="n">yI0</span> <span class="o">-</span> <span class="n">e1</span> <span class="o">-</span> <span class="n">e2</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
<span class="n">yB</span> <span class="o">=</span> <span class="p">(</span><span class="n">yB0</span> <span class="o">-</span> <span class="n">e1</span> <span class="o">-</span> <span class="n">e2</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
<span class="n">yP1</span> <span class="o">=</span> <span class="p">(</span><span class="n">yP10</span> <span class="o">+</span> <span class="n">e1</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>
<span class="n">yP2</span> <span class="o">=</span> <span class="p">(</span><span class="n">yP20</span> <span class="o">+</span> <span class="n">e2</span><span class="p">)</span> <span class="o">/</span> <span class="n">d</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_I = </span><span class="si">{0:1.3f}</span><span class="s2"> y_B = </span><span class="si">{1:1.3f}</span><span class="s2"> y_P1 = </span><span class="si">{2:1.3f}</span><span class="s2"> y_P2 = </span><span class="si">{3:1.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">yI</span><span class="p">,</span> <span class="n">yB</span><span class="p">,</span> <span class="n">yP1</span><span class="p">,</span> <span class="n">yP2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>y_I = 0.000 y_B = 0.000 y_P1 = 0.403 y_P2 = 0.597
</pre></div>
</div>
</div>
</div>
<section id="id4">
<h3>summary<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>I found setting up the constraints in this example to be more confusing than the Matlab syntax.</p>
</section>
</section>
<section id="using-constrained-optimization-to-find-the-amount-of-each-phase-present">
<h2>Using constrained optimization to find the amount of each phase present<a class="headerlink" href="#using-constrained-optimization-to-find-the-amount-of-each-phase-present" title="Link to this heading">#</a></h2>
<p>The problem we solve here is that we have several compounds containing Ni and Al, and a bulk mixture of a particular composition of Ni and Al. We want to know which mixture of phases will minimize the total energy. The tricky part is that the optimization is constrained because the mixture of phases must have the overall stoichiometry we want.  We formulate the problem like this.</p>
<p>Basically, we want to minimize the function <span class="math notranslate nohighlight">\(E = \sum w_i E_i\)</span>, where <span class="math notranslate nohighlight">\(w_i\)</span> is the mass of phase <span class="math notranslate nohighlight">\(i\)</span>, and <span class="math notranslate nohighlight">\(E_i\)</span> is the energy per unit mass of phase <span class="math notranslate nohighlight">\(i\)</span>. There are some constraints to ensure conservation of mass. Let us consider the following compounds: Al, NiAl, Ni3Al, and Ni, and consider a case where the bulk composition of our alloy is 93.8% Ni and balance Al. We want to know which phases are present, and in what proportions. There are some subtleties in considering the formula and molecular weight of an alloy. We consider the formula with each species amount normalized so the fractions all add up to one. For example, Ni_3Al is represented as Ni<sub>0.75</sub>Al<sub>0.25</sub>, and the molecular weight is computed as 0.75*MW<sub>Ni</sub> + 0.25*MW<sub>Al</sub>.</p>
<p>We use scipy.optimize.fmin_slsqp to solve this problem, and define two equality constraint functions, and the bounds on each weight fraction.</p>
<p>Note: the energies in this example were computed by density functional theory at 0K.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fmin_slsqp</span>

<span class="c1"># these are atomic masses of each species</span>
<span class="n">Ni</span> <span class="o">=</span> <span class="mf">58.693</span>
<span class="n">Al</span> <span class="o">=</span> <span class="mf">26.982</span>

<span class="n">COMPOSITIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Al&quot;</span><span class="p">,</span> <span class="s2">&quot;NiAl&quot;</span><span class="p">,</span> <span class="s2">&quot;Ni3Al&quot;</span><span class="p">,</span> <span class="s2">&quot;Ni&quot;</span><span class="p">]</span>
<span class="n">MW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Al</span><span class="p">,</span> <span class="p">(</span><span class="n">Ni</span> <span class="o">+</span> <span class="n">Al</span><span class="p">)</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">Ni</span> <span class="o">+</span> <span class="n">Al</span><span class="p">)</span> <span class="o">/</span> <span class="mf">4.0</span><span class="p">,</span> <span class="n">Ni</span><span class="p">])</span>

<span class="n">xNi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>  <span class="c1"># mole fraction of nickel in each compd</span>
<span class="n">WNi</span> <span class="o">=</span> <span class="n">xNi</span> <span class="o">*</span> <span class="n">Ni</span> <span class="o">/</span> <span class="n">MW</span>  <span class="c1"># weight fraction of Ni in each cmpd</span>

<span class="n">ENERGIES</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

<span class="n">BNi</span> <span class="o">=</span> <span class="mf">0.938</span>


<span class="k">def</span><span class="w"> </span><span class="nf">G</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
    <span class="s2">&quot;function to minimize. w is a vector of weight fractions, ENERGIES is defined above.&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">ENERGIES</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ec1</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
    <span class="s2">&quot;conservation of Ni constraint&quot;</span>
    <span class="k">return</span> <span class="n">BNi</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">WNi</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ec2</span><span class="p">(</span><span class="n">w</span><span class="p">):</span>
    <span class="s2">&quot;weight fractions sum to one constraint&quot;</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>


<span class="n">w0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">])</span>  <span class="c1"># guess weight fractions</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">fmin_slsqp</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">w0</span><span class="p">,</span> <span class="n">eqcons</span><span class="o">=</span><span class="p">[</span><span class="n">ec1</span><span class="p">,</span> <span class="n">ec2</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">w0</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ci</span><span class="p">,</span> <span class="n">wi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">COMPOSITIONS</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:8s}</span><span class="s2"> </span><span class="si">{1:+8.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">wi</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully    (Exit mode 0)
            Current function value: -0.23329964437327716
            Iterations: 2
            Function evaluations: 10
            Gradient evaluations: 2
Al         +0.00%
NiAl       +0.00%
Ni3Al     +46.66%
Ni        +53.34%
</pre></div>
</div>
</div>
</div>
<p>So, the sample will be about 47% <em>by weight</em> of Ni3Al, and 53% <em>by weight</em> of pure Ni.</p>
<p>It may be convenient to formulate this in terms of moles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fmin_slsqp</span>

<span class="n">COMPOSITIONS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Al&quot;</span><span class="p">,</span> <span class="s2">&quot;NiAl&quot;</span><span class="p">,</span> <span class="s2">&quot;Ni3Al&quot;</span><span class="p">,</span> <span class="s2">&quot;Ni&quot;</span><span class="p">]</span>
<span class="n">xNi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>  <span class="c1"># define this in mole fractions</span>

<span class="n">ENERGIES</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>

<span class="n">xNiB</span> <span class="o">=</span> <span class="mf">0.875</span>  <span class="c1"># bulk Ni composition</span>


<span class="k">def</span><span class="w"> </span><span class="nf">G</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s2">&quot;function to minimize&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">ENERGIES</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ec1</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s2">&quot;conservation of Ni&quot;</span>
    <span class="n">Ntot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">Ntot</span> <span class="o">*</span> <span class="n">xNiB</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">xNi</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ec2</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="s2">&quot;mole fractions sum to one&quot;</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>


<span class="n">n0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">])</span>  <span class="c1"># initial guess of mole fractions</span>

<span class="n">y</span> <span class="o">=</span> <span class="n">fmin_slsqp</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">eqcons</span><span class="o">=</span><span class="p">[</span><span class="n">ec1</span><span class="p">,</span> <span class="n">ec2</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)]</span> <span class="o">*</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">n0</span><span class="p">)))</span>

<span class="k">for</span> <span class="n">ci</span><span class="p">,</span> <span class="n">xi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">COMPOSITIONS</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:8s}</span><span class="s2"> </span><span class="si">{1:+8.2%}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ci</span><span class="p">,</span> <span class="n">xi</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimization terminated successfully    (Exit mode 0)
            Current function value: -0.25000000000000017
            Iterations: 2
            Function evaluations: 10
            Gradient evaluations: 2
Al         +0.00%
NiAl       +0.00%
Ni3Al     +50.00%
Ni        +50.00%
</pre></div>
</div>
</div>
</div>
<p>This means we have a 1:1 molar ratio of Ni and Ni<sub>0.75</sub>Al<sub>0.25</sub>. That works out to the overall bulk composition in this particular problem.</p>
<p>Let us verify that these two approaches really lead to the same conclusions. On a weight basis we estimate 53.3%wt Ni and 46.7%wt Ni3Al, whereas we predict an equimolar mixture of the two phases. Below we compute the mole fraction of Ni in each case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># these are atomic masses of each species</span>
<span class="n">Ni</span> <span class="o">=</span> <span class="mf">58.693</span>
<span class="n">Al</span> <span class="o">=</span> <span class="mf">26.982</span>

<span class="c1"># Molar case</span>
<span class="c1"># 1 mol Ni + 1 mol Ni_{0.75}Al_{0.25}</span>
<span class="n">N1</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">N2</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">mol_Ni</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">N1</span> <span class="o">+</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">N2</span>
<span class="n">xNi</span> <span class="o">=</span> <span class="n">mol_Ni</span> <span class="o">/</span> <span class="p">(</span><span class="n">N1</span> <span class="o">+</span> <span class="n">N2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">xNi</span><span class="p">)</span>

<span class="c1"># Mass case</span>
<span class="n">M1</span> <span class="o">=</span> <span class="mf">0.533</span>
<span class="n">M2</span> <span class="o">=</span> <span class="mf">0.467</span>
<span class="n">MW1</span> <span class="o">=</span> <span class="n">Ni</span>
<span class="n">MW2</span> <span class="o">=</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">Ni</span> <span class="o">+</span> <span class="mf">0.25</span> <span class="o">*</span> <span class="n">Al</span>

<span class="n">xNi2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">*</span> <span class="n">M1</span> <span class="o">/</span> <span class="n">MW1</span> <span class="o">+</span> <span class="mf">0.75</span> <span class="o">*</span> <span class="n">M2</span> <span class="o">/</span> <span class="n">MW2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">M1</span> <span class="o">/</span> <span class="n">MW1</span> <span class="o">+</span> <span class="n">M2</span> <span class="o">/</span> <span class="n">MW2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">xNi2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.875
0.874192746384855
</pre></div>
</div>
</div>
</div>
<p>You can see the overall mole fraction of Ni is practically the same in each case.</p>
</section>
<section id="conservation-of-mass-in-chemical-reactions">
<h2>Conservation of mass in chemical reactions<a class="headerlink" href="#conservation-of-mass-in-chemical-reactions" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/12/18/conservation-of-mass-in-chemical-reactions/">Matlab post</a></p>
<p>Atoms cannot be destroyed in non-nuclear chemical reactions, hence it follows that the same number of atoms entering a reactor must also leave the reactor. The atoms may leave the reactor in a different molecular configuration due to the reaction, but the total mass leaving the reactor must be the same. Here we look at a few ways to show this.</p>
<p>We consider the water gas shift reaction : <span class="math notranslate nohighlight">\(CO + H_2O \rightleftharpoons H_2 + CO_2\)</span>. We can illustrate the conservation of mass with the following equation: <span class="math notranslate nohighlight">\(\bf{\nu}\bf{M}=\bf{0}\)</span>. Where <span class="math notranslate nohighlight">\(\bf{\nu}\)</span> is the stoichiometric coefficient vector and <span class="math notranslate nohighlight">\(\bf{M}\)</span> is a column vector of molecular weights. For simplicity, we use pure isotope molecular weights, and not the isotope-weighted molecular weights. This equation simply examines the mass on the right side of the equation and the mass on left side of the equation.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">nu</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">M</span> <span class="o">=</span> <span class="p">[</span><span class="mi">28</span><span class="p">,</span> <span class="mi">18</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">44</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">nu</span><span class="p">,</span> <span class="n">M</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<p>You can see that sum of the stoichiometric coefficients times molecular weights is zero. In other words a CO and H_2O have the same mass as H_2 and CO_2.</p>
<p>For any balanced chemical equation, there are the same number of each kind of atom on each side of the equation. Since the mass of each atom is unchanged with reaction, that means the mass of all the species that are reactants must equal the mass of all the species that are products! Here we look at the number of C, O, and H on each side of the reaction. Now if we add the mass of atoms in the reactants and products, it should sum to zero (since we used the negative sign for stoichiometric coefficients of reactants).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="c1"># C   O   H</span>
<span class="n">reactants</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">]</span>
<span class="n">products</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>

<span class="n">atomic_masses</span> <span class="o">=</span> <span class="p">[</span><span class="mf">12.011</span><span class="p">,</span> <span class="mf">15.999</span><span class="p">,</span> <span class="mf">1.0079</span><span class="p">]</span>  <span class="c1"># atomic masses</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">reactants</span><span class="p">,</span> <span class="n">atomic_masses</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">products</span><span class="p">,</span> <span class="n">atomic_masses</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>That is all there is to mass conservation with reactions. Nothing changes if there are lots of reactions, as long as each reaction is properly balanced, and none of them are nuclear reactions!</p>
</section>
<section id="numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead">
<h2>Numerically calculating an effectiveness factor for a porous catalyst bead<a class="headerlink" href="#numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/11/18/numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead/">Matlab post</a></p>
<p>If reaction rates are fast compared to diffusion in a porous catalyst pellet, then the observed kinetics will appear to be slower than they really are because not all of the catalyst surface area will be effectively used. For example, the reactants may all be consumed in the near surface area of a catalyst bead, and the inside of the bead will be unutilized because no reactants can get in due to the high reaction rates.</p>
<p>References: Ch 12. Elements of Chemical Reaction Engineering, Fogler, 4th edition.</p>
<p>A mole balance on the particle volume in spherical coordinates with a first order reaction leads to: <span class="math notranslate nohighlight">\(\frac{d^2Ca}{dr^2} + \frac{2}{r}\frac{dCa}{dr}-\frac{k}{D_e}C_A=0\)</span> with boundary conditions <span class="math notranslate nohighlight">\(C_A(R) = C_{As}\)</span> and <span class="math notranslate nohighlight">\(\frac{dCa}{dr}=0\)</span> at <span class="math notranslate nohighlight">\(r=0\)</span>. We convert this equation to a system of first order ODEs by letting <span class="math notranslate nohighlight">\(W_A=\frac{dCa}{dr}\)</span>. Then, our two equations become:</p>
<p><span class="math notranslate nohighlight">\(\frac{dCa}{dr} = W_A\)</span></p>
<p>and</p>
<p><span class="math notranslate nohighlight">\(\frac{dW_A}{dr} = -\frac{2}{r} W_A + \frac{k}{D_E} C_A\)</span></p>
<p>We have a condition of no flux (<span class="math notranslate nohighlight">\(W_A=0\)</span>) at r=0 and Ca(R) = CAs, which makes this a boundary value problem. We use the shooting method here, and guess what Ca(0) is and iterate the guess to get Ca(R) = CAs.</p>
<p>The value of the second differential equation at r=0 is tricky because at this place we have a 0/0 term. We use L’Hopital’s rule to evaluate it. The derivative of the top is <span class="math notranslate nohighlight">\(\frac{dW_A}{dr}\)</span> and the derivative of the bottom is 1. So, we have
<span class="math notranslate nohighlight">\(\frac{dW_A}{dr} = -2\frac{dW_A}{dr} + \frac{k}{D_E} C_A\)</span></p>
<p>Which leads to:</p>
<p><span class="math notranslate nohighlight">\(3 \frac{dW_A}{dr} =  \frac{k}{D_E} C_A\)</span></p>
<p>or <span class="math notranslate nohighlight">\(\frac{dW_A}{dr} =  \frac{3k}{D_E} C_A\)</span> at <span class="math notranslate nohighlight">\(r=0\)</span>.</p>
<p>Finally, we implement the equations in Python and solve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">De</span> <span class="o">=</span> <span class="mf">0.1</span>  <span class="c1"># diffusivity cm^2/s</span>
<span class="n">R</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># particle radius, cm</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">6.4</span>  <span class="c1"># rate constant (1/s)</span>
<span class="n">CAs</span> <span class="o">=</span> <span class="mf">0.2</span>  <span class="c1"># concentration of A at outer radius of particle (mol/L)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">ode</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
    <span class="n">Wa</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># molar rate of delivery of A to surface of particle</span>
    <span class="n">Ca</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># concentration of A in the particle at r</span>
    <span class="c1"># this solves the singularity at r = 0</span>
    <span class="k">if</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">dWadr</span> <span class="o">=</span> <span class="n">k</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">De</span> <span class="o">*</span> <span class="n">Ca</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">dWadr</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">Wa</span> <span class="o">/</span> <span class="n">r</span> <span class="o">+</span> <span class="n">k</span> <span class="o">/</span> <span class="n">De</span> <span class="o">*</span> <span class="n">Ca</span>
    <span class="n">dCadr</span> <span class="o">=</span> <span class="n">Wa</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dWadr</span><span class="p">,</span> <span class="n">dCadr</span><span class="p">]</span>


<span class="c1"># Initial conditions</span>
<span class="n">Ca0</span> <span class="o">=</span> <span class="mf">0.029315</span>  <span class="c1"># Ca(0) (mol/L) guessed to satisfy Ca(R) = CAs</span>
<span class="n">Wa0</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># no flux at r=0 (mol/m^2/s)</span>

<span class="n">rspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

<span class="n">Y</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">ode</span><span class="p">,</span> <span class="p">[</span><span class="n">Wa0</span><span class="p">,</span> <span class="n">Ca0</span><span class="p">],</span> <span class="n">rspan</span><span class="p">)</span>

<span class="n">Ca</span> <span class="o">=</span> <span class="n">Y</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="c1"># here we check that Ca(R) = Cas</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;At r=</span><span class="si">{0}</span><span class="s2"> Ca=</span><span class="si">{1}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">rspan</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Ca</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">rspan</span><span class="p">,</span> <span class="n">Ca</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Particle radius&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$C_A$&quot;</span><span class="p">)</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">rspan</span>
<span class="n">eta_numerical</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">Ca</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">CAs</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">r</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">eta_numerical</span><span class="p">)</span>

<span class="n">phi</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">k</span> <span class="o">/</span> <span class="n">De</span><span class="p">)</span>
<span class="n">eta_analytical</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="n">phi</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">phi</span><span class="p">))</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">eta_analytical</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>At r=0.5 Ca=0.20000148865173356
0.5630113483142608
0.5630033628012618
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2451/1797265324.py:41: DeprecationWarning: `trapz` is deprecated. Use `trapezoid` instead, or one of the numerical integration functions in `scipy.integrate`.
  eta_numerical = np.trapz(k * Ca * 4 * np.pi * (r**2), r) / np.trapz(k * CAs * 4 * np.pi * (r**2), r)
</pre></div>
</div>
<img alt="../_images/4e0623b8f5381f383e4d130c7bfcfbb941ea75663883148a79cdd4d6fb0a963d.png" src="../_images/4e0623b8f5381f383e4d130c7bfcfbb941ea75663883148a79cdd4d6fb0a963d.png" />
</div>
</div>
<p>You can see the concentration of A inside the particle is significantly lower than outside the particle. That is because it is reacting away faster than it can diffuse into the particle. Hence, the overall reaction rate in the particle is lower than it would be without the diffusion limit.</p>
<p>The effectiveness factor is the ratio of the actual reaction rate in the particle with diffusion limitation to the ideal rate in the particle if there was no concentration gradient:</p>
<div class="math notranslate nohighlight">
\[\eta = \frac{\int_0^R k'' a C_A(r) 4 \pi r^2 dr}{\int_0^R k'' a C_{As} 4 \pi r^2 dr}\]</div>
<p>We will evaluate this numerically from our solution and compare it to the analytical solution. The results are in good agreement, and you can make the numerical estimate better by increasing the number of points in the solution so that the numerical integration is more accurate.</p>
<p>Why go through the numerical solution when an analytical solution exists? The analytical solution here is only good for 1st order kinetics in a sphere. What would you do for a complicated rate law? You might be able to find some limiting conditions where the analytical equation above is relevant, and if you are lucky, they are appropriate for your problem. If not, it is a good thing you can figure this out numerically!</p>
<p>Thanks to Radovan Omorjan for helping me figure out the ODE at r=0!</p>
</section>
<section id="computing-a-pipe-diameter">
<h2>Computing a pipe diameter<a class="headerlink" href="#computing-a-pipe-diameter" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/10/27/compute-pipe-diameter/">Matlab post</a>
A heat exchanger must handle 2.5 L/s of water through a smooth pipe with length of 100 m. The pressure drop cannot exceed 103 kPa at 25 degC. Compute the minimum pipe diameter required for this application.</p>
<p>Adapted from problem 8.8 in Problem solving in chemical and Biochemical Engineering with Polymath, Excel, and Matlab. page 303.</p>
<p>We need to estimate the Fanning friction factor for these conditions so we can estimate the frictional losses that result in a pressure drop for a uniform, circular pipe. The frictional forces are given by <span class="math notranslate nohighlight">\(F_f = 2f_F \frac{\Delta L v^2}{D}\)</span>, and the corresponding pressure drop is given by <span class="math notranslate nohighlight">\(\Delta P = \rho F_f\)</span>. In these equations, <span class="math notranslate nohighlight">\(\rho\)</span> is the fluid density, <span class="math notranslate nohighlight">\(v\)</span> is the fluid velocity, <span class="math notranslate nohighlight">\(D\)</span> is the pipe diameter, and <span class="math notranslate nohighlight">\(f_F\)</span> is the Fanning friction factor. The average fluid velocity is given by <span class="math notranslate nohighlight">\(v = \frac{q}{\pi D^2/4}\)</span>.</p>
<p>For laminar flow, we estimate <span class="math notranslate nohighlight">\(f_F = 16/Re\)</span>, which is a linear equation, and for turbulent flow (<span class="math notranslate nohighlight">\(Re &gt; 2100\)</span>) we have the implicit equation <span class="math notranslate nohighlight">\(\frac{1}{\sqrt{f_F}}=4.0 \log(Re \sqrt{f_F})-0.4\)</span>. Of course, we define <span class="math notranslate nohighlight">\(Re = \frac{D v\rho}{\mu}\)</span> where <span class="math notranslate nohighlight">\(\mu\)</span> is the viscosity of the fluid.</p>
<p>It is known that <span class="math notranslate nohighlight">\(\rho(T) = 46.048 + 9.418 T -0.0329 T^2 +4.882\times10^{-5}-2.895\times10^{-8}T^4\)</span> and <span class="math notranslate nohighlight">\(\mu = \exp\left({-10.547 + \frac{541.69}{T-144.53}}\right)\)</span> where <span class="math notranslate nohighlight">\(\rho\)</span> is in kg/m^3 and <span class="math notranslate nohighlight">\(\mu\)</span> is in kg/(m*s).</p>
<p>The aim is to find <span class="math notranslate nohighlight">\(D\)</span> that solves: <span class="math notranslate nohighlight">\(\Delta p = \rho 2 f_F \frac{\Delta L v^2}{D}\)</span>. This is a nonlinear equation in <span class="math notranslate nohighlight">\(D\)</span>, since D affects the fluid velocity, the Re, and the Fanning friction factor. Here is the solution</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">25</span> <span class="o">+</span> <span class="mf">273.15</span>
<span class="n">Q</span> <span class="o">=</span> <span class="mf">2.5e-3</span>  <span class="c1"># m^3/s</span>
<span class="n">deltaP</span> <span class="o">=</span> <span class="mi">103000</span>  <span class="c1"># Pa</span>
<span class="n">deltaL</span> <span class="o">=</span> <span class="mi">100</span>  <span class="c1"># m</span>

<span class="c1"># Note these correlations expect dimensionless T, where the magnitude</span>
<span class="c1"># of T is in K</span>


<span class="k">def</span><span class="w"> </span><span class="nf">rho</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">46.048</span> <span class="o">+</span> <span class="mf">9.418</span> <span class="o">*</span> <span class="n">T</span> <span class="o">-</span> <span class="mf">0.0329</span> <span class="o">*</span> <span class="n">T</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="mf">4.882e-5</span> <span class="o">*</span> <span class="n">T</span><span class="o">**</span><span class="mi">3</span> <span class="o">-</span> <span class="mf">2.895e-8</span> <span class="o">*</span> <span class="n">T</span><span class="o">**</span><span class="mi">4</span>


<span class="k">def</span><span class="w"> </span><span class="nf">mu</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">10.547</span> <span class="o">+</span> <span class="mf">541.69</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mf">144.53</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">fanning_friction_factor_</span><span class="p">(</span><span class="n">Re</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">Re</span> <span class="o">&lt;</span> <span class="mi">2100</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Flow is probably not turbulent, so this correlation is not appropriate.&quot;</span><span class="p">)</span>

    <span class="c1"># solve the Nikuradse correlation to get the friction factor</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">fz</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">Re</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">)</span>

    <span class="p">(</span><span class="n">sol</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">fz</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sol</span>


<span class="n">fanning_friction_factor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vectorize</span><span class="p">(</span><span class="n">fanning_friction_factor_</span><span class="p">)</span>

<span class="n">Re</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">2200</span><span class="p">,</span> <span class="mi">9000</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">fanning_friction_factor</span><span class="p">(</span><span class="n">Re</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Re</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Re&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;fanning friction factor&quot;</span><span class="p">)</span>
<span class="c1"># You can see why we use 0.01 as an initial guess for solving for the</span>
<span class="c1"># Fanning friction factor; it falls in the middle of ranges possible</span>
<span class="c1"># for these Re numbers.</span>


<span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">D</span><span class="p">):</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">D</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">Re</span> <span class="o">=</span> <span class="n">D</span> <span class="o">*</span> <span class="n">v</span> <span class="o">*</span> <span class="n">rho</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">/</span> <span class="n">mu</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

    <span class="n">fF</span> <span class="o">=</span> <span class="n">fanning_friction_factor</span><span class="p">(</span><span class="n">Re</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">deltaP</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">fF</span> <span class="o">*</span> <span class="n">rho</span><span class="p">(</span><span class="n">T</span><span class="p">)</span> <span class="o">*</span> <span class="n">deltaL</span> <span class="o">*</span> <span class="n">v</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">D</span>


<span class="p">(</span><span class="n">D</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The minimum pipe diameter is </span><span class="si">{0}</span><span class="s2"> m</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">D</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The minimum pipe diameter is 0.0389653369530596 m
</pre></div>
</div>
<img alt="../_images/ba1e96e64212bbe5b4bc5bc27962cd203f7f1503a0de013e21ef1b205fe5fc33.png" src="../_images/ba1e96e64212bbe5b4bc5bc27962cd203f7f1503a0de013e21ef1b205fe5fc33.png" />
</div>
</div>
<p>Any pipe diameter smaller than that value will result in a larger pressure drop at the same volumetric flow rate, or a smaller volumetric flowrate at the same pressure drop. Either way, it will not meet the design specification.</p>
</section>
<section id="reading-parameter-database-text-files-in-python">
<h2>Reading parameter database text files in python<a class="headerlink" href="#reading-parameter-database-text-files-in-python" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/09/10/reading-parameter-database-text-files-in-matlab/">Matlab post</a></p>
<p>The datafile at <a class="reference external" href="http://terpconnect.umd.edu/~nsw/ench250/antoine.dat%3E">http://terpconnect.umd.edu/~nsw/ench250/antoine.dat&gt;</a>(dead link) contains data that can be used to estimate the vapor pressure of about 700 pure compounds using the Antoine equation</p>
<p>The data file has the following contents:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Antoine Coefficients
  log(P) = A-B/(T+C) where P is in mmHg and T is in Celsius
Source of data: Yaws and Yang (Yaws, C.  L.  and Yang, H.  C.,
&quot;To estimate vapor pressure easily. antoine coefficients relate vapor pressure to temperature for almost 700 major organic compounds&quot;, Hydrocarbon Processing, 68(10), p65-68, 1989.

ID  formula  compound name                  A       B       C     Tmin Tmax ??    ?
-----------------------------------------------------------------------------------
  1 CCL4     carbon-tetrachloride        6.89410 1219.580 227.170  -20  101 Y2    0
  2 CCL3F    trichlorofluoromethane      6.88430 1043.010 236.860  -33   27 Y2    0
  3 CCL2F2   dichlorodifluoromethane     6.68619  782.072 235.377 -119  -30 Y6    0
</pre></div>
</div>
<p>To use this data, you find the line that has the compound you want, and read off the data. You could do that manually for each component you want but that is tedious, and error prone. Today we will see how to retrieve the file, then read the data into python to create a database we can use to store and retrieve the data.</p>
<p>We will use the data to find the temperature at which the vapor pressure of acetone is 400 mmHg.</p>
<p>We use numpy.loadtxt to read the file, and tell the function the format of each column. This creates a special kind of record array which we can access data by field name.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
    <span class="s2">&quot;../../data/antoine_data.dat&quot;</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;formula&quot;</span><span class="p">,</span> <span class="s2">&quot;S8&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;S28&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Tmin&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Tmax&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;??&quot;</span><span class="p">,</span> <span class="s2">&quot;S4&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;S4&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">skiprows</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">names</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>

<span class="n">acetone</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">names</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;acetone&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="n">acetone</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">59</span><span class="p">],</span> <span class="n">line</span> <span class="mi">4</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="ne">----&gt; </span><span class="mi">4</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span>     <span class="s2">&quot;../../data/antoine_data.dat&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="n">dtype</span><span class="o">=</span><span class="p">[</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>         <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>         <span class="p">(</span><span class="s2">&quot;formula&quot;</span><span class="p">,</span> <span class="s2">&quot;S8&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>         <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;S28&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>         <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>         <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>         <span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>         <span class="p">(</span><span class="s2">&quot;Tmin&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>         <span class="p">(</span><span class="s2">&quot;Tmax&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>         <span class="p">(</span><span class="s2">&quot;??&quot;</span><span class="p">,</span> <span class="s2">&quot;S4&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>         <span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;S4&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="n">skiprows</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="n">names</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span> <span class="n">acetone</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">names</span> <span class="o">==</span> <span class="sa">b</span><span class="s2">&quot;acetone&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_npyio_impl.py:1397,</span> in <span class="ni">loadtxt</span><span class="nt">(fname, dtype, comments, delimiter, converters, skiprows, usecols, unpack, ndmin, encoding, max_rows, quotechar, like)</span>
<span class="g g-Whitespace">   </span><span class="mi">1394</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delimiter</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1395</span>     <span class="n">delimiter</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1397</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">_read</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1398</span>             <span class="n">converters</span><span class="o">=</span><span class="n">converters</span><span class="p">,</span> <span class="n">skiplines</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1399</span>             <span class="n">unpack</span><span class="o">=</span><span class="n">unpack</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="n">ndmin</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1400</span>             <span class="n">max_rows</span><span class="o">=</span><span class="n">max_rows</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="n">quotechar</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1402</span> <span class="k">return</span> <span class="n">arr</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_npyio_impl.py:1024,</span> in <span class="ni">_read</span><span class="nt">(fname, delimiter, comment, quote, imaginary_unit, usecols, skiplines, max_rows, converters, ndmin, unpack, dtype, encoding)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>     <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1024</span>     <span class="n">fh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">_datasource</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1025</span>     <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1026</span>         <span class="n">encoding</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="s1">&#39;encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;latin1&#39;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_datasource.py:192,</span> in <span class="ni">open</span><span class="nt">(path, mode, destpath, encoding, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span><span class="sd"> Open `path` with `mode` and return the file object.</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span><span class="sd"> </span>
<span class="sd">   (...)    188 </span>
<span class="g g-Whitespace">    </span><span class="mi">189</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">191</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">(</span><span class="n">destpath</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">192</span> <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_datasource.py:526,</span> in <span class="ni">DataSource.open</span><span class="nt">(self, path, mode, encoding, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">524</span>     <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;bz2&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">525</span>         <span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">526</span>     <span class="k">return</span> <span class="n">_file_openers</span><span class="p">[</span><span class="n">ext</span><span class="p">](</span><span class="n">found</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">527</span>                               <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">528</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">529</span>     <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../../data/antoine_data.dat&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># for readability we unpack the array into variables</span>
<span class="nb">id</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">Tmin</span><span class="p">,</span> <span class="n">Tmax</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span> <span class="o">=</span> <span class="n">acetone</span>

<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Tmin</span><span class="p">,</span> <span class="n">Tmax</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">C</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;T ($^\circ$C)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;P$_</span><span class="si">{vap}</span><span class="s2">$ (mmHg)&quot;</span><span class="p">)</span>

<span class="c1"># Find T at which Pvap = 400 mmHg</span>
<span class="c1"># from our graph we might guess T ~ 40 ^{\circ}C</span>


<span class="k">def</span><span class="w"> </span><span class="nf">objective</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">400</span> <span class="o">-</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">C</span><span class="p">))</span>


<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>

<span class="p">(</span><span class="n">Tsol</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">objective</span><span class="p">,</span> <span class="mi">40</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">Tsol</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The vapor pressure is 400 mmHg at T = </span><span class="si">{0:1.1f}</span><span class="s2"> degC&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Tsol</span><span class="p">))</span>

<span class="c1"># Plot CRC data http://en.wikipedia.org/wiki/Acetone_%28data_page%29#Vapor_pressure_of_liquid</span>
<span class="c1"># We only include the data for the range where the Antoine fit is valid.</span>

<span class="n">Tcrc</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mf">59.4</span><span class="p">,</span> <span class="o">-</span><span class="mf">31.1</span><span class="p">,</span> <span class="o">-</span><span class="mf">9.4</span><span class="p">,</span> <span class="mf">7.7</span><span class="p">,</span> <span class="mf">39.5</span><span class="p">,</span> <span class="mf">56.5</span><span class="p">]</span>
<span class="n">Pcrc</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">760</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Tcrc</span><span class="p">,</span> <span class="n">Pcrc</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;Antoine&quot;</span><span class="p">,</span> <span class="s2">&quot;CRC Handbook&quot;</span><span class="p">],</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">60</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="c1"># for readability we unpack the array into variables</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="nb">id</span><span class="p">,</span> <span class="n">formula</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">C</span><span class="p">,</span> <span class="n">Tmin</span><span class="p">,</span> <span class="n">Tmax</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span> <span class="o">=</span> <span class="n">acetone</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Tmin</span><span class="p">,</span> <span class="n">Tmax</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">P</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">C</span><span class="p">))</span>

<span class="ne">NameError</span>: name &#39;acetone&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>This result is close to the value reported <a class="reference external" href="http://en.wikipedia.org/wiki/Acetone_%28data_page%29#Vapor_pressure_of_liquid"> here</a> (39.5 degC), from the CRC Handbook. The difference is probably that the value reported in the CRC is an actual experimental number.</p>
</section>
<section id="calculating-a-bubble-point-pressure-of-a-mixture">
<h2>Calculating a bubble point pressure of a mixture<a class="headerlink" href="#calculating-a-bubble-point-pressure-of-a-mixture" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/09/15/calculating-a-bubble-point-pressure/">Matlab post</a></p>
<p>Adapted from <a class="reference external" href="http://terpconnect.umd.edu/~nsw/ench250/bubpnt.htm%3E">http://terpconnect.umd.edu/~nsw/ench250/bubpnt.htm&gt;</a>(dead link)</p>
<p>We previously learned to read a datafile containing lots of Antoine coefficients into a database, and use the coefficients to estimate vapor pressure of a single compound. Here we use those coefficents to compute a bubble point pressure of a mixture.</p>
<p>The bubble point is the temperature at which the sum of the component vapor pressures is equal to the the total pressure. This is where a bubble of vapor will first start forming, and the mixture starts to boil.</p>
<p>Consider an equimolar mixture of benzene, toluene, chloroform, acetone and methanol. Compute the bubble point at 760 mmHg, and the gas phase composition. The gas phase composition is given by: <span class="math notranslate nohighlight">\(y_i = x_i*P_i/P_T\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>

<span class="c1"># load our thermodynamic data</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
    <span class="s2">&quot;../../data/antoine_data.dat&quot;</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;formula&quot;</span><span class="p">,</span> <span class="s2">&quot;S8&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;S28&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Tmin&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;Tmax&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;??&quot;</span><span class="p">,</span> <span class="s2">&quot;S4&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;S4&quot;</span><span class="p">),</span>
    <span class="p">],</span>
    <span class="n">skiprows</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">compounds</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;benzene&quot;</span><span class="p">,</span> <span class="s2">&quot;toluene&quot;</span><span class="p">,</span> <span class="s2">&quot;chloroform&quot;</span><span class="p">,</span> <span class="s2">&quot;acetone&quot;</span><span class="p">,</span> <span class="s2">&quot;methanol&quot;</span><span class="p">]</span>

<span class="c1"># extract the data we want</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)][</span><span class="s2">&quot;A&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">compounds</span><span class="p">])</span>
<span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)][</span><span class="s2">&quot;B&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">compounds</span><span class="p">])</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)][</span><span class="s2">&quot;C&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">compounds</span><span class="p">])</span>
<span class="n">Tmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)][</span><span class="s2">&quot;Tmin&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">compounds</span><span class="p">])</span>
<span class="n">Tmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">x</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;UTF-8&quot;</span><span class="p">)][</span><span class="s2">&quot;Tmax&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">compounds</span><span class="p">])</span>

<span class="c1"># we have an equimolar mixture</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">])</span>

<span class="c1"># Given a T, we can compute the pressure of each species like this:</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">67</span>  <span class="c1"># degC</span>
<span class="n">P</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">C</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">))</span>  <span class="c1"># total mole-fraction weighted pressure</span>

<span class="n">Tguess</span> <span class="o">=</span> <span class="mi">67</span>
<span class="n">Ptotal</span> <span class="o">=</span> <span class="mi">760</span>


<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">T</span><span class="p">):</span>
    <span class="n">P</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="n">C</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Ptotal</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">P</span><span class="p">)</span>


<span class="p">(</span><span class="n">Tbubble</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">Tguess</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The bubble point is </span><span class="si">{0:1.2f}</span><span class="s2"> degC&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Tbubble</span><span class="p">))</span>

<span class="c1"># double check answer is in a valid T range</span>
<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">Tbubble</span> <span class="o">&lt;</span> <span class="n">Tmin</span><span class="p">)</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">Tbubble</span> <span class="o">&gt;</span> <span class="n">Tmax</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;T_bubble is out of range!&quot;</span><span class="p">)</span>

<span class="c1"># print gas phase composition</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">/</span> <span class="p">(</span><span class="n">Tbubble</span> <span class="o">+</span> <span class="n">C</span><span class="p">))</span> <span class="o">/</span> <span class="n">Ptotal</span>

<span class="k">for</span> <span class="n">cmpd</span><span class="p">,</span> <span class="n">yi</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">compounds</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;y_</span><span class="si">{0:&lt;10s}</span><span class="s2"> = </span><span class="si">{1:1.3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">cmpd</span><span class="p">,</span> <span class="n">yi</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">61</span><span class="p">],</span> <span class="n">line</span> <span class="mi">5</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="c1"># load our thermodynamic data</span>
<span class="ne">----&gt; </span><span class="mi">5</span> <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span>     <span class="s2">&quot;../../data/antoine_data.dat&quot;</span><span class="p">,</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span>     <span class="n">dtype</span><span class="o">=</span><span class="p">[</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span>         <span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span> <span class="nb">int</span><span class="p">),</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>         <span class="p">(</span><span class="s2">&quot;formula&quot;</span><span class="p">,</span> <span class="s2">&quot;S8&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>         <span class="p">(</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;S28&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>         <span class="p">(</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span>         <span class="p">(</span><span class="s2">&quot;B&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span>         <span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>         <span class="p">(</span><span class="s2">&quot;Tmin&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>         <span class="p">(</span><span class="s2">&quot;Tmax&quot;</span><span class="p">,</span> <span class="nb">float</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>         <span class="p">(</span><span class="s2">&quot;??&quot;</span><span class="p">,</span> <span class="s2">&quot;S4&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>         <span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">,</span> <span class="s2">&quot;S4&quot;</span><span class="p">),</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>     <span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="n">skiprows</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span> <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="n">compounds</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;benzene&quot;</span><span class="p">,</span> <span class="s2">&quot;toluene&quot;</span><span class="p">,</span> <span class="s2">&quot;chloroform&quot;</span><span class="p">,</span> <span class="s2">&quot;acetone&quot;</span><span class="p">,</span> <span class="s2">&quot;methanol&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span> <span class="c1"># extract the data we want</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_npyio_impl.py:1397,</span> in <span class="ni">loadtxt</span><span class="nt">(fname, dtype, comments, delimiter, converters, skiprows, usecols, unpack, ndmin, encoding, max_rows, quotechar, like)</span>
<span class="g g-Whitespace">   </span><span class="mi">1394</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">delimiter</span><span class="p">,</span> <span class="nb">bytes</span><span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">1395</span>     <span class="n">delimiter</span> <span class="o">=</span> <span class="n">delimiter</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;latin1&#39;</span><span class="p">)</span>
<span class="ne">-&gt; </span><span class="mi">1397</span> <span class="n">arr</span> <span class="o">=</span> <span class="n">_read</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="n">comment</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="n">delimiter</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1398</span>             <span class="n">converters</span><span class="o">=</span><span class="n">converters</span><span class="p">,</span> <span class="n">skiplines</span><span class="o">=</span><span class="n">skiprows</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1399</span>             <span class="n">unpack</span><span class="o">=</span><span class="n">unpack</span><span class="p">,</span> <span class="n">ndmin</span><span class="o">=</span><span class="n">ndmin</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span>
<span class="g g-Whitespace">   </span><span class="mi">1400</span>             <span class="n">max_rows</span><span class="o">=</span><span class="n">max_rows</span><span class="p">,</span> <span class="n">quote</span><span class="o">=</span><span class="n">quotechar</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1402</span> <span class="k">return</span> <span class="n">arr</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_npyio_impl.py:1024,</span> in <span class="ni">_read</span><span class="nt">(fname, delimiter, comment, quote, imaginary_unit, usecols, skiplines, max_rows, converters, ndmin, unpack, dtype, encoding)</span>
<span class="g g-Whitespace">   </span><span class="mi">1022</span>     <span class="n">fname</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">fspath</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1023</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
<span class="ne">-&gt; </span><span class="mi">1024</span>     <span class="n">fh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">lib</span><span class="o">.</span><span class="n">_datasource</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1025</span>     <span class="k">if</span> <span class="n">encoding</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">   </span><span class="mi">1026</span>         <span class="n">encoding</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">fh</span><span class="p">,</span> <span class="s1">&#39;encoding&#39;</span><span class="p">,</span> <span class="s1">&#39;latin1&#39;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_datasource.py:192,</span> in <span class="ni">open</span><span class="nt">(path, mode, destpath, encoding, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span><span class="sd"> Open `path` with `mode` and return the file object.</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span><span class="sd"> </span>
<span class="sd">   (...)    188 </span>
<span class="g g-Whitespace">    </span><span class="mi">189</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">191</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">(</span><span class="n">destpath</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">192</span> <span class="k">return</span> <span class="n">ds</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_datasource.py:526,</span> in <span class="ni">DataSource.open</span><span class="nt">(self, path, mode, encoding, newline)</span>
<span class="g g-Whitespace">    </span><span class="mi">524</span>     <span class="k">if</span> <span class="n">ext</span> <span class="o">==</span> <span class="s1">&#39;bz2&#39;</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">525</span>         <span class="n">mode</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">526</span>     <span class="k">return</span> <span class="n">_file_openers</span><span class="p">[</span><span class="n">ext</span><span class="p">](</span><span class="n">found</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">527</span>                               <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="n">newline</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">528</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">529</span>     <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">path</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;../../data/antoine_data.dat&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-equal-area-method-for-the-van-der-waals-equation">
<h2>The equal area method for the van der Waals equation<a class="headerlink" href="#the-equal-area-method-for-the-van-der-waals-equation" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/09/11/the-equal-area-method-for-the-van-der-waals-equation/">Matlab post</a></p>
<p>When a gas is below its Tc the van der Waal equation oscillates. In the portion of the isotherm where <span class="math notranslate nohighlight">\(\partial P_R/\partial V_r &gt; 0\)</span>, the isotherm fails to describe real materials, which phase separate into a liquid and gas in this region.</p>
<p>Maxwell proposed to replace this region by a flat line, where the area above and below the curves are equal. Today, we examine how to identify where that line should be.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">Tr</span> <span class="o">=</span> <span class="mf">0.9</span>  <span class="c1"># A Tr below Tc:  Tr = T/Tc</span>


<span class="c1"># analytical equation for Pr. This is the reduced form of the van der Waal</span>
<span class="c1"># equation.</span>
<span class="k">def</span><span class="w"> </span><span class="nf">Prfh</span><span class="p">(</span><span class="n">Vr</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">8.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="n">Tr</span> <span class="o">/</span> <span class="p">(</span><span class="n">Vr</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">3.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">Vr</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>


<span class="n">Vr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>  <span class="c1"># vector of reduced volume</span>
<span class="n">Pr</span> <span class="o">=</span> <span class="n">Prfh</span><span class="p">(</span><span class="n">Vr</span><span class="p">)</span>  <span class="c1"># vector of reduced pressure</span>

<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vr</span><span class="p">,</span> <span class="n">Pr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$V_R$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$P_R$&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8a3769753f3c45c067c242e30a61f2b9509eb0f54512bf23ecb8279fd78f1736.png" src="../_images/8a3769753f3c45c067c242e30a61f2b9509eb0f54512bf23ecb8279fd78f1736.png" />
</div>
</div>
<p>The idea is to pick a Pr and draw a line through the EOS. We want the areas between the line and EOS to be equal on each side of the middle intersection. Let us draw a line on the figure at y = 0.65.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y</span> <span class="o">=</span> <span class="mf">0.65</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span> <span class="s2">&quot;k--&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vr</span><span class="p">,</span> <span class="n">Pr</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$V_R$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$P_R$&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/5339260eedd9acc10816ca5ab8a3d2806102623f15b85ad70d1954c69da9f8d0.png" src="../_images/5339260eedd9acc10816ca5ab8a3d2806102623f15b85ad70d1954c69da9f8d0.png" />
</div>
</div>
<p>To find the areas, we need to know where the intersection of the vdW eqn with the horizontal line. This is the same as asking what are the roots of the vdW equation at that Pr. We need all three intersections so we can integrate from the first root to the middle root, and then the middle root to the third root. We take advantage of the polynomial nature of the vdW equation, which allows us to use the roots command to get all the roots at once. The polynomial is <span class="math notranslate nohighlight">\(V_R^3 - \frac{1}{3}(1+8 T_R/P_R) + 3/P_R - 1/P_R = 0\)</span>. We use the coefficients t0 get the roots like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vdWp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mf">3.0</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">Tr</span> <span class="o">/</span> <span class="n">y</span><span class="p">),</span> <span class="mf">3.0</span> <span class="o">/</span> <span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">y</span><span class="p">]</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">vdWp</span><span class="p">)</span>
<span class="n">v</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;bo&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.60286812 1.09743234 2.32534056]
</pre></div>
</div>
<img alt="../_images/3c7be5c09179455321367fe30625507d18d9649b1382f916eaa3f43b4d51ac47.png" src="../_images/3c7be5c09179455321367fe30625507d18d9649b1382f916eaa3f43b4d51ac47.png" />
</div>
</div>
<section id="compute-areas">
<h3>Compute areas<a class="headerlink" href="#compute-areas" title="Link to this heading">#</a></h3>
<p>for A1, we need the area under the line minus the area under the vdW curve. That is the area between the curves. For A2, we want the area under the vdW curve minus the area under the line. The area under the line between root 2 and root 1 is just the width (root2 - root1)*y</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">quad</span>

<span class="n">A1</span><span class="p">,</span> <span class="n">e1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">quad</span><span class="p">(</span><span class="n">Prfh</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">A2</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">Prfh</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">y</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">e1</span><span class="p">,</span> <span class="n">e2</span><span class="p">)</span>  <span class="c1"># interesting these look so large</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.06322594560601252 0.05802120981218639
0.3214667437645078 -0.7981403392675809
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>


<span class="k">def</span><span class="w"> </span><span class="nf">equal_area</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="n">Tr</span> <span class="o">=</span> <span class="mf">0.9</span>
    <span class="n">vdWp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">Tr</span> <span class="o">/</span> <span class="n">y</span><span class="p">),</span> <span class="mf">3.0</span> <span class="o">/</span> <span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">y</span><span class="p">]</span>
    <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">vdWp</span><span class="p">)</span>
    <span class="n">v</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">quad</span><span class="p">(</span><span class="n">Prfh</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">A2</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">Prfh</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">y</span>
    <span class="k">return</span> <span class="n">A1</span> <span class="o">-</span> <span class="n">A2</span>


<span class="p">(</span><span class="n">y_eq</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">equal_area</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_eq</span><span class="p">)</span>

<span class="n">Tr</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">vdWp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">Tr</span> <span class="o">/</span> <span class="n">y_eq</span><span class="p">),</span> <span class="mf">3.0</span> <span class="o">/</span> <span class="n">y_eq</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">y_eq</span><span class="p">]</span>
<span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">vdWp</span><span class="p">)</span>
<span class="n">v</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

<span class="n">A1</span><span class="p">,</span> <span class="n">e1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">y_eq</span> <span class="o">-</span> <span class="n">quad</span><span class="p">(</span><span class="n">Prfh</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">A2</span><span class="p">,</span> <span class="n">e2</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">Prfh</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">y_eq</span>

<span class="nb">print</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span> <span class="n">A2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">66</span><span class="p">],</span> <span class="n">line</span> <span class="mi">14</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">A2</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">Prfh</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">y</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span>     <span class="k">return</span> <span class="n">A1</span> <span class="o">-</span> <span class="n">A2</span>
<span class="ne">---&gt; </span><span class="mi">14</span> <span class="p">(</span><span class="n">y_eq</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">equal_area</span><span class="p">,</span> <span class="mf">0.65</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="nb">print</span><span class="p">(</span><span class="n">y_eq</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span> <span class="n">Tr</span> <span class="o">=</span> <span class="mf">0.9</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/scipy/optimize/_minpack_py.py:171,</span> in <span class="ni">fsolve</span><span class="nt">(func, x0, args, fprime, full_output, col_deriv, xtol, maxfev, band, epsfcn, factor, diag)</span>
<span class="g g-Whitespace">    </span><span class="mi">161</span> <span class="n">_wrapped_func</span><span class="o">.</span><span class="n">nfev</span> <span class="o">=</span> <span class="mi">0</span>
<span class="g g-Whitespace">    </span><span class="mi">163</span> <span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;col_deriv&#39;</span><span class="p">:</span> <span class="n">col_deriv</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">164</span>            <span class="s1">&#39;xtol&#39;</span><span class="p">:</span> <span class="n">xtol</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">165</span>            <span class="s1">&#39;maxfev&#39;</span><span class="p">:</span> <span class="n">maxfev</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>    <span class="mi">168</span>            <span class="s1">&#39;factor&#39;</span><span class="p">:</span> <span class="n">factor</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">169</span>            <span class="s1">&#39;diag&#39;</span><span class="p">:</span> <span class="n">diag</span><span class="p">}</span>
<span class="ne">--&gt; </span><span class="mi">171</span> <span class="n">res</span> <span class="o">=</span> <span class="n">_root_hybr</span><span class="p">(</span><span class="n">_wrapped_func</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">jac</span><span class="o">=</span><span class="n">fprime</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span> <span class="n">res</span><span class="o">.</span><span class="n">nfev</span> <span class="o">=</span> <span class="n">_wrapped_func</span><span class="o">.</span><span class="n">nfev</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span> <span class="k">if</span> <span class="n">full_output</span><span class="p">:</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/scipy/optimize/_minpack_py.py:239,</span> in <span class="ni">_root_hybr</span><span class="nt">(func, x0, args, jac, col_deriv, xtol, maxfev, band, eps, factor, diag, **unknown_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">237</span> <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
<span class="g g-Whitespace">    </span><span class="mi">238</span>     <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">args</span><span class="p">,)</span>
<span class="ne">--&gt; </span><span class="mi">239</span> <span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">_check_func</span><span class="p">(</span><span class="s1">&#39;fsolve&#39;</span><span class="p">,</span> <span class="s1">&#39;func&#39;</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">n</span><span class="p">,))</span>
<span class="g g-Whitespace">    </span><span class="mi">240</span> <span class="k">if</span> <span class="n">epsfcn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">241</span>     <span class="n">epsfcn</span> <span class="o">=</span> <span class="n">finfo</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/scipy/optimize/_minpack_py.py:24,</span> in <span class="ni">_check_func</span><span class="nt">(checker, argname, thefunc, x0, args, numinputs, output_shape)</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="k">def</span><span class="w"> </span><span class="nf">_check_func</span><span class="p">(</span><span class="n">checker</span><span class="p">,</span> <span class="n">argname</span><span class="p">,</span> <span class="n">thefunc</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">numinputs</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span>                 <span class="n">output_shape</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">24</span>     <span class="n">res</span> <span class="o">=</span> <span class="n">atleast_1d</span><span class="p">(</span><span class="n">thefunc</span><span class="p">(</span><span class="o">*</span><span class="p">((</span><span class="n">x0</span><span class="p">[:</span><span class="n">numinputs</span><span class="p">],)</span> <span class="o">+</span> <span class="n">args</span><span class="p">)))</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span>     <span class="k">if</span> <span class="p">(</span><span class="n">output_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">shape</span><span class="p">(</span><span class="n">res</span><span class="p">)</span> <span class="o">!=</span> <span class="n">output_shape</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span>         <span class="k">if</span> <span class="p">(</span><span class="n">output_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">):</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/scipy/optimize/_minpack_py.py:159,</span> in <span class="ni">fsolve.&lt;locals&gt;._wrapped_func</span><span class="nt">(*fargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">154</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">155</span><span class="sd"> Wrapped `func` to track the number of times</span>
<span class="g g-Whitespace">    </span><span class="mi">156</span><span class="sd"> the function has been called.</span>
<span class="g g-Whitespace">    </span><span class="mi">157</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">158</span> <span class="n">_wrapped_func</span><span class="o">.</span><span class="n">nfev</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="ne">--&gt; </span><span class="mi">159</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">fargs</span><span class="p">)</span>

<span class="nn">Cell In[66], line 7,</span> in <span class="ni">equal_area</span><span class="nt">(y)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">Tr</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">vdWp</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">+</span> <span class="mf">8.0</span> <span class="o">*</span> <span class="n">Tr</span> <span class="o">/</span> <span class="n">y</span><span class="p">),</span> <span class="mf">3.0</span> <span class="o">/</span> <span class="n">y</span><span class="p">,</span> <span class="o">-</span><span class="mf">1.0</span> <span class="o">/</span> <span class="n">y</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roots</span><span class="p">(</span><span class="n">vdWp</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">v</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">A1</span> <span class="o">=</span> <span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">y</span> <span class="o">-</span> <span class="n">quad</span><span class="p">(</span><span class="n">Prfh</span><span class="p">,</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/lib/_polynomial_impl.py:228,</span> in <span class="ni">roots</span><span class="nt">(p)</span>
<span class="g g-Whitespace">    </span><span class="mi">172</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">173</span><span class="sd"> Return the roots of a polynomial with coefficients given in p.</span>
<span class="g g-Whitespace">    </span><span class="mi">174</span><span class="sd"> </span>
<span class="sd">   (...)    225 </span>
<span class="g g-Whitespace">    </span><span class="mi">226</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">227</span> <span class="c1"># If input is scalar, this makes it an array</span>
<span class="ne">--&gt; </span><span class="mi">228</span> <span class="n">p</span> <span class="o">=</span> <span class="n">atleast_1d</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">229</span> <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">ndim</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">230</span>     <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Input must be a rank-1 array.&quot;</span><span class="p">)</span>

<span class="nn">File /opt/hostedtoolcache/Python/3.11.13/x64/lib/python3.11/site-packages/numpy/_core/shape_base.py:63,</span> in <span class="ni">atleast_1d</span><span class="nt">(*arys)</span>
<span class="g g-Whitespace">     </span><span class="mi">23</span><span class="w"> </span><span class="sd">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">24</span><span class="sd"> Convert inputs to arrays with at least one dimension.</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span><span class="sd"> </span>
<span class="sd">   (...)     60 </span>
<span class="g g-Whitespace">     </span><span class="mi">61</span><span class="sd"> &quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">62</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">arys</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">63</span>     <span class="n">result</span> <span class="o">=</span> <span class="n">asanyarray</span><span class="p">(</span><span class="n">arys</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">64</span>     <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">65</span>         <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="ne">ValueError</span>: setting an array element with a sequence. The requested array has an inhomogeneous shape after 1 dimensions. The detected shape was (4,) + inhomogeneous part.
</pre></div>
</div>
</div>
</div>
<p>Now let us plot the equal areas and indicate them by shading.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gcf</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vr</span><span class="p">,</span> <span class="n">Pr</span><span class="p">)</span>

<span class="n">hline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Vr</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_eq</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vr</span><span class="p">,</span> <span class="n">hline</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">Vr</span><span class="p">,</span> <span class="n">hline</span><span class="p">,</span> <span class="n">Pr</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">Vr</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Vr</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">Vr</span><span class="p">,</span> <span class="n">hline</span><span class="p">,</span> <span class="n">Pr</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">Vr</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Vr</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;A1 = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;A2 = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">A2</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$V_R$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$P_R$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;$T_R$ = 0.9&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">67</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vr</span><span class="p">,</span> <span class="n">Pr</span><span class="p">)</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">hline</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">Vr</span><span class="o">.</span><span class="n">size</span><span class="p">)</span> <span class="o">*</span> <span class="n">y_eq</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Vr</span><span class="p">,</span> <span class="n">hline</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">Vr</span><span class="p">,</span> <span class="n">hline</span><span class="p">,</span> <span class="n">Pr</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">Vr</span> <span class="o">&gt;=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">Vr</span> <span class="o">&lt;=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;y_eq&#39; is not defined
</pre></div>
</div>
<img alt="../_images/236195889cf1bfd090430d34ac09b45d8eaf6c7a4212a805e3ee98f672405582.png" src="../_images/236195889cf1bfd090430d34ac09b45d8eaf6c7a4212a805e3ee98f672405582.png" />
</div>
</div>
</section>
</section>
<section id="time-dependent-concentration-in-a-first-order-reversible-reaction-in-a-batch-reactor">
<h2>Time dependent concentration in a first order reversible reaction in a batch reactor<a class="headerlink" href="#time-dependent-concentration-in-a-first-order-reversible-reaction-in-a-batch-reactor" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/08/07/first-order-reversible-reaction-in-batch-reactor/">Matlab post</a></p>
<p>Given this reaction <span class="math notranslate nohighlight">\(A \rightleftharpoons B\)</span>, with these rate laws:</p>
<p>forward rate law: <span class="math notranslate nohighlight">\(-r_a = k_1 C_A\)</span></p>
<p>backward rate law: <span class="math notranslate nohighlight">\(-r_b = k_{-1} C_B\)</span></p>
<p>plot the concentration of A vs. time. This example illustrates a set of coupled first order ODES.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>


<span class="k">def</span><span class="w"> </span><span class="nf">myode</span><span class="p">(</span><span class="n">C</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="c1"># ra = -k1*Ca</span>
    <span class="c1"># rb = -k_1*Cb</span>
    <span class="c1"># net rate for production of A:  ra - rb</span>
    <span class="c1"># net rate for production of B: -ra + rb</span>

    <span class="n">k1</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># 1/min;</span>
    <span class="n">k_1</span> <span class="o">=</span> <span class="mf">0.5</span>  <span class="c1"># 1/min;</span>

    <span class="n">Ca</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">Cb</span> <span class="o">=</span> <span class="n">C</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">ra</span> <span class="o">=</span> <span class="o">-</span><span class="n">k1</span> <span class="o">*</span> <span class="n">Ca</span>
    <span class="n">rb</span> <span class="o">=</span> <span class="o">-</span><span class="n">k_1</span> <span class="o">*</span> <span class="n">Cb</span>

    <span class="n">dCadt</span> <span class="o">=</span> <span class="n">ra</span> <span class="o">-</span> <span class="n">rb</span>
    <span class="n">dCbdt</span> <span class="o">=</span> <span class="o">-</span><span class="n">ra</span> <span class="o">+</span> <span class="n">rb</span>

    <span class="n">dCdt</span> <span class="o">=</span> <span class="p">[</span><span class="n">dCadt</span><span class="p">,</span> <span class="n">dCbdt</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">dCdt</span>


<span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>

<span class="n">init</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>  <span class="c1"># mol/L</span>
<span class="n">C</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">myode</span><span class="p">,</span> <span class="n">init</span><span class="p">,</span> <span class="n">tspan</span><span class="p">)</span>

<span class="n">Ca</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">Cb</span> <span class="o">=</span> <span class="n">C</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">Ca</span><span class="p">,</span> <span class="n">tspan</span><span class="p">,</span> <span class="n">Cb</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (min)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;C (mol/L)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s2">&quot;$C_A$&quot;</span><span class="p">,</span> <span class="s2">&quot;$C_B$&quot;</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/8fc37b1d6cacca1baa155c0aaadacffaf271396f98003ed935f895e395aaa0a5.png" src="../_images/8fc37b1d6cacca1baa155c0aaadacffaf271396f98003ed935f895e395aaa0a5.png" />
</div>
</div>
<p>That is it. The main difference between this and Matlab is the order of arguments in odeint is different, and the ode function has differently ordered arguments.</p>
</section>
<section id="finding-equilibrium-conversion">
<h2>Finding equilibrium conversion<a class="headerlink" href="#finding-equilibrium-conversion" title="Link to this heading">#</a></h2>
<p>A common problem to solve in reaction engineering is finding the equilibrium conversion. A typical problem to solve is the following nonlinear equation:</p>
<p><span class="math notranslate nohighlight">\(1.44 = \frac{X_e^2}{(1-X_e)^2}\)</span></p>
<p>To solve this we create a function:</p>
<p><span class="math notranslate nohighlight">\(f(X_e)=0=1.44 - \frac{X_e^2}{(1-X_e)^2}\)</span></p>
<p>and use a nonlinear solver to find the value of <span class="math notranslate nohighlight">\(X_e\)</span> that makes this function equal to zero. We have to provide an initial guess. Chemical intuition suggests that the solution must be between 0 and 1, and mathematical intuition suggests the solution might be near 0.5 (which would give a ratio near 1).</p>
<p>Here is our solution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>


<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">Xe</span><span class="p">):</span>
    <span class="n">z</span> <span class="o">=</span> <span class="mf">1.44</span> <span class="o">-</span> <span class="p">(</span><span class="n">Xe</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">Xe</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="n">z</span>


<span class="n">X0</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="p">(</span><span class="n">Xe</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">X0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The equilibrium conversion is X = </span><span class="si">{0:1.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Xe</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The equilibrium conversion is X = 0.55
</pre></div>
</div>
</div>
</div>
<p>See Fogler, 4th ed. page 1025 for the setup of this equation.</p>
</section>
<section id="integrating-a-batch-reactor-design-equation">
<h2>Integrating a batch reactor design equation<a class="headerlink" href="#integrating-a-batch-reactor-design-equation" title="Link to this heading">#</a></h2>
<p>For a constant volume batch reactor where <span class="math notranslate nohighlight">\(A \rightarrow B\)</span> at a rate of <span class="math notranslate nohighlight">\(-r_A = k C_A^2\)</span>, we derive the following design equation for the length of time required to achieve a particular level of conversion :</p>
<p><span class="math notranslate nohighlight">\(t(X) = \frac{1}{k C_{A0}} \int_{X=0}^X \frac{dX}{(1-X)^2}\)</span></p>
<p>if <span class="math notranslate nohighlight">\(k = 10^{-3}\)</span> L/mol/s and <span class="math notranslate nohighlight">\(C_{A0}\)</span> = 1 mol/L, estimate the time to achieve 90% conversion.</p>
<p>We could analytically solve the integral and evaluate it, but instead we will numerically evaluate it using scipy.integrate.quad. This function returns two values: the evaluated integral, and an estimate of the absolute error in the answer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">quad</span>


<span class="k">def</span><span class="w"> </span><span class="nf">integrand</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
    <span class="n">k</span> <span class="o">=</span> <span class="mf">1.0e-3</span>
    <span class="n">Ca0</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># mol/L</span>
    <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">Ca0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">X</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>


<span class="n">sol</span><span class="p">,</span> <span class="n">abserr</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;t = </span><span class="si">{0}</span><span class="s2"> seconds (</span><span class="si">{1}</span><span class="s2"> hours)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">sol</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Estimated absolute error = </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">abserr</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>t = 9000.000000000007 seconds (2.500000000000002 hours)
Estimated absolute error = 2.1220327407235617e-07
</pre></div>
</div>
</div>
</div>
<p>You can see the estimate error is very small compared to the solution.</p>
</section>
<section id="uncertainty-in-an-integral-equation">
<h2>Uncertainty in an integral equation<a class="headerlink" href="#uncertainty-in-an-integral-equation" title="Link to this heading">#</a></h2>
<p>In a <a class="reference external" href="http://jkitchin.github.io/blog/2013/01/06/Integrating-a-batch-reactor-design-equation/">previous example</a>, we solved for the time to reach a specific conversion in a batch reactor. However, it is likely there is uncertainty in the rate constant, and possibly in the initial concentration. Here we examine the effects of that uncertainty on the time to reach the desired conversion.</p>
<p>To do this we have to write a function that takes arguments with uncertainty, and wrap the function with the uncertainties.wrap decorator. The function must return a single float number (current limitation of the uncertainties package). Then, we simply call the function, and the uncertainties from the inputs will be automatically propagated to the outputs. Let us say there is about 10% uncertainty in the rate constant, and 1% uncertainty in the initial concentration.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">quad</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uncertainties</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>

<span class="n">k</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="mf">1.0e-3</span><span class="p">,</span> <span class="mf">1.0e-4</span><span class="p">)</span>
<span class="n">Ca0</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># mol/L</span>


<span class="nd">@u</span><span class="o">.</span><span class="n">wrap</span>
<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Ca0</span><span class="p">):</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">integrand</span><span class="p">(</span><span class="n">X</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="n">k</span> <span class="o">*</span> <span class="n">Ca0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">X</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">integral</span><span class="p">,</span> <span class="n">abserr</span> <span class="o">=</span> <span class="n">quad</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">integral</span>


<span class="n">sol</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">Ca0</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;t = </span><span class="si">{0}</span><span class="s2"> seconds (</span><span class="si">{1}</span><span class="s2"> hours)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sol</span><span class="p">,</span> <span class="n">sol</span> <span class="o">/</span> <span class="mi">3600</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">71</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">quad</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span><span class="w"> </span><span class="nn">uncertainties</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">u</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">k</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="mf">1.0e-3</span><span class="p">,</span> <span class="mf">1.0e-4</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">Ca0</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">ufloat</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># mol/L</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;uncertainties&#39;
</pre></div>
</div>
</div>
</div>
<p>The result shows about a 10% uncertainty in the time, which is similar to the largest uncertainty in the inputs.  This information should certainly be used in making decisions about how long to actually run the reactor to be sure of reaching the goal. For example, in this case, running the reactor for 3 hours (that is roughly + 2σ) would ensure at a high level of confidence (approximately 95% confidence) that you reach at least 90% conversion.</p>
</section>
<section id="integrating-the-batch-reactor-mole-balance">
<h2>Integrating the batch reactor mole balance<a class="headerlink" href="#integrating-the-batch-reactor-mole-balance" title="Link to this heading">#</a></h2>
<p>An alternative approach of evaluating an integral is to integrate a differential equation. For the batch reactor, the differential equation that describes conversion as a function of time is:</p>
<p><span class="math notranslate nohighlight">\(\frac{dX}{dt} = -r_A V/N_{A0}\)</span>.</p>
<p>Given a value of initial concentration, or volume and initial number of moles of A, we can integrate this ODE to find the conversion at some later time. We assume that <span class="math notranslate nohighlight">\(X(t=0)=0\)</span>. We will integrate the ODE over a time span of 0 to 10,000 seconds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">k</span> <span class="o">=</span> <span class="mf">1.0e-3</span>
<span class="n">Ca0</span> <span class="o">=</span> <span class="mf">1.0</span>  <span class="c1"># mol/L</span>


<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">ra</span> <span class="o">=</span> <span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ca0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">X</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="k">return</span> <span class="o">-</span><span class="n">ra</span> <span class="o">/</span> <span class="n">Ca0</span>


<span class="n">X0</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">tspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>

<span class="n">sol</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">X0</span><span class="p">,</span> <span class="n">tspan</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tspan</span><span class="p">,</span> <span class="n">sol</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (sec)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Conversion&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/f39c49caa8cc708985dddb2b2c14c921df835e356cd1ee264b56310e65ff47ac.png" src="../_images/f39c49caa8cc708985dddb2b2c14c921df835e356cd1ee264b56310e65ff47ac.png" />
</div>
</div>
<p>You can read off of this figure to find the time required to achieve a particular conversion.</p>
</section>
<section id="plug-flow-reactor-with-a-pressure-drop">
<h2>Plug flow reactor with a pressure drop<a class="headerlink" href="#plug-flow-reactor-with-a-pressure-drop" title="Link to this heading">#</a></h2>
<p>If there is a pressure drop in a plug flow reactor,  there are two equations needed to determine the exit conversion: one for the conversion, and one from the pressure drop.</p>
<p>\begin{eqnarray}
\frac{dX}{dW} &amp;=&amp; \frac{k’}{F_A0} \left ( \frac{1-X}{1 + \epsilon X} \right) y\
\frac{dX}{dy} &amp;=&amp; -\frac{\alpha (1 + \epsilon X)}{2y}
\end{eqnarray}</p>
<p>Here is how to integrate these equations numerically in python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.integrate</span><span class="w"> </span><span class="kn">import</span> <span class="n">odeint</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">kprime</span> <span class="o">=</span> <span class="mf">0.0266</span>
<span class="n">Fa0</span> <span class="o">=</span> <span class="mf">1.08</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.0166</span>
<span class="n">epsilon</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.15</span>


<span class="k">def</span><span class="w"> </span><span class="nf">dFdW</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">W</span><span class="p">):</span>
    <span class="s2">&quot;set of ODEs to integrate&quot;</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">F</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">dXdW</span> <span class="o">=</span> <span class="n">kprime</span> <span class="o">/</span> <span class="n">Fa0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span> <span class="o">*</span> <span class="n">y</span>
    <span class="n">dydW</span> <span class="o">=</span> <span class="o">-</span><span class="n">alpha</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">X</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">dXdW</span><span class="p">,</span> <span class="n">dydW</span><span class="p">]</span>


<span class="n">Wspan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">60</span><span class="p">)</span>
<span class="n">X0</span> <span class="o">=</span> <span class="mf">0.0</span>
<span class="n">y0</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">F0</span> <span class="o">=</span> <span class="p">[</span><span class="n">X0</span><span class="p">,</span> <span class="n">y0</span><span class="p">]</span>
<span class="n">sol</span> <span class="o">=</span> <span class="n">odeint</span><span class="p">(</span><span class="n">dFdW</span><span class="p">,</span> <span class="n">F0</span><span class="p">,</span> <span class="n">Wspan</span><span class="p">)</span>

<span class="c1"># now plot the results</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Wspan</span><span class="p">,</span> <span class="n">sol</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Conversion&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Wspan</span><span class="p">,</span> <span class="n">sol</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;g--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;y=$P/P_0$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;best&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Catalyst weight (lb_m)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/a56ec93e8783a9c37d857ce94fa916ee1724db93a8dbd27b1b9cfd3abfac9243.png" src="../_images/a56ec93e8783a9c37d857ce94fa916ee1724db93a8dbd27b1b9cfd3abfac9243.png" />
</div>
</div>
<p>See Fogler, 4th edition. page 193.</p>
</section>
<section id="solving-cstr-design-equations">
<h2>Solving CSTR design equations<a class="headerlink" href="#solving-cstr-design-equations" title="Link to this heading">#</a></h2>
<p>Given a continuously stirred tank reactor with a volume of 66,000 dm^3 where the reaction <span class="math notranslate nohighlight">\(A \rightarrow B\)</span> occurs, at a rate of <span class="math notranslate nohighlight">\(-r_A = k C_A^2\)</span> (<span class="math notranslate nohighlight">\(k=3\)</span> L/mol/h), with an entering molar flow of F<sub>A0</sub> = 5 mol/h and a volumetric flowrate of 10 L/h, what is the exit concentration of A?</p>
<p>From a mole balance we know that at steady state <span class="math notranslate nohighlight">\(0 = F_{A0} - F_A + V r_A\)</span>. That equation simply states the sum of the molar flow of A in in minus the molar flow of A out  plus the molar rate A is generated is equal to zero at steady state. This is directly the equation we need to solve. We need the following relationship:</p>
<ol class="arabic simple">
<li><p><span class="math notranslate nohighlight">\(F_A = v0 C_A\)</span></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">fsolve</span>

<span class="n">Fa0</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="n">v0</span> <span class="o">=</span> <span class="mf">10.0</span>

<span class="n">V</span> <span class="o">=</span> <span class="mf">66000.0</span>  <span class="c1"># reactor volume L^3</span>
<span class="n">k</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># rate constant L/mol/h</span>


<span class="k">def</span><span class="w"> </span><span class="nf">func</span><span class="p">(</span><span class="n">Ca</span><span class="p">):</span>
    <span class="s2">&quot;Mole balance for a CSTR. Solve this equation for func(Ca)=0&quot;</span>
    <span class="n">Fa</span> <span class="o">=</span> <span class="n">v0</span> <span class="o">*</span> <span class="n">Ca</span>  <span class="c1"># exit molar flow of A</span>
    <span class="n">ra</span> <span class="o">=</span> <span class="o">-</span><span class="n">k</span> <span class="o">*</span> <span class="n">Ca</span><span class="o">**</span><span class="mi">2</span>  <span class="c1"># rate of reaction of A L/mol/h</span>
    <span class="k">return</span> <span class="n">Fa0</span> <span class="o">-</span> <span class="n">Fa</span> <span class="o">+</span> <span class="n">V</span> <span class="o">*</span> <span class="n">ra</span>


<span class="c1"># CA guess that that 90 % is reacted away</span>
<span class="n">CA_guess</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="o">*</span> <span class="n">Fa0</span> <span class="o">/</span> <span class="n">v0</span>
<span class="p">(</span><span class="n">CA_sol</span><span class="p">,)</span> <span class="o">=</span> <span class="n">fsolve</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="n">CA_guess</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The exit concentration is </span><span class="si">{0}</span><span class="s2"> mol/L&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">CA_sol</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The exit concentration is 0.005 mol/L
</pre></div>
</div>
</div>
</div>
<p>It is a little confusing why it is necessary to put a comma after the CA_sol in the fsolve command. If you do not put it there, you get brackets around the answer.</p>
</section>
<section id="meet-the-steam-tables">
<h2>Meet the steam tables<a class="headerlink" href="#meet-the-steam-tables" title="Link to this heading">#</a></h2>
<p><a class="reference external" href="http://matlab.cheme.cmu.edu/2011/10/31/matlab-meets-the-steam-tables/">Matlab post</a></p>
<p>We will use the <a class="reference external" href="https://pypi.python.org/pypi/iapws">iapws</a> module. Install it like this:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>pip install iapws
</pre></div>
</div>
<p>Problem statement: A Rankine cycle operates using steam with the condenser at 100 degC, a pressure of 3.0 MPa and temperature of 600 degC in the boiler. Assuming the compressor and turbine operate reversibly, estimate the efficiency of the cycle.</p>
<p>Starting point in the Rankine cycle in condenser.</p>
<p>we have saturated liquid here, and we get the thermodynamic properties for the given temperature. In this python module, these properties are all in attributes of an IAPWS object created at a set of conditions.</p>
<section id="starting-point-in-the-rankine-cycle-in-condenser">
<h3>Starting point in the Rankine cycle in condenser.<a class="headerlink" href="#starting-point-in-the-rankine-cycle-in-condenser" title="Link to this heading">#</a></h3>
<p>We have saturated liquid here, and we get the thermodynamic properties for the given temperature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">iapws</span><span class="w"> </span><span class="kn">import</span> <span class="n">IAPWS97</span>

<span class="n">T1</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># in K</span>

<span class="n">sat_liquid1</span> <span class="o">=</span> <span class="n">IAPWS97</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">T1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># x is the steam quality. 0 = liquid</span>

<span class="n">P1</span> <span class="o">=</span> <span class="n">sat_liquid1</span><span class="o">.</span><span class="n">P</span>
<span class="n">s1</span> <span class="o">=</span> <span class="n">sat_liquid1</span><span class="o">.</span><span class="n">s</span>
<span class="n">h1</span> <span class="o">=</span> <span class="n">sat_liquid1</span><span class="o">.</span><span class="n">h</span>
<span class="n">v1</span> <span class="o">=</span> <span class="n">sat_liquid1</span><span class="o">.</span><span class="n">v</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">75</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="kn">from</span><span class="w"> </span><span class="nn">iapws</span><span class="w"> </span><span class="kn">import</span> <span class="n">IAPWS97</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">T1</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># in K</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">sat_liquid1</span> <span class="o">=</span> <span class="n">IAPWS97</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">T1</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># x is the steam quality. 0 = liquid</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;iapws&#39;
</pre></div>
</div>
</div>
</div>
</section>
<section id="isentropic-compression-of-liquid-to-point-2">
<h3>Isentropic compression of liquid to point 2<a class="headerlink" href="#isentropic-compression-of-liquid-to-point-2" title="Link to this heading">#</a></h3>
<p>The final pressure is given, and we need to compute the new temperatures, and enthalpy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P2</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># MPa</span>
<span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span>  <span class="c1"># this is what isentropic means</span>

<span class="n">sat_liquid2</span> <span class="o">=</span> <span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">P2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s1</span><span class="p">)</span>
<span class="n">T2</span> <span class="o">=</span> <span class="n">sat_liquid2</span><span class="o">.</span><span class="n">T</span>
<span class="n">h2</span> <span class="o">=</span> <span class="n">sat_liquid2</span><span class="o">.</span><span class="n">h</span>

<span class="c1"># work done to compress liquid. This is an approximation, since the</span>
<span class="c1"># volume does change a little with pressure, but the overall work here</span>
<span class="c1"># is pretty small so we neglect the volume change.</span>
<span class="n">WdotP</span> <span class="o">=</span> <span class="n">v1</span> <span class="o">*</span> <span class="p">(</span><span class="n">P2</span> <span class="o">-</span> <span class="n">P1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The compressor work is: </span><span class="si">{0:1.4f}</span><span class="s2"> kJ/kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">WdotP</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">76</span><span class="p">],</span> <span class="n">line</span> <span class="mi">2</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">P2</span> <span class="o">=</span> <span class="mf">3.0</span>  <span class="c1"># MPa</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="n">s2</span> <span class="o">=</span> <span class="n">s1</span>  <span class="c1"># this is what isentropic means</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">sat_liquid2</span> <span class="o">=</span> <span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">P2</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s1</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">T2</span> <span class="o">=</span> <span class="n">sat_liquid2</span><span class="o">.</span><span class="n">T</span>

<span class="ne">NameError</span>: name &#39;s1&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>The compression work is almost negligible. This number is 1000 times smaller than we computed with Xsteam. I wonder what the units of v1 actually are.</p>
</section>
<section id="isobaric-heating-to-t3-in-boiler-where-we-make-steam">
<h3>Isobaric heating to T3 in boiler where we make steam<a class="headerlink" href="#isobaric-heating-to-t3-in-boiler-where-we-make-steam" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T3</span> <span class="o">=</span> <span class="mi">600</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># K</span>
<span class="n">P3</span> <span class="o">=</span> <span class="n">P2</span>  <span class="c1"># definition of isobaric</span>
<span class="n">steam</span> <span class="o">=</span> <span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">P3</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T3</span><span class="p">)</span>

<span class="n">h3</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">h</span>
<span class="n">s3</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">s</span>

<span class="n">Qb</span> <span class="o">=</span> <span class="n">h3</span> <span class="o">-</span> <span class="n">h2</span>  <span class="c1"># heat required to make the steam</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The boiler heat duty is: </span><span class="si">{0:1.2f}</span><span class="s2"> kJ/kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Qb</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">77</span><span class="p">],</span> <span class="n">line</span> <span class="mi">3</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">T3</span> <span class="o">=</span> <span class="mi">600</span> <span class="o">+</span> <span class="mf">273.15</span>  <span class="c1"># K</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">P3</span> <span class="o">=</span> <span class="n">P2</span>  <span class="c1"># definition of isobaric</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">steam</span> <span class="o">=</span> <span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">P3</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T3</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">h3</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">h</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">s3</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">s</span>

<span class="ne">NameError</span>: name &#39;IAPWS97&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="isentropic-expansion-through-turbine-to-point-4">
<h3>Isentropic expansion through turbine to point 4<a class="headerlink" href="#isentropic-expansion-through-turbine-to-point-4" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">steam</span> <span class="o">=</span> <span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s3</span><span class="p">)</span>
<span class="n">T4</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">T</span>
<span class="n">h4</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">h</span>
<span class="n">s4</span> <span class="o">=</span> <span class="n">s3</span>  <span class="c1"># isentropic</span>
<span class="n">Qc</span> <span class="o">=</span> <span class="n">h4</span> <span class="o">-</span> <span class="n">h1</span>  <span class="c1"># work required to cool from T4 to T1</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The condenser heat duty is </span><span class="si">{0:1.2f}</span><span class="s2"> kJ/kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Qc</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">78</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">steam</span> <span class="o">=</span> <span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="n">s3</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">T4</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">T</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="n">h4</span> <span class="o">=</span> <span class="n">steam</span><span class="o">.</span><span class="n">h</span>

<span class="ne">NameError</span>: name &#39;IAPWS97&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="to-get-from-point-4-to-point-1">
<h3>To get from point 4 to point 1<a class="headerlink" href="#to-get-from-point-4-to-point-1" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">WdotTurbine</span> <span class="o">=</span> <span class="n">h4</span> <span class="o">-</span> <span class="n">h3</span>  <span class="c1"># work extracted from the expansion</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The turbine work is: </span><span class="si">{0:1.2f}</span><span class="s2"> kJ/kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">WdotTurbine</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">79</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">WdotTurbine</span> <span class="o">=</span> <span class="n">h4</span> <span class="o">-</span> <span class="n">h3</span>  <span class="c1"># work extracted from the expansion</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The turbine work is: </span><span class="si">{0:1.2f}</span><span class="s2"> kJ/kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">WdotTurbine</span><span class="p">))</span>

<span class="ne">NameError</span>: name &#39;h4&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="efficiency">
<h3>Efficiency<a class="headerlink" href="#efficiency" title="Link to this heading">#</a></h3>
<p>This is a ratio of the work put in to make the steam, and the net work obtained from the turbine. The answer here agrees with the efficiency calculated in Sandler on page 135.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eta</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">WdotTurbine</span> <span class="o">-</span> <span class="n">WdotP</span><span class="p">)</span> <span class="o">/</span> <span class="n">Qb</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The overall efficiency is </span><span class="si">{0:1.2%}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">eta</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">WdotTurbine</span> <span class="o">-</span> <span class="n">WdotP</span><span class="p">)</span> <span class="o">/</span> <span class="n">Qb</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The overall efficiency is </span><span class="si">{0:1.2%}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span>

<span class="ne">NameError</span>: name &#39;WdotTurbine&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="entropy-temperature-chart">
<h3>Entropy-temperature chart<a class="headerlink" href="#entropy-temperature-chart" title="Link to this heading">#</a></h3>
<p>The IAPWS module makes it pretty easy to generate figures of the steam tables. Here we generate an entropy-Temperature graph. We do this to illustrate the path of the Rankine cycle. We need to compute the values of steam entropy for a range of pressures and temperatures.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">372</span> <span class="o">+</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># range of temperatures</span>
<span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]:</span>  <span class="c1"># MPa</span>
    <span class="n">steam</span> <span class="o">=</span> <span class="p">[</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">T</span><span class="p">]</span>
    <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">steam</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;k-&quot;</span><span class="p">)</span>

<span class="c1"># saturated vapor and liquid entropy lines</span>
<span class="n">svap</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">T</span><span class="p">]]</span>
<span class="n">sliq</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">T</span><span class="p">]]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">svap</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sliq</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Entropy (kJ/(kg K)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Temperature (K)&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">81</span><span class="p">],</span> <span class="n">line</span> <span class="mi">8</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">372</span> <span class="o">+</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># range of temperatures</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]:</span>  <span class="c1"># MPa</span>
<span class="ne">----&gt; </span><span class="mi">8</span>     <span class="n">steam</span> <span class="o">=</span> <span class="p">[</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">T</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">steam</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;k-&quot;</span><span class="p">)</span>

<span class="nn">Cell In[81], line 8,</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">372</span> <span class="o">+</span> <span class="mi">273</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># range of temperatures</span>
<span class="g g-Whitespace">      </span><span class="mi">7</span> <span class="k">for</span> <span class="n">P</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">]:</span>  <span class="c1"># MPa</span>
<span class="ne">----&gt; </span><span class="mi">8</span>     <span class="n">steam</span> <span class="o">=</span> <span class="p">[</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="n">P</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">T</span><span class="p">]</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span>     <span class="n">S</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">steam</span><span class="p">]</span>
<span class="g g-Whitespace">     </span><span class="mi">10</span>     <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;k-&quot;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;IAPWS97&#39; is not defined
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 640x480 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<p>We can plot our Rankine cycle path like this. We compute the entropies along the non-isentropic paths.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T23</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">)</span>
<span class="n">S23</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">P2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">T23</span><span class="p">]]</span>

<span class="n">T41</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T4</span><span class="p">,</span> <span class="n">T1</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># subtract a tiny bit to make sure we get a liquid</span>
<span class="n">S41</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">P1</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">T41</span><span class="p">]]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">82</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">T23</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T2</span><span class="p">,</span> <span class="n">T3</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">S23</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">s</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="p">[</span><span class="n">IAPWS97</span><span class="p">(</span><span class="n">P</span><span class="o">=</span><span class="n">P2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">T23</span><span class="p">]]</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">T41</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T4</span><span class="p">,</span> <span class="n">T1</span> <span class="o">-</span> <span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># subtract a tiny bit to make sure we get a liquid</span>

<span class="ne">NameError</span>: name &#39;T2&#39; is not defined
</pre></div>
</div>
</div>
</div>
<p>And then we plot the paths.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">svap</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sliq</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">],</span> <span class="p">[</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">],</span> <span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Path 1 to 2</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S23</span><span class="p">,</span> <span class="n">T23</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># path from 2 to 3 is isobaric</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s3</span><span class="p">,</span> <span class="n">s4</span><span class="p">],</span> <span class="p">[</span><span class="n">T3</span><span class="p">,</span> <span class="n">T4</span><span class="p">],</span> <span class="s2">&quot;g-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># path from 3 to 4 is isentropic</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">S41</span><span class="p">,</span> <span class="n">T41</span><span class="p">,</span> <span class="s2">&quot;k-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">);</span>  <span class="c1"># and from 4 to 1 is isobaric</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">83</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">svap</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;r-&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sliq</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="s2">&quot;b-&quot;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">],</span> <span class="p">[</span><span class="n">T1</span><span class="p">,</span> <span class="n">T2</span><span class="p">],</span> <span class="s2">&quot;r-&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>  <span class="c1"># Path 1 to 2</span>

<span class="ne">NameError</span>: name &#39;svap&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
<section id="id5">
<h3>Summary<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>This was an interesting exercise. On one hand, the tedium of interpolating the steam tables is gone. On the other hand, you still have to know exactly what to ask for to get an answer that is correct. The iapws interface is a little clunky, and takes some getting used to. It does not seem as robust as the Xsteam module I used in Matlab.</p>
</section>
</section>
<section id="what-region-is-a-point-in">
<h2>What region is a point in<a class="headerlink" href="#what-region-is-a-point-in" title="Link to this heading">#</a></h2>
<p>Suppose we have a space that is divided by a boundary into two regions, and we want to know if an arbitrary point is on one region or the other. One way to figure this out is to pick a point that is known to be in a region, and then draw a line to the arbitrary point counting the number of times it crosses the boundary. If the line crosses an even number of times, then the point is in the same region and if it crosses an odd number of times, then the point is in the other region.</p>
<p>Here is the boundary and region we consider in this example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">boundary</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.556</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.91</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>
<span class="p">]</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">boundary</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">boundary</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/b9bbf933dfafbe5992e7ee74cb004d02f05f964bed363540102a9019e9c6b92d.png" src="../_images/b9bbf933dfafbe5992e7ee74cb004d02f05f964bed363540102a9019e9c6b92d.png" />
</div>
</div>
<p>In this example, the boundary is complicated, and not described by a simple function. We will check for intersections of the line from the arbitrary point to the reference point with each segment defining the boundary. If there is an intersection in the boundary, we count that as a crossing. We choose the origin (0, 0) in this case for the reference point. For an arbitrary point (x1, y1), the equation of the line is therefore (provided x1 !=0):</p>
<p><span class="math notranslate nohighlight">\(y = \frac{y1}{x1} x\)</span>.</p>
<p>Let the points defining a boundary segment be (bx1, by1) and (bx2, by2). The equation for the line connecting these points (provided bx1 != bx2) is:</p>
<p><span class="math notranslate nohighlight">\(y = by1 + \frac{by2 - by1}{bx2 - bx1}(x - bx1)\)</span></p>
<p>Setting these two equations equal to each other, we can solve for the value of <span class="math notranslate nohighlight">\(x\)</span>, and if <span class="math notranslate nohighlight">\(bx1 &lt;= x &lt;= bx2\)</span> then we would say there is an intersection with that segment. The solution for x is:</p>
<p><span class="math notranslate nohighlight">\(x = \frac{m bx1 - by1}{m - y1/x1}\)</span></p>
<p>This can only fail if <span class="math notranslate nohighlight">\(m = y1/x1\)</span> which means the segments are parallel and either do not intersect or go through each other. One issue we have to resolve is what to do when the intersection is at the boundary. In that case, we would see an intersection with two segments since bx1 of one segment is also bx2 of another segment. We resolve the issue by only counting intersections with bx1. Finally, there may be intersections at values of <span class="math notranslate nohighlight">\(x\)</span> greater than the point, and we are not interested in those because the intersections are not between the point and reference point.</p>
<p>We will have to do float comparisons, so we will define <a class="reference internal" href="#./math.md"><span class="xref myst">tolerance functions</span></a> for all of these. I tried this previously with regular comparison operators, and there were many cases that did not work because of float comparisons. In the code that follows, we define the tolerance functions, the function that handles almost all the special cases, and show that it almost always correctly identifies the region a point is in.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">TOLERANCE</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">spacing</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">feq</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">TOLERANCE</span><span class="p">):</span>
    <span class="s2">&quot;x == y&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="p">((</span><span class="n">x</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">)))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">flt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">TOLERANCE</span><span class="p">):</span>
    <span class="s2">&quot;x &lt; y&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">fgt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">TOLERANCE</span><span class="p">):</span>
    <span class="s2">&quot;x &gt; y&quot;</span>
    <span class="k">return</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">fle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">TOLERANCE</span><span class="p">):</span>
    <span class="s2">&quot;x &lt;= y&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">y</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">))</span>


<span class="k">def</span><span class="w"> </span><span class="nf">fge</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">TOLERANCE</span><span class="p">):</span>
    <span class="s2">&quot;x &gt;= y&quot;</span>
    <span class="k">return</span> <span class="ow">not</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">y</span> <span class="o">-</span> <span class="n">epsilon</span><span class="p">))</span>


<span class="n">boundary</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.35</span><span class="p">,</span> <span class="mf">0.34</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.4</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.51</span><span class="p">,</span> <span class="mf">0.47</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.48</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.44</span><span class="p">,</span> <span class="mf">0.62</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.66</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.55</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.556</span><span class="p">,</span> <span class="mf">0.48</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.63</span><span class="p">,</span> <span class="mf">0.43</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.70</span><span class="p">,</span> <span class="mf">0.44</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.51</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">0.91</span><span class="p">,</span> <span class="mf">0.57</span><span class="p">],</span>
    <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">],</span>
<span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">intersects</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">isegment</span><span class="p">):</span>
    <span class="s2">&quot;p is a point (x1, y1), isegment is an integer indicating which segment starting with 0&quot;</span>
    <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">p</span>
    <span class="n">bx1</span><span class="p">,</span> <span class="n">by1</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">[</span><span class="n">isegment</span><span class="p">]</span>
    <span class="n">bx2</span><span class="p">,</span> <span class="n">by2</span> <span class="o">=</span> <span class="n">boundary</span><span class="p">[</span><span class="n">isegment</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">feq</span><span class="p">(</span><span class="n">bx1</span><span class="p">,</span> <span class="n">bx2</span><span class="p">)</span> <span class="ow">and</span> <span class="n">feq</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">):</span>  <span class="c1"># both segments are vertical</span>
        <span class="k">if</span> <span class="n">feq</span><span class="p">(</span><span class="n">bx1</span><span class="p">,</span> <span class="n">x1</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">elif</span> <span class="n">feq</span><span class="p">(</span><span class="n">bx1</span><span class="p">,</span> <span class="n">bx2</span><span class="p">):</span>  <span class="c1"># segment is vertical</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">/</span> <span class="n">x1</span>  <span class="c1"># slope of reference line</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">bx1</span>  <span class="c1"># value of reference line at bx1</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">fge</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">by1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">flt</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">by2</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">fle</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">by1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fgt</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">by2</span><span class="p">)):</span>
            <span class="c1"># reference line intersects the segment</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># neither reference line nor segment is vertical</span>
        <span class="n">m</span> <span class="o">=</span> <span class="p">(</span><span class="n">by2</span> <span class="o">-</span> <span class="n">by1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">bx2</span> <span class="o">-</span> <span class="n">bx1</span><span class="p">)</span>  <span class="c1"># segment slope</span>
        <span class="n">m1</span> <span class="o">=</span> <span class="n">y1</span> <span class="o">/</span> <span class="n">x1</span>
        <span class="k">if</span> <span class="n">feq</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">m1</span><span class="p">):</span>  <span class="c1"># line and segment are parallel</span>
            <span class="k">if</span> <span class="n">feq</span><span class="p">(</span><span class="n">y1</span><span class="p">,</span> <span class="n">m</span> <span class="o">*</span> <span class="n">bx1</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># lines are not parallel</span>
            <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="n">m</span> <span class="o">*</span> <span class="n">bx1</span> <span class="o">-</span> <span class="n">by1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">m</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span>  <span class="c1"># x at intersection</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">fge</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bx1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">flt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bx2</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">fle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bx1</span><span class="p">)</span> <span class="ow">and</span> <span class="n">fgt</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bx2</span><span class="p">)))</span> <span class="ow">and</span> <span class="n">fle</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x1</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;you should not get here&quot;</span><span class="p">)</span>


<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">p</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">boundary</span><span class="p">],</span> <span class="p">[</span><span class="n">p</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">boundary</span><span class="p">],</span> <span class="s2">&quot;go-&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">100</span>

<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="n">X</span><span class="p">:</span>
        <span class="n">p</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">nintersections</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">intersects</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">boundary</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)])</span>
        <span class="k">if</span> <span class="n">nintersections</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;r.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;b.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/tmp/ipykernel_2451/812257764.py:71: RuntimeWarning: invalid value encountered in scalar divide
  m1 = y1 / x1
/tmp/ipykernel_2451/812257764.py:71: RuntimeWarning: divide by zero encountered in scalar divide
  m1 = y1 / x1
</pre></div>
</div>
<img alt="../_images/60a0b25f91ac6e7356c342ed79f15f3aaf39dbe8e634f70ea7585ce9854fd67c.png" src="../_images/60a0b25f91ac6e7356c342ed79f15f3aaf39dbe8e634f70ea7585ce9854fd67c.png" />
</div>
</div>
<p>If you look carefully, there are two blue points in the red region, which means there is some edge case we do not capture in our function. Kudos to the person who figures it out.
Update: It was pointed out that the points intersect a point on the line.</p>
<p>Today I would use a package like <a class="reference external" href="https://pypi.org/project/shapely/">Shapely</a> for this.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./blog"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="programming.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Programming</p>
      </div>
    </a>
    <a class="right-next"
       href="../docs/about.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">About pycse</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#peak-finding-in-raman-spectroscopy">Peak finding in Raman spectroscopy</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary-notes">Summary notes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-fitting-to-get-overlapping-peak-areas">Curve fitting to get overlapping peak areas</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#notable-differences-from-matlab">Notable differences from Matlab</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-the-boiling-point-of-water">Estimating the boiling point of water</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#summary">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#gibbs-energy-minimization-and-the-nist-webbook">Gibbs energy minimization and the NIST webbook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-mole-fractions-and-partial-pressures">Compute mole fractions and partial pressures</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-equilibrium-constants">Computing equilibrium constants</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-equilibrium-composition-by-direct-minimization-of-gibbs-free-energy-on-mole-numbers">Finding equilibrium composition by direct minimization of Gibbs free energy on mole numbers</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gibbs-energy-of-a-mixture">The Gibbs energy of a mixture</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#linear-equality-constraints-for-atomic-mass-conservation">Linear equality constraints for atomic mass conservation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equilibrium-constant-based-on-mole-numbers">Equilibrium constant based on mole numbers</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-gibbs-free-energy-of-a-reacting-mixture-and-the-equilibrium-composition">The Gibbs free energy of a reacting mixture and the equilibrium composition</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#water-gas-shift-equilibria-via-the-nist-webbook">Water gas shift equilibria via the NIST Webbook</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#hydrogen">hydrogen</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#h2o">H<sub>2</sub>O</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#co">CO</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#co2">CO<sub>2</sub></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#standard-state-heat-of-reaction">Standard state heat of reaction</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#non-standard-state-delta-h-and-delta-g">Non-standard state <span class="math notranslate nohighlight">\(\Delta H\)</span> and <span class="math notranslate nohighlight">\(\Delta G\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-how-the-delta-g-varies-with-temperature">Plot how the <span class="math notranslate nohighlight">\(\Delta G\)</span> varies with temperature</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equilibrium-constant-calculation">Equilibrium constant calculation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#equilibrium-yield-of-wgs">Equilibrium yield of WGS</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-gas-phase-pressures-of-each-species">Compute gas phase pressures of each species</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compare-the-equilibrium-constants">Compare the equilibrium constants</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#constrained-minimization-to-find-equilibrium-compositions">Constrained minimization to find equilibrium compositions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#using-constrained-optimization-to-find-the-amount-of-each-phase-present">Using constrained optimization to find the amount of each phase present</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#conservation-of-mass-in-chemical-reactions">Conservation of mass in chemical reactions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#numerically-calculating-an-effectiveness-factor-for-a-porous-catalyst-bead">Numerically calculating an effectiveness factor for a porous catalyst bead</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-a-pipe-diameter">Computing a pipe diameter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-parameter-database-text-files-in-python">Reading parameter database text files in python</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#calculating-a-bubble-point-pressure-of-a-mixture">Calculating a bubble point pressure of a mixture</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-equal-area-method-for-the-van-der-waals-equation">The equal area method for the van der Waals equation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-areas">Compute areas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-dependent-concentration-in-a-first-order-reversible-reaction-in-a-batch-reactor">Time dependent concentration in a first order reversible reaction in a batch reactor</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#finding-equilibrium-conversion">Finding equilibrium conversion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrating-a-batch-reactor-design-equation">Integrating a batch reactor design equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#uncertainty-in-an-integral-equation">Uncertainty in an integral equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#integrating-the-batch-reactor-mole-balance">Integrating the batch reactor mole balance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plug-flow-reactor-with-a-pressure-drop">Plug flow reactor with a pressure drop</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solving-cstr-design-equations">Solving CSTR design equations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#meet-the-steam-tables">Meet the steam tables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#starting-point-in-the-rankine-cycle-in-condenser">Starting point in the Rankine cycle in condenser.</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#isentropic-compression-of-liquid-to-point-2">Isentropic compression of liquid to point 2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#isobaric-heating-to-t3-in-boiler-where-we-make-steam">Isobaric heating to T3 in boiler where we make steam</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#isentropic-expansion-through-turbine-to-point-4">Isentropic expansion through turbine to point 4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#to-get-from-point-4-to-point-1">To get from point 4 to point 1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#efficiency">Efficiency</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#entropy-temperature-chart">Entropy-temperature chart</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">Summary</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-region-is-a-point-in">What region is a point in</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By John Kitchin
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
<div class="extra_footer">
  <!-- RAG Chat Widget - Self-contained version for Jupyter Book -->
<style>
/* RAG Widget Styles */
:root {
    --widget-primary-color: #1f77b4;
    --widget-primary-hover: #1565a8;
    --widget-bg-color: #ffffff;
    --widget-text-color: #262730;
    --widget-border-color: #e0e0e0;
    --widget-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    --widget-shadow-lg: 0 12px 32px rgba(0, 0, 0, 0.2);
    --widget-border-radius: 16px;
    --widget-button-size: 60px;
    --widget-z-index: 9999;
}

.rag-widget {
    position: fixed;
    z-index: var(--widget-z-index);
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
    bottom: 20px;
    right: 20px;
}

.widget-button {
    width: var(--widget-button-size);
    height: var(--widget-button-size);
    border-radius: 50%;
    background-color: var(--widget-primary-color);
    border: none;
    box-shadow: var(--widget-shadow);
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    overflow: hidden;
}

.widget-button:hover {
    background-color: var(--widget-primary-hover);
    box-shadow: var(--widget-shadow-lg);
    transform: scale(1.05);
}

.widget-button:active {
    transform: scale(0.95);
}

.widget-icon,
.widget-close-icon {
    width: 28px;
    height: 28px;
    color: white;
    transition: all 0.3s ease;
    position: absolute;
}

.widget-close-icon {
    opacity: 0;
    transform: rotate(90deg) scale(0);
}

.widget-button.active .widget-icon {
    opacity: 0;
    transform: rotate(-90deg) scale(0);
}

.widget-button.active .widget-close-icon {
    opacity: 1;
    transform: rotate(0deg) scale(1);
}

.widget-container {
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: min(50vw, calc(100vw - 40px));
    height: min(600px, calc(100vh - 120px));
    max-width: calc(100vw - 40px);
    max-height: calc(100vh - 120px);
    background-color: var(--widget-bg-color);
    border-radius: var(--widget-border-radius);
    box-shadow: var(--widget-shadow-lg);
    display: flex;
    flex-direction: column;
    overflow: hidden;
    opacity: 0;
    transform: scale(0.9) translateY(10px);
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    pointer-events: none;
}

.widget-container.visible {
    opacity: 1;
    transform: scale(1) translateY(0);
    pointer-events: all;
}

.widget-container.hidden {
    display: none;
}

.widget-header {
    background-color: var(--widget-primary-color);
    color: white;
    padding: 16px 20px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-shrink: 0;
}

.widget-header-content {
    flex: 1;
}

.widget-title {
    margin: 0;
    font-size: 18px;
    font-weight: 600;
    line-height: 1.2;
}

.widget-subtitle {
    margin: 4px 0 0 0;
    font-size: 13px;
    opacity: 0.9;
    line-height: 1.2;
}

.widget-minimize-btn {
    background: none;
    border: none;
    color: white;
    cursor: pointer;
    padding: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
    transition: background-color 0.2s ease;
}

.widget-minimize-btn:hover {
    background-color: rgba(255, 255, 255, 0.1);
}

.widget-minimize-btn svg {
    width: 20px;
    height: 20px;
}

.widget-iframe-container {
    flex: 1;
    position: relative;
    overflow: hidden;
    background-color: #f5f5f5;
}

#widget-iframe {
    width: 100%;
    height: 100%;
    border: none;
}

.widget-footer {
    padding: 12px 20px;
    background-color: var(--widget-bg-color);
    border-top: 1px solid var(--widget-border-color);
    text-align: center;
    flex-shrink: 0;
}

.widget-powered-by {
    font-size: 12px;
    color: #666;
}

.widget-powered-by a {
    color: var(--widget-primary-color);
    text-decoration: none;
    font-weight: 500;
}

.widget-powered-by a:hover {
    text-decoration: underline;
}

@media (max-width: 768px) {
    .widget-container {
        width: 100%;
        height: 100%;
        max-width: 100%;
        max-height: 100%;
        bottom: 0;
        right: 0;
        left: 0;
        top: 0;
        border-radius: 0;
    }

    .widget-button {
        width: 56px;
        height: 56px;
    }

    .widget-icon,
    .widget-close-icon {
        width: 24px;
        height: 24px;
    }
}

@media (max-width: 480px) {
    .rag-widget {
        bottom: 16px;
        right: 16px;
    }
}

.widget-iframe-container::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 40px;
    height: 40px;
    border: 3px solid #f3f3f3;
    border-top: 3px solid var(--widget-primary-color);
    border-radius: 50%;
    animation: widget-spin 1s linear infinite;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.widget-iframe-container.loading::before {
    opacity: 1;
}

@keyframes widget-spin {
    0% { transform: translate(-50%, -50%) rotate(0deg); }
    100% { transform: translate(-50%, -50%) rotate(360deg); }
}

@media (prefers-color-scheme: dark) {
    :root {
        --widget-bg-color: #1e1e1e;
        --widget-text-color: #ffffff;
        --widget-border-color: #333333;
    }

    .widget-iframe-container {
        background-color: #252525;
    }
}

.widget-button:focus,
.widget-minimize-btn:focus {
    outline: 2px solid var(--widget-primary-color);
    outline-offset: 2px;
}

@media print {
    .rag-widget {
        display: none !important;
    }
}
</style>

<div id="rag-widget" class="rag-widget">
    <!-- Floating Button -->
    <button id="widget-button" class="widget-button" aria-label="Open chat">
        <svg class="widget-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>
            <path d="M7 9h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/>
        </svg>
        <svg class="widget-close-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </svg>
    </button>

    <!-- Chat Container -->
    <div id="widget-container" class="widget-container hidden">
        <!-- Header -->
        <div class="widget-header">
            <div class="widget-header-content">
                <h3 class="widget-title">Secret A(i)gent</h3>
                <p class="widget-subtitle">Ask me anything</p>
            </div>
            <button id="widget-minimize" class="widget-minimize-btn" aria-label="Minimize chat">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 13H5v-2h14v2z"/>
                </svg>
            </button>
        </div>

        <!-- Chat iframe -->
        <div class="widget-iframe-container">
            <iframe
                id="widget-iframe"
                src=""
                frameborder="0"
                allow="clipboard-write"
                title="RAG Chat Assistant">
            </iframe>
        </div>

        <!-- Footer -->
        <div class="widget-footer">
            <span class="widget-powered-by">
                Powered by <a href="https://github.com/jkitchin/streamlit-rag-widget" target="_blank">a Secret A(i)gent</a>
            </span>
        </div>
    </div>
</div>

<script>
/**
 * RAG Widget Configuration and Script
 */
(function() {
    'use strict';

    // Configuration
    const config = {
        streamlitUrl: 'https://kitchin-services.cheme.cmu.edu',
        position: 'bottom-right',
        width: '50vw',
        height: '600px',
        primaryColor: '#1f77b4',
        title: 'Secret A(i)gent',
        subtitle: 'Ask me anything',
        showPoweredBy: true,
        autoOpen: false,
        openDelay: 0,
        zIndex: 9999,
    };

    // Widget state
    let isOpen = false;

    // Get DOM elements
    const widget = document.getElementById('rag-widget');
    const button = document.getElementById('widget-button');
    const container = document.getElementById('widget-container');
    const iframe = document.getElementById('widget-iframe');
    const minimizeBtn = document.getElementById('widget-minimize');
    const iframeContainer = document.querySelector('.widget-iframe-container');

    if (!widget || !button || !container || !iframe) {
        console.error('RAG Widget: Required elements not found');
        return;
    }

    /**
     * Initialize widget
     */
    function init() {
        // Set iframe URL
        iframe.src = config.streamlitUrl;

        // Set custom colors
        if (config.primaryColor) {
            document.documentElement.style.setProperty('--widget-primary-color', config.primaryColor);
        }

        // Set title and subtitle
        const title = document.querySelector('.widget-title');
        const subtitle = document.querySelector('.widget-subtitle');
        if (title && config.title) {
            title.textContent = config.title;
        }
        if (subtitle && config.subtitle) {
            subtitle.textContent = config.subtitle;
        }

        // Hide powered by if configured
        if (!config.showPoweredBy) {
            const footer = document.querySelector('.widget-footer');
            if (footer) {
                footer.style.display = 'none';
            }
        }

        // Add event listeners
        button.addEventListener('click', toggleWidget);
        minimizeBtn.addEventListener('click', closeWidget);

        // Handle keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape' && isOpen) {
                closeWidget();
            }
        });

        // Auto-open if configured
        if (config.autoOpen) {
            setTimeout(openWidget, config.openDelay);
        }

        console.log('RAG Widget initialized');
    }

    /**
     * Toggle widget open/closed
     */
    function toggleWidget() {
        if (isOpen) {
            closeWidget();
        } else {
            openWidget();
        }
    }

    /**
     * Open widget
     */
    function openWidget() {
        isOpen = true;
        button.classList.add('active');
        container.classList.remove('hidden');

        setTimeout(function() {
            container.classList.add('visible');
        }, 10);

        setTimeout(function() {
            iframe.focus();
        }, 300);
    }

    /**
     * Close widget
     */
    function closeWidget() {
        isOpen = false;
        button.classList.remove('active');
        container.classList.remove('visible');

        setTimeout(function() {
            container.classList.add('hidden');
        }, 300);
    }

    /**
     * Public API
     */
    window.RAGWidget = {
        open: openWidget,
        close: closeWidget,
        toggle: toggleWidget,
        isOpen: function() { return isOpen; }
    };

    // Initialize when DOM is ready
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }

})();
</script>

</div>
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>